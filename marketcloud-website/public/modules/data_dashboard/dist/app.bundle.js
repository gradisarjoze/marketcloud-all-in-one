!(function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0)})((function(modules){for(var i in modules)if(Object.prototype.hasOwnProperty.call(modules,i))switch(typeof modules[i]){case"function":break;case"object":modules[i]=(function(_m){var args=_m.slice(1),fn=modules[_m[0]];return function(a,b,c){fn.apply(this,[a,b,c].concat(args))}})(modules[i]);break;default:modules[i]=modules[modules[i]]}return modules})([function(module,exports,__webpack_require__){"use strict";function requireAll(requireContext){return requireContext.keys().map(requireContext)}requireAll(__webpack_require__(1))},function(module,exports,__webpack_require__){function webpackContext(req){return __webpack_require__(webpackContextResolve(req))}function webpackContextResolve(req){return map[req]||(function(){throw new Error("Cannot find module '"+req+"'.")})()}var map={"./app.js":2,"./components/activeFilters/activeFilters.component.js":3,"./components/addProductsCard/addProductsCard.component.js":4,"./components/addressForm/addressForm.component.js":5,"./components/application/application.component.js":6,"./components/autocomplete/autocomplete.component.js":7,"./components/backButton/backButton.component.js":8,"./components/brandsSelector/brandsSelector.component.js":9,"./components/categoriesSelector/categoriesSelector.component.js":10,"./components/customAttributes/customAttributes.component.js":11,"./components/dashboardBreadcrumb/dashboardBreadcrumb.component.js":12,"./components/dashboardSectionNavbar/dashboardSectionNavbar.component.js":13,"./components/dataTable/dataTable.component.js":14,"./components/errorMessages/errorMessages.component.js":15,"./components/flagIcon/flagIcon.component.js":16,"./components/imageSelector/imageSelector.component.js":17,"./components/imageThumbnail/imageThumbnail.component.js":18,"./components/imagesCard/imagesCard.component.js":19,"./components/linkHelpText/linkHelpText.component.js":20,"./components/navbar/navbar.component.js":21,"./components/paginationNav/paginationNav.component.js":22,"./components/paginationSelector/paginationSelector.component.js":23,"./components/resourcePicker/resourcePicker.component.js":24,"./components/seoForm/seoForm.component.js":25,"./components/sidebar/sidebar.component.js":26,"./components/sortingSelector/sortingSelector.component.js":27,"./components/switch/switch.component.js":28,"./components/taxesSelector/taxesSelector.component.js":29,"./components/toolbarSearch/toolbarSearch.component.js":30,"./controllers/PaymentMethods.controller.js":31,"./controllers/analytics.controller.js":32,"./controllers/application/acl.controller.js":33,"./controllers/application/application.new.controller.js":34,"./controllers/application/applications.list.controller.js":35,"./controllers/application/billing.controller.js":36,"./controllers/application/collaborators.controller.js":37,"./controllers/application/deploy.controller.js":38,"./controllers/application/integrations.controller.js":39,"./controllers/application/navigation.controller.js":40,"./controllers/application/overview.controller.js":41,"./controllers/application/settings.controller.js":42,"./controllers/application/webhooks.controller.js":43,"./controllers/brandTranslations.controller.js":44,"./controllers/brands/brands.edit.js":45,"./controllers/brands/brands.list.js":46,"./controllers/brands/brands.new.js":47,"./controllers/categories/categories.edit.js":48,"./controllers/categories/categories.list.js":49,"./controllers/categories/categories.new.js":50,"./controllers/categoryTranslations.controller.js":51,"./controllers/collectionTranslations.controller.js":52,"./controllers/collections/collections.controller.js":53,"./controllers/collections/collections.create.js":54,"./controllers/collections/collections.edit.js":55,"./controllers/collections/collections.new.js":56,"./controllers/contentTranslations.controller.js":57,"./controllers/contents/content.edit.js":58,"./controllers/contents/content.new.js":59,"./controllers/contents/contents.list.js":60,"./controllers/contents/groupedProducts.edit.js":61,"./controllers/contents/groupedProducts.new.js":62,"./controllers/coupons/coupon.edit.js":63,"./controllers/coupons/coupons.new.js":64,"./controllers/deploy.js":65,"./controllers/home.js":66,"./controllers/integrations.js":67,"./controllers/invoices/invoice.new.js":68,"./controllers/invoices/invoices.edit.js":69,"./controllers/localization.controller.js":70,"./controllers/media.list.js":71,"./controllers/media_manager.controller.js":72,"./controllers/notifications/notifications.edit.js":73,"./controllers/notifications/notifications.js":74,"./controllers/notifications/notifications.new.js":75,"./controllers/notifications/notifications.preview.js":76,"./controllers/notifications/notifications.translations.js":77,"./controllers/orders/orders.list.js":78,"./controllers/orders/orders.new.js":79,"./controllers/orders/orders.view.js":80,"./controllers/productTranslations.controller.js":81,"./controllers/products/bundledProduct.edit.js":82,"./controllers/products/bundledProduct.new.js":83,"./controllers/products/configurableProduct.edit.js":84,"./controllers/products/configurableProduct.new.js":85,"./controllers/products/products.list.js":86,"./controllers/products/productsWithVariants.edit.js":87,"./controllers/products/productsWithVariants.new.js":88,"./controllers/products/simpleProduct.edit.js":89,"./controllers/products/simpleProduct.new.js":90,"./controllers/promotions/promotions.edit.js":91,"./controllers/promotions/promotions.new.js":92,"./controllers/resource.list.js":93,"./controllers/settings.controller.js":94,"./controllers/shippingMethods/shipping.edit.js":95,"./controllers/shippingMethods/shippings.list.js":96,"./controllers/shippingMethods/shippings.new.js":97,"./controllers/sidebar.js":98,"./controllers/staticContents/staticContent.new.js":99,"./controllers/staticContents/staticContents.edit.js":100,"./controllers/taxes/taxes.edit.js":101,"./controllers/taxes/taxes.new.js":102,"./controllers/translations.js":103,"./controllers/users/users.list.js":104,"./controllers/users/users.new.js":105,"./controllers/users/users.view.js":106,"./controllers/variables/variables.edit.js":107,"./controllers/variables/variables.list.js":108,"./controllers/variables/variables.new.js":109,"./controllers/variants.edit.js":110,"./controllers/variants/variants.list.controller.js":111,"./controllers/webhooks.js":112,"./directives/avatar.directive.js":113,"./directives/contenteditable.directive.js":114,"./directives/dropdown.directive.js":115,"./directives/fallback_src.js":116,"./directives/fileModel.directive.js":117,"./directives/focusOnShow.directive.js":118,"./directives/money.directive.js":119,"./directives/ng-thumb.directive.js":120,"./directives/ng_enter.js":121,"./directives/onChangeAsync.directive.js":122,"./directives/onFileChange.directive.js":123,"./factories/account.factory.js":124,"./factories/application.factory.js":125,"./factories/cache.factory.js":126,"./factories/locales.factory.js":127,"./factories/marketcloud.factory.js":128,"./factories/models.factory.js":129,"./factories/notificationsPresets.factory.js":130,"./factories/pagination.factory.js":131,"./factories/rolesPresets.factory.js":132,"./factories/stormConfiguration.factory.js":133,"./factories/tableManager.factory.js":134,"./factories/taxrates.factory.js":135,"./factories/utils.factory.js":136,"./factories/validation.service.js":137};webpackContext.keys=function(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=1},function(module,exports){"use strict";!(function(){window.VERSION="1.9.1",window.API_BASE_URL="/api/v0",window.LAST_ERROR=null;var app=angular.module("DataDashboard",["ngRoute","ngMessages","ngTagsInput","angular-loading-bar","frapontillo.bootstrap-switch","ngSanitize","angularFileUpload","Marketcloud.Shared","angularMoment","chart.js","trumbowyg-ng","moment-picker","dndLists"]);app.config(["$locationProvider",function($locationProvider){$locationProvider.hashPrefix("")}]),app.config(["$compileProvider",function($compileProvider){$compileProvider.debugInfoEnabled(!1)}]),app.run(function(){notie.setOptions({colorSuccess:"#27ae60",colorWarning:"#f39c12",colorError:"#c0392b",colorInfo:"#2980b9",colorNeutral:"#95a5a6",colorText:"#FFFFFF",dateMonths:["Januar","Februar","MÃ¤rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],animationDelay:300,backgroundClickDismiss:!0})}),app.run(["StormConfiguration","$http",function(Configuration,$http){var theme=Configuration.get("theme");Configuration.applyTheme(theme)}]),app.config(["$httpProvider",function($httpProvider){$httpProvider.defaults.paramSerializer="$httpParamSerializerJQLike"}]),app.factory("$exceptionHandler",["$injector",function($injector){return function(exception,cause){var $http=$injector.get("$http"),$log=$injector.get("$log"),$getBrowser=$injector.get("GetBrowser");return $log.error(exception),window.LAST_ERROR===exception.toString()?void console.info("Not logging this error instance, because it was already logged."):(window.LAST_ERROR=exception.toString(),$http({method:"POST",url:"/logs",data:{type:"frontend-error",source:"data-dashboard",browser:$getBrowser(),url:window.location.href,error:{error:exception.toString(),stack:exception.stack||null,cause:cause||null}}}).then(function(response){$log.warn("An error was logged.")}).catch(function(response){$log.warn("Unable to log errors, if you see this message, please contact us at info@marketcloud.studio404.net .Thank you.")}),!0)}}]),app.run(["$rootScope","$route","$application","$account","$location",function($rootScope,$route,$application,$account,$location){$rootScope.application=window.current_application,$rootScope.user=window.user,$application.set(window.current_application),$account.set(window.user),$rootScope.$on("$routeChangeStart",function(event,next,current){var nextRouteName=next.$$route.name,currentUserRole=$application.get("role");if("admin"!=currentUserRole&&"owner"!==currentUserRole){if(next.$$route.acl){var deniedRoles=next.$$route.acl.deny||[];deniedRoles.indexOf(currentUserRole)>-1&&(notie.alert(2,"Access restricted for users with role "+currentUserRole,2),$rootScope.$evalAsync(function(){$rootScope.showLoadingAnimation=!1,current||$location.path("/")}),event.preventDefault())}console.log("Next route is "+nextRouteName+" and your role is "+currentUserRole)}}),$rootScope.$on("$routeChangeStart",function(event,next,current){$rootScope.showLoadingAnimation=!0}),$rootScope.$on("$routeChangeError",function(){$rootScope.showLoadingAnimation=!1}),$rootScope.$on("$routeChangeSuccess",function(){var _route=angular.copy($route.current.$$route),routeName="unknown";_route&&_route.name&&(routeName=_route.name),$rootScope.showLoadingAnimation=!1,$rootScope.$broadcast("$dashboardSectionChange",{section:routeName})})}]),app.run(["$window","$rootScope",function($window,$rootScope){$rootScope.online=navigator.onLine,$window.addEventListener("offline",function(){notie.alert(2,"You are currently offline. Waiting for connection.."),$rootScope.$apply(function(){$rootScope.online=!1})},!1),$window.addEventListener("online",function(){notie.alertHide(),$rootScope.$apply(function(){$rootScope.online=!0})},!1)}]),app.service("authInterceptor",["$q",function($q){var service=this;service.responseError=function(response){return 401===response.status&&(notie.alert(4,"Session expired, reloading page..."),window.location.reload()),$q.reject(response)}}]).config(["$httpProvider",function($httpProvider){$httpProvider.interceptors.push("authInterceptor")}]),app.run(["$rootScope","$location",function($root,$location){$root.$on("$routeChangeError",function(event,route,args,response){response.status>=500?$location.path("/error"):400===response.status?notie.alert(2,"An error has occurred. Please check the data you entered",1):(console.log("$routeChangeError",response),notie.alert(2,"An error has occurred.",1))})}]),app.config(["$routeProvider",function($routeProvider){$routeProvider.when("/applications/list",{name:"applications",templateUrl:"/modules/data_dashboard/templates/list_applications.html",controller:"ListApplicationsController"}).when("/applications/new",{name:"applications.new",templateUrl:"/modules/data_dashboard/templates/new_application.html",controller:"CreateApplicationController"}).when("/analytics",{name:"analytics",templateUrl:"/modules/data_dashboard/templates/analytics.html",controller:"AnalyticsController",resolve:{analytics:["$marketcloud","$location",function($marketcloud,$location){var range=$location.search().range||"this month",_from=null,_to=null;switch(range){case"today":var _from=new Date;_from.setHours(0,0,0,0);break;case"yesterday":var _from=new Date;_from.setDate(_from.getDate()-1),_from.setHours(0,0,0,0);var _to=new Date;_to.setHours(0,0,0,0);break;case"this week":var _from=new Date;_from.setDate(_from.getDate()-7),_from.setHours(0,0,0,0);break;default:var _from=new Date;_from.setMonth(_from.getMonth()-1),_from.setHours(0,0,0,0)}return _to||(_to=new Date),$marketcloud.orders.list({$created_at_gt:_from.getTime(),$created_at_lt:_to.getTime(),per_page:9999})}],customers:["$marketcloud","$location",function($marketcloud,$location){var range=$location.search().range||"this month",_from=null,_to=null;switch(range){case"today":var _from=new Date;_from.setHours(0,0,0,0);break;case"yesterday":var _from=new Date;_from.setDate(_from.getDate()-1),_from.setHours(0,0,0,0);var _to=new Date;_to.setHours(0,0,0,0);break;case"this week":var _from=new Date;_from.setDate(_from.getDate()-7),_from.setHours(0,0,0,0);break;default:var _from=new Date;_from.setMonth(_from.getMonth()-1),_from.setHours(0,0,0,0)}return _to||(_to=new Date),$marketcloud.users.list({$created_at_gt:_from.toISOString(),$created_at_lt:_to.toISOString(),per_page:9999})}],carts:["$marketcloud","$location",function($marketcloud,$location){var range=$location.search().range||"this month",_from=null,_to=null;switch(range){case"today":var _from=new Date;_from.setHours(0,0,0,0);break;case"yesterday":var _from=new Date;_from.setDate(_from.getDate()-1),_from.setHours(0,0,0,0);var _to=new Date;_to.setHours(0,0,0,0);break;case"this week":var _from=new Date;_from.setDate(_from.getDate()-7),_from.setHours(0,0,0,0);break;default:var _from=new Date;_from.setMonth(_from.getMonth()-1),_from.setHours(0,0,0,0)}return _to||(_to=new Date),$marketcloud.carts.list({$created_at_gt:_from.toISOString(),$created_at_lt:_to.toISOString(),per_page:9999})}]}}).when("/",{name:"home",templateUrl:"/modules/data_dashboard/templates/home.html",controller:"HomeController",resolve:{analytics:["$http",function($http){var one_month_ago=new Date;return one_month_ago.setMonth(one_month_ago.getMonth()-1),one_month_ago.setHours(0,0,0,0),$http({method:"GET",url:API_BASE_URL+"/orders",params:{$created_at_gt:one_month_ago.getTime(),per_page:99999},headers:{Authorization:window.public_key+":"+window.token}})}]}}).when("/error",{templateUrl:"/modules/data_dashboard/templates/error.html"}).when("/bundled_product/create",{name:"products.create",templateUrl:"/modules/data_dashboard/templates/new_bundled_product.html",controller:"NewBundledProductController"}).when("/bundled_product/:productId/edit",{name:"products.edit",templateUrl:"/modules/data_dashboard/templates/edit_bundled_product.html",controller:"EditBundledProductController",resolve:{product:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.products.getById($route.current.params.productId)}]}}).when("/products",{name:"products.list",templateUrl:"/modules/data_dashboard/templates/products.html",controller:"ListProductsController",reloadOnSearch:!1,resolve:{products:["$marketcloud","StormConfiguration","$route","$location",function($marketcloud,configuration,$route,$location){var filters=configuration.get("products_list_active_filters")||[],query={page:1};filters.forEach(function(filter){query[filter.name]=filter.value});var urlQuery={};try{urlQuery=JSON.parse($location.search().query)}catch(e){urlQuery={}}for(var k in urlQuery)query[k]=urlQuery[k];return $marketcloud.products.list(query)}]}}).when("/product_with_variants/create",{name:"products.create",templateUrl:"/modules/data_dashboard/templates/new_productWithVariants.html",controller:"NewProductWithVariantsController"}).when("/product_with_variants/create2",{name:"products.create",templateUrl:"/modules/data_dashboard/templates/new_productWithVariants2.html",controller:"NewProductWithVariantsController"}).when("/simple_product/create",{name:"products.create",templateUrl:"/modules/data_dashboard/templates/new_simple_product.html",controller:"NewSimpleProductController"}).when("/simple_product/:productId/edit",{name:"products.edit",templateUrl:"/modules/data_dashboard/templates/edit_simple_product.html",controller:"EditSimpleProductController",resolve:{product:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.products.getById($route.current.params.productId)}]}}).when("/product_with_variants/:productId/edit",{name:"products.edit",templateUrl:"/modules/data_dashboard/templates/edit_productWithVariants.html",controller:"EditProductWithVariantsController",resolve:{product:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.products.getById($route.current.params.productId)}]}}).when("/products/:productId/variants",{name:"products.variants.list",templateUrl:"/modules/data_dashboard/templates/list_variants.html",controller:"ListVariantsController",resolve:{resolvedProduct:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.products.getById($route.current.params.productId)}]}}).when("/products/:productId/variants/:variantId",{name:"products.variants.edit",templateUrl:"/modules/data_dashboard/templates/edit_variant.html",controller:"EditVariantController",resolve:{resolvedProduct:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.products.getById($route.current.params.productId)}]}}).when("/resource/:resourceName",{name:"",templateUrl:function(params){return"/modules/data_dashboard/templates/resources.html"},controller:"ListResourcesController",resolve:{resources:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud[$route.current.params.resourceName].list()}],dependencies:["$q",function($q){return $q.when({})}]}}).when("/products/:productId/translations",{name:"products.translation.edit",templateUrl:"/modules/data_dashboard/templates/product_translations.html",controller:"EditProductTranslationsController",resolve:{product:["$marketcloud","$route","$q","$location",function($marketcloud,$route,$q,$location){return $marketcloud.products.getById($route.current.params.productId)}]}}).when("/categories/:id/translations",{name:"categories.translation.edit",templateUrl:"/modules/data_dashboard/templates/category_translations.html",controller:"EditCategoryTranslationsController",resolve:{category:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.categories.getById($route.current.params.id)}]}}).when("/brands/:id/translations",{name:"brands.translation.edit",templateUrl:"/modules/data_dashboard/templates/brand_translations.html",controller:"EditBrandTranslationsController",resolve:{brand:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.brands.getById($route.current.params.id)}]}}).when("/collections/:id/translations",{name:"collections.translation.edit",templateUrl:"/modules/data_dashboard/templates/collection_translations.html",controller:"EditCollectionTranslationsController",resolve:{collection:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.collections.getById($route.current.params.id)}]}}).when("/contents/:id/translations",{name:"contents.translation.edit",templateUrl:"/modules/data_dashboard/templates/content_translations.html",controller:"EditContentTranslationsController",resolve:{content:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.contents.getById($route.current.params.id)}]}}).when("/invoices/create/:orderId?",{name:"invoices.create",templateUrl:"/modules/data_dashboard/templates/new_invoice.html",controller:"NewInvoiceController",resolve:{parentOrder:["$marketcloud","$route",function($marketcloud,$route){return $route.current.params.orderId?$marketcloud.orders.getById($route.current.params.orderId):{}}],orders:["$marketcloud",function($marketcloud){return $marketcloud.orders.list({per_page:5})}]}}).when("/invoices/:invoiceId/edit",{name:"invoices.edit",templateUrl:"/modules/data_dashboard/templates/edit_invoice.html",controller:"EditInvoiceController",resolve:{invoice:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.invoices.getById($route.current.params.invoiceId)}]}}).when("/invoices/",{name:"invoices.list",templateUrl:"/modules/data_dashboard/templates/invoices.html",controller:"ListResourcesController",resolve:{resources:["$marketcloud",function($marketcloud){return $marketcloud.invoices.list({page:1})}],resourceName:function(){return"invoices"},dependencies:["$q",function($q){return $q.when({})}]}}).when("/payments/",{name:"payments.list",templateUrl:"/modules/data_dashboard/templates/payments.html",controller:"ListResourcesController",resolve:{resources:["$marketcloud",function($marketcloud){return $marketcloud.payments.list({page:1})}],resourceName:function(){return"payments"},dependencies:["$q","$marketcloud",function($q,$marketcloud){return $q.all({events:$marketcloud.events.list({"request.path":"/v0/payments"})})}]}}).when("/payments/alerts",{name:"payments.alerts.list",templateUrl:"/modules/data_dashboard/templates/payments_alerts.html",controller:"ListResourcesController",resolve:{resources:["$http",function($http){return $http({method:"GET",url:window.API_BASE_URL+"/payments/alerts",headers:{"Content-Type":"application/json",Authorization:window.public_key+":"+window.token}})}],resourceName:function(){return"events"},dependencies:["$q",function($q){return $q.when({})}]}}).when("/orders",{name:"orders.list",templateUrl:"/modules/data_dashboard/templates/orders.html",controller:"OrdersController",reloadOnSearch:!1,resolve:{ordersResponse:["$marketcloud","$route","$location","StormConfiguration",function($marketcloud,$route,$location,configuration){var filters=configuration.get("orders_list_active_filters")||[],query={page:1};filters.forEach(function(filter){query[filter.name]=filter.value});var urlQuery={};try{urlQuery=JSON.parse($location.search().query)}catch(e){urlQuery={}}for(var k in urlQuery)query[k]=urlQuery[k];return $marketcloud.orders.list(query)}]}}).when("/orders/create",{name:"orders.create",templateUrl:"/modules/data_dashboard/templates/new_order.html",controller:"NewOrderController"}).when("/orders/:orderId/view",{name:"orders.edit",templateUrl:"/modules/data_dashboard/templates/order.html",controller:"OrderController",resolve:{order:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.orders.getById($route.current.params.orderId)}],shippingMethods:["$marketcloud","$route",function($marketcloud){return $marketcloud.shippings.list()}],paymentMethods:["$marketcloud","$route",function($marketcloud){return $marketcloud.paymentMethods.list()}]}}).when("/users",{name:"users.list",templateUrl:"/modules/data_dashboard/templates/users.html",controller:"ListResourcesController",resolve:{resources:["$marketcloud","$route",function($marketcloud){return $marketcloud.users.list({page:1,per_page:20,expand:"orders"})}],resourceName:function(){return"users"},dependencies:["$q",function($q){return $q.when({})}]}}).when("/users/create",{name:"users.create",templateUrl:"/modules/data_dashboard/templates/new_user.html",controller:"NewUserController"}).when("/users/:userId/view",{name:"users.view",templateUrl:"/modules/data_dashboard/templates/user.html",controller:"UserController",resolve:{user:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.users.getById($route.current.params.userId)}]}}).when("/categories",{name:"categories.list",templateUrl:"/modules/data_dashboard/templates/categories.html",controller:"ListResourcesController",resolve:{resources:["$marketcloud","$route",function($marketcloud){return $marketcloud.categories.list({page:1})}],resourceName:function(){return"categories"},dependencies:["$q",function($q){return $q.when({})}]}}).when("/categories/:categoryId/edit",{name:"categories.edit",templateUrl:"/modules/data_dashboard/templates/edit_category.html",controller:"EditCategoryController",resolve:{category:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.categories.getById($route.current.params.categoryId)}]}}).when("/categories/create",{name:"categories.create",templateUrl:"/modules/data_dashboard/templates/new_category.html",controller:"CategoryController"}).when("/brands",{name:"brands.list",templateUrl:"/modules/data_dashboard/templates/brands.html",controller:"ListResourcesController",resolve:{resources:["$marketcloud","$route",function($marketcloud){return $marketcloud.brands.list({page:1})}],resourceName:function(){return"brands"},dependencies:["$q",function($q){return $q.when({})}]}}).when("/brands/:brandId/edit",{name:"brands.edit",templateUrl:"/modules/data_dashboard/templates/edit_brand.html",controller:"EditBrandController",resolve:{brand:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.brands.getById($route.current.params.brandId)}]}}).when("/brands/create",{name:"brands.create",templateUrl:"/modules/data_dashboard/templates/new_brand.html",controller:"BrandController"}).when("/collections",{name:"collections.list",templateUrl:"/modules/data_dashboard/templates/collections.html",controller:"ListResourcesController",resolve:{resources:["$marketcloud","$route",function($marketcloud){return $marketcloud.collections.list({page:1})}],resourceName:function(){return"collections"},dependencies:["$q",function($q){return $q.when({})}]}}).when("/collections/:collectionId/edit",{name:"collections.edit",templateUrl:"/modules/data_dashboard/templates/edit_collection.html",controller:"EditCollectionController",resolve:{collection:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.collections.getById($route.current.params.collectionId)}]}}).when("/collections/create",{name:"collections.create",templateUrl:"/modules/data_dashboard/templates/new_collection.html",controller:"CreateCollectionController"}).when("/integrations",{name:"integrations.list",templateUrl:"/modules/data_dashboard/templates/integrations.html",controller:"IntegrationsController"}).when("/integrations/braintree",{name:"integrations.braintree",templateUrl:"/modules/data_dashboard/templates/integration_braintree.html",controller:"IntegrationBraintreeController",resolve:{BraintreeIntegration:["$http",function($http){return $http({method:"GET",url:API_BASE_URL+"/integrations/braintree",headers:{Authorization:window.public_key+":"+window.token}}).then(function(response){return new Promise(function(resolve){resolve(response)})}).catch(function(){return new Promise(function(resolve){resolve(null)})})}]}}).when("/integrations/spaceinvoices",{name:"integrations.spaceinvoices",templateUrl:"/modules/data_dashboard/templates/integration_spaceinvoices.html",controller:"IntegrationSpaceinvoicesController",resolve:{SpaceinvoicesIntegration:["$http",function($http){return $http({method:"GET",url:API_BASE_URL+"/integrations/spaceinvoices",headers:{Authorization:window.public_key+":"+window.token}}).then(function(response){return new Promise(function(resolve){resolve(response)})}).catch(function(){return new Promise(function(resolve){resolve(null)})})}]}}).when("/integrations/stripe",{name:"integrations.stripe",templateUrl:"/modules/data_dashboard/templates/integration_stripe.html",controller:"IntegrationStripeController",resolve:{StripeIntegration:["$http",function($http){return $http({method:"GET",url:API_BASE_URL+"/integrations/stripe",headers:{Authorization:window.public_key+":"+window.token}}).then(function(response){return new Promise(function(resolve){resolve(response)})}).catch(function(){return new Promise(function(resolve){resolve(null)})})}]}}).when("/contents",{name:"contents.list",templateUrl:"/modules/data_dashboard/templates/contents.html",controller:"ListResourcesController",resolve:{resources:["$marketcloud",function($marketcloud){return $marketcloud.contents.list({page:1})}],resourceName:function(){return"contents"},dependencies:["$q",function($q){return $q.when({})}]}}).when("/contents/create",{name:"contents.create",templateUrl:"/modules/data_dashboard/templates/new_content.html",controller:"ContentController"}).when("/contents/:contentId/edit",{name:"contents.edit",templateUrl:"/modules/data_dashboard/templates/edit_content.html",controller:"EditContentController",resolve:{content:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.contents.getById($route.current.params.contentId)}]}}).when("/contents/static",{name:"staticContents.list",templateUrl:"/modules/data_dashboard/templates/staticContents/staticContents.html",controller:"ListResourcesController",resolve:{resources:["$marketcloud",function($marketcloud){return $marketcloud.staticContents.list({page:1})}],resourceName:function(){return"staticContents"},dependencies:["$q",function($q){return $q.when({})}]}}).when("/contents/static/create",{name:"staticContents.create",templateUrl:"/modules/data_dashboard/templates/staticContents/new_staticContent.html",controller:"CreateStaticContentController"}).when("/contents/static/:contentId/edit",{name:"staticContents.edit",templateUrl:"/modules/data_dashboard/templates/staticContents/edit_staticContents.html",controller:"EditStaticContentController",resolve:{content:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.staticContents.getById($route.current.params.contentId)}]}}).when("/events",{name:"events.list",templateUrl:"/modules/data_dashboard/templates/events.html",controller:"ListResourcesController",resolve:{resources:["$marketcloud","$route",function($marketcloud){return $marketcloud.events.list()}],resourceName:function(){return"events"},dependencies:["$q",function($q){return $q.when({})}]}}).when("/variables",{name:"variables.list",templateUrl:"/modules/data_dashboard/templates/variables.html",controller:"ListResourcesController",resolve:{resources:["$marketcloud","$route",function($marketcloud){return $marketcloud.variables.list()}],resourceName:function(){return"variables"},dependencies:["$q",function($q){return $q.when({})}]}}).when("/variables/create",{name:"variables.create",templateUrl:"/modules/data_dashboard/templates/new_variable.html",controller:"CreateVariableController"}).when("/variables/:variableId/edit",{name:"variables.edit",templateUrl:"/modules/data_dashboard/templates/edit_variable.html",controller:"EditVariableController",resolve:{variable:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.variables.getById($route.current.params.variableId)}]}}).when("/media",{name:"media.list",templateUrl:"/modules/data_dashboard/templates/media.html",controller:"MediaListController",resolve:{media:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.media.list()}]}}).when("/promotions",{name:"promotions.list",templateUrl:"/modules/data_dashboard/templates/promotions.html",controller:"ListResourcesController",resolve:{resources:["$marketcloud","$route",function($marketcloud){return $marketcloud.promotions.list({page:1})}],
resourceName:function(){return"promotions"},dependencies:["$q",function($q){return $q.when({})}]}}).when("/promotions/create",{name:"promotions.create",templateUrl:"/modules/data_dashboard/templates/new_promotion.html",controller:"NewPromotionController"}).when("/promotions/:id/edit",{name:"promotions.edit",templateUrl:"/modules/data_dashboard/templates/edit_promotion.html",controller:"EditPromotionController",resolve:{promotion:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.promotions.getById($route.current.params.id)}]}}).when("/coupons",{name:"coupons.list",templateUrl:"/modules/data_dashboard/templates/coupons.html",controller:"ListResourcesController",resolve:{resources:["$marketcloud","$route",function($marketcloud){return $marketcloud.coupons.list({page:1})}],resourceName:function(){return"coupons"},dependencies:["$q",function($q){return $q.when({})}]}}).when("/coupons/create",{name:"coupons.create",templateUrl:"/modules/data_dashboard/templates/new_coupon.html",controller:"NewCouponController"}).when("/coupons/:id/edit",{name:"coupons.create",templateUrl:"/modules/data_dashboard/templates/edit_coupon.html",controller:"EditCouponController",resolve:{coupon:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.coupons.getById($route.current.params.id)}]}}).when("/shippings",{redirectTo:"/system/shippings"}).when("/shippings/create",{redirectTo:"/system/shippings/create"}).when("/shippings/:shippingId/edit",{redirectTo:"/system/shippings/:shippingId/edit"}).when("/system/taxes",{name:"system.taxes.list",templateUrl:"/modules/data_dashboard/templates/taxes.html",controller:"ListResourcesController",resolve:{resources:["$marketcloud","$route",function($marketcloud){return $marketcloud.taxes.list()}],resourceName:function(){return"taxes"},dependencies:["$q",function($q){return $q.when({})}]}}).when("/system/taxes/create",{name:"system.taxes.create",templateUrl:"/modules/data_dashboard/templates/new_tax.html",controller:"CreateTaxController"}).when("/system/taxes/:id/edit",{name:"system.taxes.edit",templateUrl:"/modules/data_dashboard/templates/edit_tax.html",controller:"EditTaxController",resolve:{tax:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.taxes.getById($route.current.params.id)}]}}).when("/system/shippings",{name:"system.shippings.list",templateUrl:"/modules/data_dashboard/templates/shippings.html",controller:"ListResourcesController",resolve:{resources:["$marketcloud","$route",function($marketcloud){return $marketcloud.shippings.list()}],resourceName:function(){return"shippings"},dependencies:["$q",function($q){return $q.when({})}]}}).when("/system/shippings/create",{name:"system.shippings.create",templateUrl:"/modules/data_dashboard/templates/new_shipping.html",controller:"CreateShippingController"}).when("/system/shippings/:shippingId/edit",{name:"system.shippings.edit",templateUrl:"/modules/data_dashboard/templates/edit_shipping.html",controller:"EditShippingController",resolve:{shipping:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.shippings.getById($route.current.params.shippingId)}]}}).when("/system/settings",{name:"system.settings",templateUrl:"/modules/data_dashboard/templates/settings.html",controller:"SettingsController"}).when("/system/localization",{name:"system.localization",templateUrl:"/modules/data_dashboard/templates/localization.html",controller:"LocalizationController"}).when("/system/payments",{name:"system.payments",templateUrl:"/modules/data_dashboard/templates/paymentMethods.html",controller:"PaymentMethodsController",resolve:{paymentMethods:["$marketcloud","$route",function($marketcloud){return $marketcloud.paymentMethods.list()}]}}).when("/notifications",{name:"notifications",templateUrl:"/modules/data_dashboard/templates/notifications.html",controller:"NotificationsController",resolve:{notifications:["$marketcloud","$route",function($marketcloud){return $marketcloud.notifications.list()}]}}).when("/notifications/:notificationId/edit",{name:"notifications.edit",templateUrl:"/modules/data_dashboard/templates/edit_notification.html",controller:"EditNotificationController",resolve:{notification:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.notifications.getById($route.current.params.notificationId)}]}}).when("/notifications/:notificationId/translations",{name:"notifications.translation",templateUrl:"/modules/data_dashboard/templates/notifications_translation.html",controller:"TranslateNotificationController",resolve:{notification:["$marketcloud","$route",function($marketcloud,$route){return $marketcloud.notifications.getById($route.current.params.notificationId)}]}}).when("/notifications/create",{name:"notifications.create",templateUrl:"/modules/data_dashboard/templates/new_notification.html",controller:"NewNotificationController"}).when("/notifications/preview/:data",{name:"notifications.preview",templateUrl:"/modules/data_dashboard/templates/notifications_preview.html",controller:"PreviewNotificationController",resolve:{notification:["$route",function($route){return atob($route.current.params.data)}]}}).when("/application/billing",{name:"application.billing",templateUrl:"/modules/data_dashboard/templates/application/application_billing.html",controller:"ApplicationBillingController",resolve:{account:["$http",function(http){return http({method:"GET",url:"/account/get"})}]}}).when("/application",{redirectTo:"/application/overview",acl:{deny:["guest"]}}).when("/application/overview",{name:"application.overview",acl:{deny:["guest"]},templateUrl:"/modules/data_dashboard/templates/application/application_overview.html",controller:"ApplicationOverviewController"}).when("/application/settings",{name:"application.settings",acl:{deny:["guest"]},templateUrl:"/modules/data_dashboard/templates/application/application_settings.html",controller:"ApplicationSettingsController"}).when("/application/deploy",{name:"application.deploy",acl:{deny:["guest"]},templateUrl:"/modules/data_dashboard/templates/application/application_deploy.html",controller:"DeployController"}).when("/application/integrations",{name:"application.integrations",acl:{deny:["guest"]},templateUrl:"/modules/data_dashboard/templates/application/application_integrations.html",controller:"IntegrationsController"}).when("/application/webhooks",{name:"application.webhooks",acl:{deny:["guest"]},templateUrl:"/modules/data_dashboard/templates/application/application_webhooks.html",controller:"WebhooksController",resolve:{webhooks:["$http","$route","$application",function($http,$route,$application){return $http({method:"GET",url:"/applications/"+$application.get("id")+"/webhooks"})}]}}).when("/application/collaborators",{name:"application.collaborators",acl:{deny:["guest"]},templateUrl:"/modules/data_dashboard/templates/application/application_collaborators.html",controller:"CollaboratorsController",resolve:{collaborators:["$http","$route","$application",function($http,$route,$application){return $http({method:"GET",url:"/applications/"+$application.get("id")+"/collaborators"})}]}}).when("/application/acl",{name:"application.acl",acl:{deny:["guest"]},templateUrl:"/modules/data_dashboard/templates/application/roles.html",controller:"ACLController",resolve:{roles:["$http","$route","$application",function($http,$route,$application){return $http({method:"GET",url:"/applications/"+$application.get("id")+"/roles"})}]}}).when("/application/acl/new",{name:"application.acl",acl:{deny:["guest"]},templateUrl:"/modules/data_dashboard/templates/application/new_role.html",controller:"NewRoleController"}).when("/application/acl/:roleId/edit",{name:"application.acl",acl:{deny:["guest"]},templateUrl:"/modules/data_dashboard/templates/application/edit_role.html",controller:"EditRoleController",resolve:{role:["$route","$http","$application",function($route,$http,$application){return $http({method:"GET",url:"/applications/"+$application.get("id")+"/roles/"+$route.current.params.roleId})}]}}).otherwise({redirectTo:"/"})}]),module.exports=app})()},function(module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},app=angular.module("DataDashboard");app.controller("ActiveFiltersController",["$scope","StormConfiguration",function(scope,StormConfiguration){var ctrl=this;scope.newFilter={name:"",value:null};var notFilters=["per_page","page","sort_by","sort_order"];this.$onInit=function(){scope.ctrl=this,scope.ctrl.query=this.query||{},scope.filterAttributes=this.filterAttributes,scope.filters=StormConfiguration.get("products_list_active_filters")||[];for(var k in ctrl.query)notFilters.indexOf(k)===-1&&scope.filters.push({name:k,value:ctrl.query[k]});scope.persistFilters=StormConfiguration.get("products_list_persist_filters")||!1,scope.persistFilters=Boolean(scope.persistFilter)};var inferFilterType=function(key){if("undefined"==typeof scope.ctrl.resources)return null;var _resource=scope.ctrl.resources.find(function(item){return item.hasOwnProperty(key)});return _resource?_typeof(_resource[key]):null};scope.isFilterSet=function(key){return scope.filters.filter(function(filter){return filter.name===key}).length>0},scope.filterIsNotEmpty=function(item,index,array){return""!==item.name&&null!==item.value},scope.getControlForFilter=function(filter){return"type"===filter.name?"productTypeSelector":"category_id"===filter.name?"categorySelectorInput":"brand_id"===filter.name?"brandSelectorInput":"number"===inferFilterType(filter.name)?"numberInput":"string"===inferFilterType(filter.name)?"textInput":"boolean"===inferFilterType(filter.name)?"booleanInput":"disabledInput"},scope.addFilter=function(filter){filter?scope.filters.push(filter):scope.filters.push({name:"",value:null})},scope.saveNewFilterAndApply=function(){scope.addFilter(scope.newFilter),console.log("Saving this new filters",scope.newFilter),scope.applyFilters(),scope.newFilter={name:"",value:null},$("#singleFilterModal").modal("hide")},scope.humanReadableFilterValue=function(filter){return"object"===_typeof(filter.value)&&filter.value.hasOwnProperty("$regex")?filter.value.$regex:"type"===filter.name?filter.value.replace(/\_/g," "):filter.value},scope.removeFilter=function(index,applyToQuery){"undefined"==typeof applyToQuery&&(applyToQuery=!0);var filterToRemove=scope.filters.splice(index,1);filterToRemove=filterToRemove[0],delete scope.ctrl.query[filterToRemove.name],applyToQuery===!0&&scope.applyFilters()},scope.applyFilters=function(){scope.filters.forEach(function(filter){scope.ctrl.query[filter.name]=filter.value}),ctrl.onUpdate({filters:scope.filters}),$("#filtersModal").modal("hide"),StormConfiguration.set("products_list_active_filters",scope.filters)}}]),app.component("activeFilters",{templateUrl:"/modules/data_dashboard/src/components/activeFilters/activeFilters.component.html",controller:"ActiveFiltersController",bindings:{query:"=",filterAttributes:"=",onUpdate:"&",resources:"="}})},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("addProductsCardController",["$scope","$element","$attrs","$marketcloud",function(scope,$element,$attrs,$marketcloud){this.$onInit=function(){scope.ctrl=this,scope.config=this.config||{additionalFields:[]},scope.swapArrayItemPosition=function(sourceIndex,destinationIndex,arr){if(arr[sourceIndex]&&arr[destinationIndex]){var temp=angular.copy(arr[destinationIndex]);arr[destinationIndex]=arr[sourceIndex],arr[sourceIndex]=temp}},scope.showTheList=!1,scope.query={},scope.products=[]},scope.prepareRegex=function(){scope.query.name.$options="i"},scope.showList=function(){scope.showTheList=!0},scope.hideList=function(){window.setTimeout(function(){scope.showTheList=!1,scope.$apply()},200)},scope.addProduct=function(product){scope.ctrl.items.push(product),scope.query.name.$regex="",scope.products=[]},scope.removeProduct=function(i){scope.ctrl.items.splice(i,1)},scope.loadProducts=function(query){if(query=query||scope.query,scope.ctrl.overrides)for(var k in scope.ctrl.overrides)query[k]=scope.ctrl.overrides[k];$marketcloud.products.list(query).then(function(response){scope.products=response.data.data.filter(function(item){return scope.ctrl.items.map(function(i){return i.id}).indexOf(item.id)<0})}).catch(function(response){notie.alert(3,"An error has occurred. Please try again",1.5)})}}]),app.component("addProductsCard",{templateUrl:"/modules/data_dashboard/src/components/addProductsCard/addProductsCard.component.html",controller:"addProductsCardController",bindings:{items:"=",config:"=",overrides:"=",title:"@",onUpdate:"&"}})},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("AddressFormController",["$scope","Countries",function($scope,Countries){this.$onInit=function(){$scope.countries=Countries,$scope.address=this.address}}]),app.component("addressForm",{templateUrl:"/modules/data_dashboard/src/components/addressForm/addressForm.component.html",controller:"AddressFormController",bindings:{address:"="}})},function(module,exports){"use strict";var app=angular.module("DataDashboard"),ApplicationController=["$scope",function(scope){this.$onInit=function(){scope.application=this.applicationData},scope.percentage=function(app){var v=app.api_calls_quota_left,t=app.api_calls_quota_max;return v/t*100}}];app.component("application",{templateUrl:"/modules/data_dashboard/src/components/application/application.component.html",controller:ApplicationController,bindings:{applicationData:"="}})},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("autocompleteController",["$scope","$element","$attrs",function(scope,$element,$attrs){this.$onInit=function(){scope.ctrl=this,scope.ctrl.suggestionList=angular.copy(scope.ctrl.items),scope.showTheList=!1;var initiallySelected=scope.ctrl.suggestionList.filter(function(item){return item===scope.ctrl.myModel||item[scope.ctrl.value]===scope.ctrl.myModel});initiallySelected.length>0&&scope.selectItem(initiallySelected[0])},scope.filter=function(){var toMatch=scope.ctrl.selectedLabel.toLowerCase();scope.ctrl.items=scope.ctrl.suggestionList.filter(function(i){return scope.ctrl.value?i[scope.ctrl.value].toLowerCase().indexOf(toMatch)>-1:i.toLowerCase().indexOf(toMatch)>-1})},scope.showList=function(){scope.showTheList=!0},scope.hideList=function(){window.setTimeout(function(){scope.showTheList=!1,scope.$apply()},200)},scope.handleNewItems=function(){scope.ctrl.allowNewElements&&(scope.ctrl.myModel=scope.ctrl.selectedLabel,scope.hideList())},scope.selectItem=function(item){console.log("selectItem called on ",item),scope.ctrl.label?scope.ctrl.selectedLabel=item[scope.ctrl.label]:scope.ctrl.selectedLabel=item,scope.ctrl.value?scope.ctrl.myModel=item[scope.ctrl.value]:scope.ctrl.myModel=item,scope.showTheList=!1,window.setTimeout(scope.ctrl.onSelected,1)}}]),app.component("autocomplete",{templateUrl:"/modules/data_dashboard/src/components/autocomplete/autocomplete.component.html",controller:"autocompleteController",bindings:{allowNewElements:"@",myModel:"=",items:"=",onSelected:"&",label:"@",value:"@",inputClasses:"@"}})},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("BackButtonController",["$scope","$element","$attrs",function(scope,$element,$attrs){scope.goBack=function(){history.back()}}]),app.component("backButton",{template:'<a class="link pull-right" ng-click="goBack()"><i class="fa fa-long-arrow-left"></i> <span class="xs-hidden">Back</span></a>',controller:"BackButtonController",bindings:{}})},function(module,exports){"use strict";function BrandsSelectorController($marketcloud,scope,$elem){function initializeData(){$marketcloud.brands.list().then(function(response){ctrl.brands=response.data.data;var currentBrand=null;return ctrl.brands.forEach(function(brand){brand.id===scope.ctrl.brand&&(currentBrand=brand)}),null===currentBrand?$marketcloud.brands.getById(scope.ctrl.brand):void(scope.brand=currentBrand)}).then(function(response){response.data.data&&(scope.brand=response.data.data)}).catch(function(response){ctrl.onError(response)})}var ctrl=null;this.$onInit=function(){ctrl=this,scope.ctrl=ctrl,scope.newBrand={},ctrl.modal=$($elem).find(".modal")[0],scope.enableCreateBrand=this.enableCreateBrand||!0,scope.ctrl.query={name:{$regex:"",$options:"i"}}},scope.showModal=function(){$(ctrl.modal).modal("show")},scope.saveBrand=function(){$marketcloud.brands.save(scope.newBrand).then(function(response){return scope.ctrl.brands.push(response.data.data),scope.newBrand={},scope.ctrl.brand=response.data.data.id,$marketcloud.brands.list()}).then(function(response){scope.ctrl.brands=response.data.data,$(ctrl.modal).modal("hide")}).catch(function(response){$(ctrl.modal).hide(),notie.alert(3,"An error has occurred. Brand not saved",1)})},scope.setSelectedBrand=function(brand){scope.brand=brand,scope.ctrl.brand=brand.id,scope.ctrl.onChange({brand:brand.id})},scope.filterBrands=function(){$marketcloud.brands.list(scope.ctrl.query).then(function(response){ctrl.brands=response.data.data}).catch(function(error){notie.alert(2,"An error has occurred while fetching brands, please retry.",2)})},initializeData()}angular.module("DataDashboard").controller("BrandsSelectorController",BrandsSelectorController).component("brandsSelector",{templateUrl:"/modules/data_dashboard/src/components/brandsSelector/brandsSelector.component.html",controller:"BrandsSelectorController",bindings:{brand:"=",enableCreateBrand:"@",onError:"&"}}),BrandsSelectorController.$inject=["$marketcloud","$scope","$element"]},function(module,exports){"use strict";function CategoriesSelectorController($marketcloud,scope,$elem){function initializeData(){$marketcloud.categories.list().then(function(response){ctrl.categories=response.data.data;var currentCategory=null;return ctrl.categories.forEach(function(category){category.id===scope.ctrl.category&&(currentCategory=category)}),null===currentCategory?$marketcloud.categories.getById(scope.ctrl.category):void(scope.category=currentCategory)}).then(function(response){response.data.data&&(scope.category=response.data.data)}).catch(function(response){ctrl.onError(response)})}var ctrl=null;this.$onInit=function(){ctrl=this,scope.ctrl=this,scope.newCategory={},ctrl.modal=$($elem).find(".modal")[0],scope.enableCreateCategory=ctrl.enableCreateCategory||!0,scope.ctrl.query={name:{$regex:"",$options:"i"}}},scope.showModal=function(){$(ctrl.modal).modal("show")},initializeData(),scope.setSelectedCategory=function(category){scope.category=category,scope.ctrl.category=category.id,scope.ctrl.onChange({category:category.id})},scope.filterCategories=function(){$marketcloud.categories.list(scope.ctrl.query).then(function(response){ctrl.categories=response.data.data}).catch(function(error){notie.alert(2,"An error has occurred while fetching categories, please retry.",2)})},scope.saveCategory=function(){$marketcloud.categories.save(scope.newCategory).then(function(response){return ctrl.categories.push(response.data.data),scope.newCategory={},ctrl.category=response.data.data.id,$marketcloud.categories.list()}).then(function(response){ctrl.categories=response.data.data,$(ctrl.modal).modal("hide")}).catch(function(response){$(ctrl.modal).hide(),notie.alert(3,"An error has occurred. Category not saved",1)})}}angular.module("DataDashboard").controller("CategoriesSelectorController",CategoriesSelectorController).component("categoriesSelector",{templateUrl:"/modules/data_dashboard/src/components/categoriesSelector/categoriesSelector.component.html",controller:"CategoriesSelectorController",bindings:{enableCreateCategory:"@",category:"=",onError:"&",onChange:"&"}}),CategoriesSelectorController.$inject=["$marketcloud","$scope","$element"]},function(module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},app=angular.module("DataDashboard");app.controller("CustomAttributesFormController",["$scope","$element","$attrs","moment",function(scope,$element,$attrs,$moment){function computePropertiesTypes(){for(var k in scope.properties)scope.propertiesTypes[k]=_typeof(scope.properties[k]),scope.isNull(k)===!0&&(scope.propertiesTypes[k]="null"),scope.isRichText(scope.properties[k])===!0&&(scope.propertiesTypes[k]="richtext"),scope.isURL(scope.properties[k])===!0&&(scope.propertiesTypes[k]="URL",scope.containersForExistingMediaAttributes[k]=[scope.properties[k]],scope.$watchCollection("containersForExistingMediaAttributes."+k,function(){null!==scope.properties[k]&&scope.containersForExistingMediaAttributes[k]&&(scope.properties[k]=scope.containersForExistingMediaAttributes[k][scope.containersForExistingMediaAttributes[k].length-1])}))}this.$onInit=function(){scope.ctrl=this,scope.resource=this.resource,scope.properties=this.properties||{},scope.rootObject=scope.properties,scope.newAttribute={name:null,value:null,type:null},computePropertiesTypes(),scope.resetNewAttributeValue=function(){switch(scope.newAttribute.type){case"string":return void(scope.newAttribute.value="");case"number":return void(scope.newAttribute.value=0);case"boolean":scope.newAttribute.value=!0}},scope.newAttribute.type="string",scope.availableTypes=[{name:"String",value:"string"},{name:"Number",value:"number"},{name:"Boolean",value:"boolean"},{name:"RichText",value:"richtext"},{name:"URL/Media",value:"URL"}]},scope.containerForNewMediaAttribute=[],scope.containersForExistingMediaAttributes={},scope.$watchCollection("containerForNewMediaAttribute",function(){scope.newAttribute.value=scope.containerForNewMediaAttribute[scope.containerForNewMediaAttribute.length-1]}),scope.propertiesTypes={},scope.isBoolean=function(d){return"boolean"==typeof d},scope.isString=function(d){return"string"==typeof d&&!scope.isRichText(d)&&!scope.isURL(d)},scope.isNull=function(key){return null===scope.properties[key]},scope.isURL=function(d){return!(!d||"function"!=typeof d.indexOf)&&(0===d.indexOf("http://")||0===d.indexOf("https://"))},scope.isRichText=function(str){if("string"!=typeof str)return!1;var doc=(new DOMParser).parseFromString(str,"text/html");return[].slice.call(doc.body.childNodes).some(function(node){return 1===node.nodeType})},scope.isNumber=function(d){return"number"==typeof d},scope.isObject=function(d){return null!==d&&"object"===("undefined"==typeof d?"undefined":_typeof(d))},scope.typeof=function(o){return"undefined"==typeof o?"undefined":_typeof(o)},scope.hasCustomProperties=function(){return Object.keys(scope.properties).length>0},scope.addCustomProperty=function(){scope.errorMessage=null,scope.resource.hasOwnProperty(scope.newAttribute.name)?scope.errorMessage="Name already exists":scope.newAttribute.name?(scope.properties[scope.newAttribute.name]=scope.newAttribute.value,scope.newAttribute.value=null,scope.newAttribute.name=null,computePropertiesTypes()):scope.errorMessage="Please, enter a valid property name"},scope.deleteCustomProperty=function(propertyName){scope.properties[propertyName]=null,computePropertiesTypes()},scope.propertiesStack=[],scope.showRecursiveObjectEditor=function(propertyName){scope.propertiesStack.push(propertyName),scope.properties=scope.rootObject;for(var i=0;i<scope.propertiesStack.length&&scope.properties.hasOwnProperty(scope.propertiesStack[i]);i++)scope.properties=scope.properties[scope.propertiesStack[i]];computePropertiesTypes()},scope.goToNestedStep=function(index){scope.properties=scope.rootObject,scope.propertiesStack=scope.propertiesStack.slice(0,index);for(var i=0;i<index&&scope.properties.hasOwnProperty(scope.propertiesStack[i]);i++)scope.properties=scope.properties[scope.propertiesStack[i]];computePropertiesTypes()}}]),app.component("customAttributesForm",{templateUrl:"/modules/data_dashboard/src/components/customAttributes/customAttributes.component.html",controller:"CustomAttributesFormController",bindings:{properties:"=",resource:"=",onError:"&",disableAdd:"=",removeCardFrame:"@?"}})},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("DashboardBreadcrumbController",["$scope","$element","$attrs",function(scope,$element,$attrs){scope.goBack=function(){history.back()}}]),app.component("dashboardBreadcrumb",{template:'<a href="#" class="link pull-right"><i class="fa fa-long-arrow-left"></i> Back</a>',controller:"DashboardBreadcrumbController",bindings:{resourceName:"="}})},function(module,exports){"use strict"},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("McDataTableController",["$scope",function(scope){this.$onInit=function(){var ctrl=this;scope.ctrl=ctrl,scope.columns=ctrl.columns||Object.keys(scope.ctrl.data[0])}}]),app.component("mcDataTable",{templateUrl:"/modules/data_dashboard/src/components/dataTable/dataTable.component.html",controller:"McDataTableController",bindings:{data:"=",columns:"=?"}})},function(module,exports){"use strict";function ErrorMessagesController(scope,Models){if(!Models)throw new Error("ErrorMessages Component requires Models factory. errorMessages.component.js");var ctrl=null;this.$onInit=function(){if(ctrl=this,scope.ctrl=ctrl,ctrl.modelName){if(!Models.hasOwnProperty(ctrl.modelName))throw new Error("Cannot find model with name "+ctrl.modelName);ctrl.schema=angular.copy(Models[ctrl.modelName].schema),ctrl.schema||console.log("Lo schema non ha il mio model "+ctrl.modelName,Models)}},this.$onChanges=function(changes){var validation=changes.validation.currentValue;validation.invalidPropertyName===this.propertyName&&$("html, body").animate({scrollTop:$("[property-name='"+validation.invalidPropertyName+"']").offset().top-200},500)}}angular.module("DataDashboard").controller("ErrorMessagesController",ErrorMessagesController).component("errorMessages",{templateUrl:"/modules/data_dashboard/src/components/errorMessages/errorMessages.component.html",controller:"ErrorMessagesController",bindings:{validation:"<",propertyName:"@",modelName:"@",onError:"&",messageMin:"@",messageMax:"@",messageRequired:"@",messageType:"@"}}),ErrorMessagesController.$inject=["$scope","$models"]},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("FlagIconController",["$scope","Countries",function(scope,countries){var ctrl=this;this.$onInit=function(){var countryObject=countries.find(function(item){return item.name.toLowerCase()===ctrl.country.toLowerCase()});countryObject?ctrl.countryCode=countryObject.code:ctrl.countryCode=ctrl.country},scope.getFlagClassName=function(){return"flag-icon-"+ctrl.countryCode.toLowerCase()}}]),app.component("flagIcon",{template:'<span class="flag-icon" ng-class="getFlagClassName()"></span>',controller:"FlagIconController",bindings:{country:"@"}})},function(module,exports){"use strict";var ImageSelectorControllerDependencies=["$scope","FileUploader","$http","$element","$attrs","$exceptionHandler","$marketcloud"],ImageSelectorController=function(scope,FileUploader,$http,$element,$attrs,$exceptionHandler,$marketcloud){var ctrl=null;this.$onInit=function(){ctrl=this,ctrl.images=ctrl.images||[],scope.closeOnUploadComplete=$attrs.closeOnUploadComplete,scope.buttonClass=$attrs.buttonClass,scope.buttonText=$attrs.buttonText,scope.buttonIcon=$attrs.buttonIcon||null;var tabs=$attrs.tabs||"library,from_disk,from_url";scope.tabs=tabs.split(",")},scope.uploader=new FileUploader({url:window.API_BASE_URL+"/media",arrayKey:"",headers:{Authorization:window.public_key+":"+window.token},filters:[]}),scope.closeDialog=function(){ctrl.onCloseDialog()},scope.openDialog=function(){ctrl.onOpenDialog()},scope.uploadImages=function(){ctrl.onUploadImages()},scope.image={},scope.media_files=[],scope.loadingMediaFiles=!1,scope.query={},scope.pagination=null,scope.loadMedias=function(query){scope.media_files=[],scope.loadingMediaFiles=!0,$marketcloud.media.list(query||{}).then(function(response){scope.loadingMediaFiles=!1,scope.media_files=response.data.data,scope.pagination={currentPage:response.data.page,numberOfPages:response.data.pages,nextPage:response.data._links.next||null,previousPage:response.data._links.prev||null,count:response.data.count}}).catch(function(response){scope.loadingMediaFiles=!1,notie.alert(2,"An error has occurred, please retry.",1.5)})},scope.loadPage=function(page_number){return scope.query.page=page_number,scope.loadData()},scope.loadMore=function(){var pageToFetch=scope.media_files.length/20+1;$marketcloud.media.list({page:pageToFetch}).then(function(response){scope.loadingMediaFiles=!1,scope.media_files=scope.media_files.concat(response.data.data)}).catch(function(response){scope.loadingMediaFiles=!1,notie.alert(2,"An error has occurred, please retry.",1.5)})},scope.loadData=function(query){scope.media_files=[],scope.loadingMediaFiles=!0,query||(query=scope.query||{}),$marketcloud.media.list(query).then(function(response){scope.loadingMediaFiles=!1,scope.media_files=response.data.data,scope.pagination={currentPage:response.data.page,numberOfPages:response.data.pages,nextPage:response.data._links.next||null,previousPage:response.data._links.prev||null,count:response.data.count}}).catch(function(response){scope.loadingMediaFiles=!1,notie.alert(3,"An error has occurred. Please try again.",1.5)})},0===scope.media_files.length&&scope.loadMedias(),scope.showProgressBar=!1,scope.uploadingImages=!1,scope.howManySelectedMedia=function(){return ctrl.images.length},scope.addSelectedFromLibrary=function(){var modal=$element.find("#ImageSelectorModal");$(modal).modal("hide")},scope.isImageSelected=function(image){return ctrl.images.indexOf(image.url)>-1},scope.selectImage=function(image){ctrl.image=image.url,scope.closeDialog();var modal=$element.find("#ImageSelectorModal");$(modal).modal("hide")};scope.uploader.onCompleteAll=function(){if(scope.loadMedias(),scope.showProgressBar=!1,scope.uploadingImages=!1,scope.uploader.clearQueue(),"true"===scope.closeOnUploadComplete){scope.closeDialog();var modal=$element.find("#ImageSelectorModal");$(modal).modal("hide")}ctrl.onUploadComplete&&ctrl.onUploadComplete()},scope.uploader.onProgressAll=function(progress){},scope.uploader.onErrorItem=function(item,response,status,headers){var err=new Error("Error uploading an item");err.response=response,err.status=status,err.headers=headers,$exceptionHandler(err)},scope.chooseFileFromStorage=function(){$("#chooseFileFromStorageButton").trigger("click")},scope.uploadSelectedImages=function(){scope.showProgressBar=!0,scope.uploadingImages=!0,scope.uploader.uploadAll()},scope.addImageFromUrl=function(){ctrl.images.push(scope.image.url),scope.image.url=null},scope.showImageSelectorModal=function(){var modal=$element.find("#ImageSelectorModal");$(modal).modal("show"),scope.openDialog()}};ImageSelectorController.$inject=ImageSelectorControllerDependencies,angular.module("DataDashboard").controller("ImageSelectorController",ImageSelectorController),angular.module("DataDashboard").component("imageSelector",{templateUrl:"/modules/data_dashboard/src/components/imageSelector/imageSelector.component.html",controller:"ImageSelectorController",bindings:{onCloseDialog:"&",onOpenDialog:"&",onUploadComplete:"&",image:"=?",buttonClass:"@",buttonIcon:"@",buttonText:"@",closeOnUploadComplete:"@"}})},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("ImageThumbnailController",["$scope","$element","$attrs",function(scope,$element,$attrs){this.$onInit=function(){scope.ctrl=this,scope.ctrl.showOverlay=!1},scope.edit=function(){scope.ctrl.onEdit(),$element.find("#editImageModal").modal("show")},scope.delete=function(){scope.ctrl.onDelete()},scope.zoom=function(){$element.find("#zoomImageModal").modal("show")},scope.showOverlay=function(){
scope.ctrl.showOverlay=!0},scope.hideOverlay=function(){scope.ctrl.showOverlay=!1},scope.toggleEditImageModal=function(image){$element.find("#editImageModal").modal("hide")}}]),app.component("imageThumbnail",{templateUrl:"/modules/data_dashboard/src/components/imageThumbnail/imageThumbnail.component.html",controller:"ImageThumbnailController",bindings:{imageSrc:"=",image:"=",onEdit:"&",onDelete:"&"}})},function(module,exports){"use strict";function ImagesCardController(scope){var ctrl=null;this.$onInit=function(){ctrl=this,scope.ctrl=ctrl},scope.swapArrayItemPosition=function(fromIndex,toIndex,target){var toMove=JSON.parse(JSON.stringify(target[fromIndex]));fromIndex>target.length-1||(target.splice(fromIndex,1),target.splice(toIndex,0,toMove))},scope.removeImage=function(i){var removed=scope.ctrl.items.splice(i,1);scope.ctrl.onRemove(removed[0])}}ImagesCardController.$inject=["$scope"],angular.module("DataDashboard").controller("ImagesCardController",ImagesCardController).component("imagesCard",{templateUrl:"/modules/data_dashboard/src/components/imagesCard/imagesCard.component.html",controller:"ImagesCardController",bindings:{items:"=",onRemove:"&",removeCardFrame:"@?"}})},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("LinkHelpTextController",["$scope","$element","$attrs",function(scope,$element,$attrs){this.$onInit=function(){scope.ctrl=this,scope.ctrl.text=this.text,scope.ctrl.label=this.label,scope.showHelpText=!1},scope.toggleHelpText=function(){scope.showHelpText=!scope.showHelpText}}]),app.component("linkHelpText",{templateUrl:"/modules/data_dashboard/src/components/linkHelpText/linkHelpText.component.html",controller:"LinkHelpTextController",bindings:{text:"@",label:"@"}})},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("NavbarController",["$scope","$application","$account",function($scope,$application,$account){$scope.application=$application.get(),$scope.user=$account.get()}]),app.component("navbar",{templateUrl:"/modules/data_dashboard/src/components/navbar/navbar.component.html",controller:"NavbarController",bindings:{}})},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("PaginationNavController",["$scope","$element","$attrs","$marketcloud",function(scope,$element,$attrs,$marketcloud){this.$onInit=function(){scope.ctrl=this},scope.loadPage=function(page_number){scope.ctrl.onChangePage({page:page_number})},scope.getListOfPages=function(){var np=scope.ctrl.pagination.numberOfPages,cp=scope.ctrl.pagination.currentPage,arr=[],initialPage=cp-2;initialPage<=0&&(initialPage=1);var lastPage=cp+2;lastPage>np&&(lastPage=np);for(var i=initialPage;i<lastPage;i++)arr.push(i);return arr}}]),app.component("paginationNav",{templateUrl:"/modules/data_dashboard/src/components/paginationNav/paginationNav.component.html",controller:"PaginationNavController",bindings:{pagination:"=",onChangePage:"&"}})},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("PaginationSelectorController",["$scope",function(scope){var ctrl=this;this.$onInit=function(){scope.ctrl=this,scope.ctrl.perPage=this.perPage||this.config.defaultPageSize,scope.ctrl.page=this.page||this.config.defaultPageNumber,this.updatePageCounters()},this.$onChanges=function(changes){changes.pagination&&(ctrl.pagination=changes.pagination.currentValue,scope&&scope.ctrl&&ctrl.updatePageCounters())},this.updatePageCounters=function(){scope.pages=[];for(var i=1;i<=this.pagination.numberOfPages;i++)scope.pages.push(i);scope.first=(scope.ctrl.page-1)*scope.ctrl.perPage+1,scope.last=scope.ctrl.page*scope.ctrl.perPage-1,scope.last>scope.ctrl.pagination.count&&(scope.last=scope.ctrl.pagination.count)},this.config={availablePageSizes:[10,20,50,100],defaultPageSize:20,defaultPageNumber:1},scope.setPageSize=function(pageSize){var newSize=scope.ctrl.perPage;pageSize&&(newSize=pageSize),scope.ctrl.onChangePageSize({per_page:newSize}).then(function(){ctrl.updatePageCounters()})},scope.setPageNumber=function(pageNumber){return pageNumber<=0?void console.info("Cannot set page <= 0. Ignoring setPageNumber() call."):pageNumber>scope.ctrl.pagination.numberOfPages?void console.info("Cannot set page > pagination.numberOfPages. Ignoring setPageNumber() call."):void scope.ctrl.onChangePageNumber({page:pageNumber}).then(function(){ctrl.updatePageCounters()})}}]),app.component("paginationSelector",{templateUrl:"/modules/data_dashboard/src/components/paginationSelector/paginationSelector.component.html",controller:"PaginationSelectorController",bindings:{perPage:"=",page:"=",pagination:"<",onChangePageSize:"&",onChangePageNumber:"&"}})},13,function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("SEOFormController",["$scope","$element","$attrs",function(scope,$element,$attrs){this.$onInit=function(){scope.ctrl=this,scope.ctrl.seo=this.seo,scope.activeSeoTab="meta"},scope.showSeoTab=function(tabname){scope.activeSeoTab=tabname}}]),app.component("seoForm",{templateUrl:"/modules/data_dashboard/src/components/seoForm/seoForm.component.html",controller:"SEOFormController",bindings:{seo:"=",removeCardFrame:"@?"}})},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("SidebarController",["$scope","$http","$routeParams","$location","$rootScope","$route","$application","$window","StormConfiguration",function($scope,$http,$params,$location,$root,$route,$application,$window,Configuration){$scope.showingSubSidebar=!1,$scope.currentSidebarSection=null,$scope.currentSection=null,$scope.sidebarIsExpanded=!0,$scope.subEntriesGroupToShow=null,$scope.subSideBars={inventory:!1,system:!1},$scope.StormConfiguration={},$scope.StormConfiguration=Configuration.get(),$scope.$on("$dashboardSectionChange",function($event,args){args.section&&($scope.currentSection=args.section.split(".")[0],$scope.currentSubsection=args.section.split(".")[1]||null,$root.currentSection=args.section.split(".")[0],$root.currentSubsection=args.section.split(".")[1]||null,(args.section.indexOf("system")<0||args.section.indexOf("inventory")<0)&&$scope.hideSubSidebar())}),$scope.switchToApp=function(app_id){var url=($application.get().id,"/applications/"+app_id+"/dashboard#/");window.location.href=url},$scope.showSubEntries=function(id){$scope.subEntriesGroupToShow=id},$scope.hideAllSubEntries=function(){for(var k in $scope.subEntriesGroupShown)$scope.subEntriesGroupShown[k]=!1},$scope.subEntriesGroupShown={inventory:!1,system:!1},this.mql=window.matchMedia("screen and (max-width:1000px)"),this.mql.addListener(function(mq){console.log("matchMedia Listener"),mq.matches?!0===$scope.sidebarIsExpanded&&$scope.toggleSidebar():!1===$scope.sidebarIsExpanded&&$scope.toggleSidebar()}),$scope.toggleSidebar=function(){var movement="-=200",duration=500;$scope.sidebarIsExpanded===!1&&(movement="+=200",$scope.hideAllSubEntries()),$("#page-wrapper").animate({"margin-left":movement},{duration:duration,queue:!1}),$(".dashboard-section-header").animate({left:movement},{duration:duration,queue:!1}),$(".sidebar-footer").animate({left:movement},{duration:duration,queue:!1}),$(".sidebar").not(".sub-sidebar").animate({left:movement},{duration:duration,queue:!1,done:function(){!0===$scope.sidebarIsExpanded?($("a.entry .fa").addClass("pull-right"),$scope.sidebarIsExpanded=!1):($scope.sidebarIsExpanded=!0,$("a.entry .fa").removeClass("pull-right")),$scope.$apply()}})},$scope.toggleSidebar=function(){!0===$scope.sidebarIsExpanded?(angular.element(".sidebar").addClass("collapsed"),angular.element(".sidebar").removeClass("expanded"),angular.element("#page-wrapper").addClass("expanded"),angular.element("#page-wrapper").removeClass("collapsed"),$scope.hideAllSubEntries(),$scope.sidebarIsExpanded=!1):(angular.element(".sidebar").addClass("expanded"),angular.element(".sidebar").removeClass("collapsed"),angular.element("#page-wrapper").addClass("collapsed"),angular.element("#page-wrapper").removeClass("expanded"),$scope.sidebarIsExpanded=!0)},$scope.toggleSubEntries=function(group_id){$scope.currentSection=group_id,!1===$scope.sidebarIsExpanded&&$scope.toggleSidebar(),$scope.subEntriesGroupShown[group_id]=!$scope.subEntriesGroupShown[group_id]},$scope.saveStormConfiguration=function(){for(var k in $scope.StormConfiguration)Configuration.set(k,$scope.StormConfiguration[k],!0);$scope.StormConfiguration.hasOwnProperty("theme")&&Configuration.applyTheme($scope.StormConfiguration.theme)},$scope.showSubSidebar=function(id){$scope.showingSubSidebar=!0;var sidebars=["inventory","system","contents"];return!(sidebars.indexOf(id)<0)&&void($scope.currentSidebarSection=id)},$scope.hideSubSidebar=function(){$scope.showingSubSidebar=!1}}]),app.component("sidebar",{templateUrl:"/modules/data_dashboard/src/components/sidebar/sidebar.component.html",controller:"SidebarController",bindings:{}})},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("sortingSelectorController",["$scope",function(scope){this.$onInit=function(){scope.ctrl=this,scope.ctrl.query=this.query||{},scope.ctrl.query.sort_by||(scope.ctrl.query.sort_by="id"),scope.ctrl.query.sort_order||(scope.ctrl.query.sort_order="DESC"),scope.ctrl.resourceAttributes=this.resourceAttributes||[]},scope.applySorting=function(){console.log("sortingSelector.applySorting",{sort_by:scope.ctrl.query.sort_by,sort_order:scope.ctrl.query.sort_order}),scope.ctrl.onUpdate({sort_by:scope.ctrl.query.sort_by,sort_order:scope.ctrl.query.sort_order}),$("#sortingModal").modal("hide")}}]),app.component("sortingSelector",{templateUrl:"/modules/data_dashboard/src/components/sortingSelector/sortingSelector.component.html",controller:"sortingSelectorController",bindings:{query:"=",resourceAttributes:"=",onUpdate:"&"}})},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("SwitchController",["$scope","$element","$attrs",function(scope,$element,$attrs){this.$onInit=function(){scope.ctrl=this,scope.ctrl.value=this.value,scope.ctrl.theme=$attrs.theme||"info",scope.ctrl.align=$attrs.align||""},$element.on("click",function(){scope.ctrl.readOnly!==!0&&(scope.ctrl.value=!scope.ctrl.value,scope.$apply(),scope.ctrl.onUpdate())})}]),app.component("switch",{templateUrl:"/modules/data_dashboard/src/components/switch/switch.component.html",controller:"SwitchController",bindings:{value:"=",onUpdate:"&",class:"@",align:"@",readOnly:"@"}})},function(module,exports){"use strict";function TaxesSelectorController($marketcloud,scope){this.$onInit=function(){scope.ctrl=this},$marketcloud.taxes.list().then(function(response){scope.ctrl.taxes=response.data.data}).catch(function(response){scope.ctrl.onError(response)})}angular.module("DataDashboard").controller("TaxesSelectorController",TaxesSelectorController).component("taxesSelector",{templateUrl:"/modules/data_dashboard/src/components/taxesSelector/taxesSelector.component.html",controller:"TaxesSelectorController",bindings:{tax:"=",onError:"&",onChange:"&"}}),TaxesSelectorController.$inject=["$marketcloud","$scope"]},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("ToolbarSearchController",["$scope",function(scope){var ctrl=this;scope.searchWord="",this.$onInit=function(){scope.ctrl=this,scope.ctrl.query={},this.propertyName||(this.propertyName="name"),scope.ctrl.query[ctrl.propertyName]={$options:"i",$regex:""}},scope.onQueryChange=function(){return scope.ctrl.query[ctrl.propertyName].$regex=scope.searchWord,scope.ctrl.onUpdate({query:scope.ctrl.query})}}]),app.component("toolbarSearch",{templateUrl:"/modules/data_dashboard/src/components/toolbarSearch/toolbarSearch.component.html",controller:"ToolbarSearchController",bindings:{onUpdate:"&",propertyName:"@"}})},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("PaymentMethodsController",["$scope","$http","$marketcloud","$location","paymentMethods",function(scope,http,$marketcloud,location,paymentMethods){scope.paymentMethods=paymentMethods.data.data,scope.modalMode="update",scope.paymentMethod={name:"",description:"",active:!1},scope.loadPaymentMethods=function(){$marketcloud.paymentMethods.list().then(function(response){scope.paymentMethods=response.data.data}).catch(function(response){notie.alert(3,"An erro has occurred. Please try again.",1.5)})},scope.availableChargeOptions=[{label:"No additional charge",value:"no_cost"},{label:"Fixed fee",value:"fixed_fee"},{label:"Percentage based fee",value:"percentage_fee"},{label:"Fixed plus percentage",value:"fixed_plus_percentage"}],scope.delete=function(payment){payment=payment||scope.payment,$marketcloud.paymentMethods.delete(payment.id).then(function(response){return notie.alert(1,"Payment method deleted.",1.5),scope.payment={},$marketcloud.paymentMethods.list()}).then(function(response){scope.paymentMethods=response.data.data,$("#addManualPaymentMethodModal").modal("hide")}).catch(function(response){notie.alert(3,"An error has occurred, please try again.")})},scope.save=function(){$marketcloud.paymentMethods.save(scope.payment).then(function(response){return notie.alert(1,"Payment method created.",1.5),scope.payment={},$marketcloud.paymentMethods.list()}).then(function(response){scope.paymentMethods=response.data.data,$("#addManualPaymentMethodModal").modal("hide")}).catch(function(response){notie.alert(3,"An error has occurred, please try again.")})},scope.createPayment=function(){scope.modalMode="create",scope.payment={},$("#addManualPaymentMethodModal").modal("show")},scope.editPayment=function(payment){scope.modalMode="update",scope.payment=payment,$("#addManualPaymentMethodModal").modal("show")},scope.update=function(updates){var payload=updates||scope.payment;$marketcloud.paymentMethods.update(scope.payment.id,payload).then(function(response){return notie.alert(1,"Payment method updated.",1.5),$marketcloud.paymentMethods.list()}).then(function(response){scope.paymentMethods=response.data.data,$("#addManualPaymentMethodModal").modal("hide")}).catch(function(response){notie.alert(3,"An error has occurred, please try again.")})},scope.togglePaymentMethod=function(paymentMethod){$marketcloud.paymentMethods.update(paymentMethod.id,paymentMethod).then(function(response){notie.alert(1,"Update successful",1.5)}).catch(function(error){notie.alert(3,"An error has occurred, please try again.",1.5)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("AnalyticsController",["$scope","$http","$routeParams","analytics","moment","carts","customers","$location",function(scope,http,params,analytics,moment,carts,customers,$location){function getDateKeyFromDate(d){var month=String(d.getMonth()+1);month.length<2&&(month="0"+month);var day=d.getFullYear()+"-"+month+"-"+d.getDate();return day}scope.currentRange="This month",$location.search().range&&(scope.currentRange=$location.search().range);var today=new Date;today.setHours(0,0,0,0),today=today.getTime();var yesterday=new Date;yesterday.setDate(yesterday.getDate()-1),yesterday.setHours(0,0,0,0),yesterday=yesterday.getTime();var oneWeekAgo=new Date;oneWeekAgo.setDate(oneWeekAgo.getDate()-7),oneWeekAgo.setHours(0,0,0,0),oneWeekAgo=oneWeekAgo.getTime();var orders=analytics.data.data,salesVolumePerDay={},numberOfOrdersPerDay={};orders.filter(function(x){var invalid_orders=["failed","canceled","refunded"];return invalid_orders.indexOf(x.status)<0}).map(function(x){return{created_at:x.created_at,total:x.total}}).forEach(function(x){var d=new Date(x.created_at),month=String(d.getMonth()+1);month.length<2&&(month="0"+month);var day=d.getFullYear()+"-"+month+"-"+d.getDate();salesVolumePerDay[day]||(salesVolumePerDay[day]=0),salesVolumePerDay[day]+=x.total,numberOfOrdersPerDay[day]||(numberOfOrdersPerDay[day]=0),numberOfOrdersPerDay[day]++});var goodOrders=orders.filter(function(x){var invalid_orders=["failed","canceled","refunded"];return invalid_orders.indexOf(x.status)<0}),ordersPerDay={},d=new Date;switch(scope.currentRange.toLowerCase()){case"this month":for(var i=1;i<30;i++){var key=getDateKeyFromDate(d);ordersPerDay[key]=[],d.setDate(d.getDate()-i)}break;case"this week":for(var i=1;i<7;i++){var key=getDateKeyFromDate(d);ordersPerDay[key]=[],d.setDate(d.getDate()-i)}break;case"yesterday":var yesterday=new Date;yesterday.setDate(yesterday.getDate()-1);var key=getDateKeyFromDate(yesterday);ordersPerDay[key]=[];break;case"today":var today=new Date,key=getDateKeyFromDate(today);ordersPerDay[key]=[]}goodOrders.forEach(function(order){var d=new Date(order.created_at),day=getDateKeyFromDate(d);ordersPerDay[day]?ordersPerDay[day].push(order):ordersPerDay[day]=[order]}),scope.dateLabels=Object.keys(ordersPerDay),scope.formattedDateLabels=scope.dateLabels.map(function(label){return moment(label,"YYYY-M-DD").format("MMM Do")}),scope.ordersVolumePerDay=[],scope.ordersCountPerDay=[],scope.dateLabels.forEach(function(date){var numberOfOrdersThisDate=ordersPerDay[date].length,salesThisDate=ordersPerDay[date].map(function(order){return order.total}).reduce(function(a,b){return a+b},0);scope.ordersCountPerDay.push(numberOfOrdersThisDate),scope.ordersVolumePerDay.push(salesThisDate)}),scope.totalOrdersValue=goodOrders.map(function(order){return order.total}).reduce(function(a,b){return a+b},0).toFixed(2),scope.totalOrdersCount=goodOrders.length,scope.chartOptions={scaleLabel:"<%= Number(value).toFixed(2).replace('.',',') %> "+scope.application.currency_code},scope.chartOptions={scales:{xAxes:[{gridLines:{display:!1}}],yAxes:[{scaleLabel:{display:!0,labelString:scope.application.currency_code}}]}},carts=carts.data.data,customers=customers.data.data,scope.totalCustomersCount=customers.length;var totalCartsCount=carts.length;scope.totalCartsCount=totalCartsCount;var abandonedCarts=carts.filter(function(cart){return"open"===cart.status&&cart.items.length>0}),abandonedCartsCount=abandonedCarts.length,emptyCartsCount=carts.filter(function(cart){return"open"===cart.status&&0===cart.items.length}).length,convertedCartsCount=carts.filter(function(cart){return"closed"===cart.status}).length;scope.abandonedCartsTotalValue=abandonedCarts.map(function(cart){return cart.total}).reduce(function(a,b){return a+b},0),scope.CartsDatasets=[abandonedCartsCount,emptyCartsCount,convertedCartsCount],scope.CartsLabels=["Abandoned","Empty","Converted"],scope.CartsChartOptions={legend:{display:!0,position:"bottom"}},scope.setCurrentTimeRange=function(range){return range=range.toLowerCase(),scope.currentRange=range,$location.path("/analytics").search("range",range)};var totalCartValue=carts.map(function(cart){return cart.total}).reduce(function(a,b){return a+b},0);scope.averageCartValue=0,totalCartValue>0&&(scope.averageCartValue=(totalCartValue/carts.length).toFixed(2));var totalOrdersValue=orders.map(function(order){return order.total}).reduce(function(a,b){return a+b},0);scope.averageOrderValue=0,totalOrdersValue>0&&(scope.averageOrderValue=(totalOrdersValue/orders.length).toFixed(2))}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("EditRoleController",["$scope","$http","$application","$rootScope","rolePresets","role","$location",function(scope,http,$application,rootScope,rolePresets,role,location){var application=$application.get();scope.application=application,rootScope.currentSection="application.collaborators",scope.role=role.data.data,scope.preset_name="public",scope.errors={},scope.presets=rolePresets,scope.applyPreset=function(){if(scope.presets.hasOwnProperty(scope.preset_name))for(var k in scope.presets[scope.preset_name])scope.role.endpoints[k]=scope.presets[scope.preset_name][k]},scope.clearErrors=function(){scope.errors={}},scope.formHasErrors=function(){return Object.keys(scope.errors).length>0};var validateRole=function(){return scope.clearErrors(),scope.role.name.length>253?(scope.errors.name="Name too long",!1):!(scope.role.name.length<1)||(scope.errors.name="Name too short",!1)};scope.updateRole=function(){validateRole()&&http({method:"PUT",url:"/applications/"+scope.application.id+"/roles/"+scope.role.id,data:scope.role}).then(function(response){notie.alert(1,"Role successfuly created.",1.5),location.path("#/application/acl")}).catch(function(error){notie.alert(2,"An error has occurred, please try again.",1.5)})}}]),app.controller("NewRoleController",["$scope","$http","$application","$rootScope","rolePresets","$location",function(scope,http,$application,rootScope,rolePresets,location){var application=$application.get();scope.application=application,rootScope.currentSection="application.acl",scope.preset_name="public",scope.errors={},scope.newRole={name:"",description:"",endpoints:angular.copy(rolePresets.public)},scope.presets=rolePresets,scope.applyPreset=function(){if(scope.presets.hasOwnProperty(scope.preset_name))for(var k in scope.presets[scope.preset_name])scope.newRole.endpoints[k]=scope.presets[scope.preset_name][k]},scope.clearErrors=function(){scope.errors={}},scope.formHasErrors=function(){return Object.keys(scope.errors).length>0};var validateRole=function(){return scope.clearErrors(),scope.newRole.name.length>253?(scope.errors.name="Name too long",!1):!(scope.newRole.name.length<1)||(scope.errors.name="Name too short",!1)};scope.saveRole=function(){validateRole()&&http({method:"POST",url:"/applications/"+scope.application.id+"/roles",data:scope.newRole}).then(function(response){notie.alert(1,"Role successfuly created.",1.5),location.path("/applications/"+scope.application.id+"/acl")}).catch(function(error){notie.alert(2,"An error has occurred, please try again.",1.5)})}}]),app.controller("ACLController",["$scope","$http","roles","$application","$rootScope",function(scope,http,roles,$application,rootScope){var application=$application.get();scope.application=application,rootScope.currentSection="application.acl",scope.roles=roles.data.data,scope.load=function(){http({method:"GET",url:"/applications/"+scope.application.id+"/roles"}).then(function(response){scope.roles=response.data.data}).catch(function(response){notie.alert(2,"An error has occurred while reloading roles.",1)})},scope.delete=function(role){http({method:"DELETE",url:"/applications/"+scope.application.id+"/roles/"+role.id}).then(function(response){notie.alert(1,"Role correctly deleted",1),scope.load()}).catch(function(response){notie.alert(3,"An error has occurred, role not deleted",1)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("CreateApplicationController",["$scope","$http","$location","$rootScope",function(scope,http,location,$rootScope){scope.application={},scope.create=function(){scope._invalid=null;var validation=window.Models.Application.validate(scope.application);!1===validation.valid&&(scope._invalid=validation.invalidPropertyName),http({method:"POST",url:"/applications",data:scope.application}).then(function(response){notie.alert(1,"Application created",1.5),location.path("#/applications/list")}).catch(function(error){notie.alert(3,"An error has occurred, please try again",1.5)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("ListApplicationsController",["$scope",function(scope){scope.applications=window.applications}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("ApplicationBillingController",["$scope","$http","$rootScope","$application","$account",function(scope,http,rootScope,$application,$account){var application=$application.get();scope.application=application,rootScope.currentSection="application.billing",scope.step=1,scope.selected_plan=null,scope.error=null,scope.invalidPropertyName=null,scope.card={},scope.creditCardFormState="idle",scope.showYearlyPlans=!1,scope.goToStep=function(step){scope.step=step},scope.account=$account.get(),scope.selectPlan=function(plan_id){scope.plans.forEach(function(plan){plan.id===plan_id&&(scope.selected_plan=plan)}),console.log("selected_plan",scope.selected_plan),scope.goToStep(2)};scope.updateApplicationSubscription=function(){scope.creditCardFormState="processing",http({method:"PUT",url:"/applications/"+application.id+"/billing",data:{plan_id:scope.selected_plan.id}}).then(function(response){scope.goToStep(3),scope.creditCardFormState="success"}).catch(function(error){console.log(error),scope.error=error,notie.alert(2,error.data.errors[0].message||"Payment failed, please check your billing information."),scope.creditCardFormState="error"})},scope.filterByInterval=function(value,index,arr){return scope.showYearlyPlans===!0?"yearly"===value.interval:"monthly"===value.interval},scope.plans=[],http.get("/applications/"+scope.application.id+"/plans").then(function(response){console.log("PLANS",response.data),scope.plans=response.data.data,scope.plans.forEach(function(plan){plan.api_calls_quota_max=plan.api_calls_quota_max/1e3,plan.api_calls_quota_max=plan.api_calls_quota_max+"K"})}).catch(function(error){console.log(error)})}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("CollaboratorsController",["$scope","$http","collaborators","$application","$rootScope",function(scope,http,collaborators,$application,rootScope){var application=$application.get();scope.application=application,rootScope.currentSection="application.collaborators",scope.mode=null,scope.collaborators=collaborators.data.data,scope.load=function(){http({method:"GET",url:"/applications/"+scope.application.id+"/collaborators"}).then(function(response){scope.collaborators=response.data.data}).catch(function(response){notie.alert(2,"An error has occurred while reloading collaborators.",1)})},scope.showCreateModal=function(){scope.mode="create",$("#newCollaboratorModal").modal("show")},scope.saveCollaborator=function(){http({method:"POST",url:"/applications/"+scope.application.id+"/collaborators",data:scope.newCollaborator}).then(function(response){notie.alert(1,"Collaborator correctly created",1.5),scope.newCollaborator={},$("#newCollaboratorModal").modal("hide"),scope.load()}).catch(function(response){notie.alert(3,"An error has occurred, collaborator not created",1.5),scope.newCollaborator={}})},scope.updateCollaborator=function(collaborator){http({method:"PUT",url:"/applications/"+scope.application.id+"/collaborators/"+collaborator.email,data:{role:collaborator.role}}).then(function(response){notie.alert(1,"Collaborator correctly updated",1)}).catch(function(response){notie.alert(3,"An error has occurred, collaborator not updated",1),scope.newCollaborator={}})},scope.delete=function(collaborator){http({method:"DELETE",url:"/applications/"+scope.application.id+"/collaborators/"+collaborator.email}).then(function(response){notie.alert(1,"Collaborator correctly deleted",1),scope.load()}).catch(function(response){notie.alert(3,"An error has occurred, collaborator not deleted",1)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("DeployController",["$scope","$rootScope","$application",function(scope,$rootScope,$application){var application=$application.get();scope.application=application,scope.selectedTemplate=null,$rootScope.application=application,$rootScope.currentSection="application.deploy",scope.getHerokuURL=function(){var str="https://heroku.com/deploy";return str+="?template="+scope.selectedTemplate,str+="&env[MARKETCLOUD_PUBLIC_KEY]="+encodeURIComponent(scope.application.public_key),str+="&env[MARKETCLOUD_SECRET_KEY]="+encodeURIComponent(scope.application.secret_key)}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("IntegrationsController",function($scope,$http,$application,$rootScope){var application=$application.get();scope.application=application,$scope.integrations=[{name:"braintree",tags:["payments"],image:"https://marketcloud.azureedge.net/storm-images/braintree-logo.jpg",description:"Accept cards and Paypal on web and mobile almost anywhere.",links:{view:"/documentation/integrations/braintree"}},{name:"stripe",tags:["payments"],image:"https://marketcloud.azureedge.net/storm-images/stripe.png",description:"Web and mobile payments. Built for developers.",links:{view:"/documentation/integrations/stripe"}},{name:"facebook",tags:["authentication"],image:"https://marketcloud.azureedge.net/storm-images/facebook.png",description:"Facebook authentication",links:{view:"/documentation/guides/facebook-login"}},{name:"spaceinvoices",tags:["invoicing"],image:"https://spaceinvoices.com/assets/images/logo/landscape/color.svg",description:"Simple invoicing with Spaceinvoices",links:{view:"/documentation/guides/spaceinvoices"}}],rootScope.currentSection="application.integrations"}),app.controller("IntegrationStripeController",function($scope,$http,$routeParams,StripeIntegration){console.log("Integration status",StripeIntegration),StripeIntegration?($scope.isIntegrationInstalled=!0,$scope.StripeIntegration=StripeIntegration):$scope.isIntegrationInstalled=!1,$scope.currentApplication=$application.get(),$scope.toggleIntegration=function(){return alert($scope.StripeIntegration.isActive),$http({method:"PUT",url:"/applications/"+$application.get().id+"/integrations/stripe",data:{isActive:$scope.StripeIntegration.isActive}}).then(function(response){notie.alert(1,"Integration correctly updated",1)}).catch(function(response){notie.alert(3,"An error has occurred. Integration not updated",1)})}}),app.controller("IntegrationSpaceinvoicesController",function($scope,$http,$routeParams,SpaceinvoicesIntegration){console.log("Integration status",SpaceinvoicesIntegration)}),app.controller("IntegrationBraintreeController",function($scope,$http,$routeParams,BraintreeIntegration){$scope.displayCredentialsForm=!1,$scope.currentApplication=$application.get(),$scope.braintreeConfiguration=BraintreeIntegration.data.data,$scope.braintreeUpdate=angular.copy(BraintreeIntegration.data.data),$scope.braintreeUpdate.hasOwnProperty("isActive")||($scope.braintreeUpdate.isActive=!1),$scope.toggleCredentialsForm=function(){$scope.displayCredentialsForm=!$scope.displayCredentialsForm},$scope.showModal=function(){$("#BraintreeCredentialsModal").modal("show")},$scope.toggleIntegration=function(){return $http({method:"PUT",url:"/applications/"+$application.get().id+"/integrations/braintree",data:{isActive:$scope.braintreeConfiguration.isActive}}).then(function(response){notie.alert(1,"Integration correctly updated",1)}).catch(function(response){notie.alert(3,"An error has occurred. Integration not updated",1)})},$scope.saveBraintreeConfiguration=function(){var payload={environment:$scope.braintreeUpdate.environment,isActive:$scope.braintreeUpdate.isActive};$scope.braintreeUpdate.merchantId&&$scope.braintreeUpdate.publicKey&&$scope.braintreeUpdate.privateKey&&(payload.merchantId=$scope.braintreeUpdate.merchantId,payload.publicKey=$scope.braintreeUpdate.publicKey,payload.privateKey=$scope.braintreeUpdate.privateKey),console.log("PUTTING",payload),$http({method:"PUT",url:"/applications/"+$application.get().id+"/integrations/braintree",data:payload}).then(function(response){notie.alert(1,"Integration correctly updated",1),$("#BraintreeCredentialsModal").modal("hide"),$scope.braintreeConfiguration=angular.copy({environment:payload.environment,isActive:payload.isActive})}).catch(function(response){notie.alert(3,"An error has occurred. Integration not updated",1)})}})},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("NavigationController",["$scope","$route","$rootScope","$application",function($scope,$route,$rootScope,$application){var application=$application.get();scope.application=application,$scope.$on("$dashboardSectionChange",function($event,args){$scope.currentSection=args.section,$scope.showNavigation="home"!==$scope.currentSection&&"create"!==$scope.currentSection})}])},function(module,exports){
"use strict";var app=angular.module("DataDashboard");app.controller("ApplicationOverviewController",["$scope","$http","$application","$rootScope",function(scope,http,$application,rootScope){scope.activities=[],http({url:"/applications/"+$application.get("id")+"/activity",method:"GET"}).then(function(response){scope.activities=response.data.data});var application=$application.get();scope.application=application,rootScope.currentSection="application.overview",scope.kilobytesToGigabytes=function(kb){return kb/1024/1024},scope.application.renew_date,scope.getMethodCSSClass=function(a){var cls=null;switch(a.method){case"GET":cls="label-success";break;case"POST":cls="label-info";break;case"PUT":cls="label-warning";break;case"PATCH":cls="label-warning";break;case"DELETE":cls="label-danger";break;default:cls="label-success"}return cls}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.factory("BillingPlans",function(){var BILLING_PLANS={free:{name:"free",id:"free",price_monthly:0,price_yearly:0,api_calls_quota_max:"5000",storage:.5},"month-19":{name:"cumulus",id:"month-19",price_monthly:19,price_yearly:190,api_calls_quota_max:"100000",storage:1},"month-49":{name:"stratus",id:"month-49",price_monthly:49,price_yearly:490,api_calls_quota_max:"450000",storage:2},"month-99":{name:"nimbo stratus",id:"month-99",price_monthly:99,price_yearly:990,api_calls_quota_max:"1500000",storage:5}};return BILLING_PLANS}),app.controller("ApplicationSettingsController",["$scope","$application","$http","$location","$rootScope","BillingPlans",function(scope,$application,$http,$location,rootScope,BillingPlans){var application=$application.get();scope.application=application,rootScope.currentSection="application.settings",scope.plans=BillingPlans,scope.currentPlan=null;for(var k in BillingPlans)scope.application.plan_name===BillingPlans[k].name&&(scope.currentPlan=BillingPlans[k]);scope.updateApplication=function(){var update={url:scope.application.url,name:scope.application.name};$http.put("/applications/"+scope.application.id,update).then(function(response){notie.alert(1,"The application has been updated.",1.5)}).catch(function(error){notie.alert(3,"An error has occurred. Please try again.",1.5)})},scope.deleteApplication=function(){notie.confirm("Do you really want to delete the application? It is not reversible!","Confirm","Cancel",function(){$http.delete("/applications/"+scope.application.id).then(function(response){notie.alert(1,"The application has been deleted.",1.5),$location.path("/")}).catch(function(response){notie.alert(3,"An error has occurred, please try again.",1.5)})})},scope.regenerateKeys=function(){notie.confirm("Do you really want to update the application's keys?","Confirm","Cancel",function(){$http.put("/applications/"+scope.application.id+"/regenerateKeys").then(function(response){scope.application.public_key=response.data.data.public_key,scope.application.secret_key=response.data.data.secret_key,notie.alert(1,"Keys regenerated correctly.",1.5)}).catch(function(response){notie.alert(3,"An error has occurred. Please retry",1.5)})})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("WebhooksController",["$scope","$http","webhooks","$application","$rootScope",function(scope,http,webhooks,$application,rootScope){rootScope.currentSection="application.webhooks";var application=$application.get();scope.application=application,scope.mode=null,scope.error=null,scope.invalidPropertyName=null,scope.application=application,scope.webhooks=webhooks.data.data,scope.newWebhook={};var webhookMethods=["create","update","delete"],webhookResources=["addresses","brands","carts","categories","collections","contents","coupons","invoices","files","orders","paymentMethods","products","promotions","stores","taxes","users","variables"];scope.events=[],webhookResources.forEach(function(resource){webhookMethods.forEach(function(method){scope.events.push(resource+"."+method)})}),scope.events.splice(scope.events.indexOf("orders.delete"),0,"payments.create"),scope.load=function(){http({method:"GET",url:"/applications/"+scope.application.id+"/webhooks"}).then(function(response){console.log("LOAD",response),scope.webhooks=response.data.data}).catch(function(response){notie.alert(2,"An error has occurred while reloading webhooks.",1)})},scope.edit=function(hook){scope.newWebhook=hook,scope.showUpdateModal()},scope.showUpdateModal=function(){scope.mode="update",$("#newWebhookModal").modal("show")},scope.showCreateModal=function(){scope.mode="create",scope.newWebhook={},$("#newWebhookModal").modal("show")},scope.validateWebhook=function(){return scope.error=null,scope.invalidPropertyName=null,scope.validateUrl()===!1?(scope.error="The URL is not valid. Remember to specify the protocol http:// or https:// at the beginning.",scope.invalidPropertyName="url",!1):!!scope.newWebhook.event||(scope.error="Please select a valid event from the menu",scope.invalidPropertyName="event",!1)},scope.saveWebhook=function(){scope.validateWebhook()&&http({method:"POST",url:"/applications/"+scope.application.id+"/webhooks",data:scope.newWebhook}).then(function(response){notie.alert(1,"Webhook correctly created",1),scope.newWebhook={},$("#newWebhookModal").modal("hide"),scope.load()}).catch(function(response){notie.alert(3,"An error has occurred, webhook not created",1),scope.newWebhook={}})},scope.validateUrl=function(){var regex=/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})).?)(?::\d{2,5})?(?:[\/?#]\S*)?$/i;return regex.test(scope.newWebhook.url)},scope.updateWebhook=function(){if(scope.validateWebhook()){var update={event:scope.newWebhook.event,url:scope.newWebhook.url};http({method:"PUT",url:"/applications/"+scope.application.id+"/webhooks/"+scope.newWebhook.id,data:update}).then(function(response){notie.alert(1,"Webhook correctly updated",1),scope.newWebhook={}}).catch(function(response){notie.alert(3,"An error has occurred, webhook not updated",1)})}},scope.delete=function(hook){http({method:"DELETE",url:"/applications/"+scope.application.id+"/webhooks/"+hook.id}).then(function(response){notie.alert(1,"Webhook correctly deleted",1),scope.load()}).catch(function(response){notie.alert(3,"An error has occurred, webhook not deleted",1)})}}])},function(module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!(function(){function EditBrandTranslationsController(scope,$marketcloud,brand,$http,$application,$location,locales){function getSlugFromString(v){return v.split(" ").map(function(item){return item.replace(/\W/g,"")}).map(function(item){return item.toLowerCase()}).join("-")}return 0===$application.getAvailableLocaleCodes().length?(notie.alert(2,"This store has no additional locale. Please add a locale first.",2),$location.path("/system/localization")):(scope.brand=brand.data.data,scope.availableLocales=[],scope.locales=locales,scope.availableLocales=$application.get().locales.split(",").map(function(code){return scope.locales[code]}),scope.unsafeSlug=!1,scope.updateSlug=function(){scope.brand.locales[scope.currentLocale.code].slug=getSlugFromString(scope.brand.locales[scope.currentLocale.code].name)},scope.currentLocale=scope.availableLocales[0],scope.brand.hasOwnProperty("locales")||(scope.brand.locales={}),scope.availableLocales.forEach(function(locale){scope.brand.locales.hasOwnProperty(locale.code)||(scope.brand.locales[locale.code]={})}),scope.getFlagClassName=function(){return"flag-icon-"+scope.currentLocale.code.slice(-2).toLocaleLowerCase()},scope.updateTranslations=function(){var payload={locales:angular.copy(scope.brand.locales)};$marketcloud.brands.update(scope.brand.id,payload).then(function(response){notie.alert(1,"All updates have been saved.",2)}).catch(function(error){notie.alert(3,"An error has occurred, please try again",2)})},scope.filterNotNullProperties=function(item){var result={};for(var k in item)item[k]&&(result[k]=item[k]);return result},void(scope.typeof=function(y){return"undefined"==typeof y?"undefined":_typeof(y)}))}angular.module("DataDashboard").controller("EditBrandTranslationsController",EditBrandTranslationsController),EditBrandTranslationsController.$inject=["$scope","$marketcloud","brand","$http","$application","$location","LocalesFactory"]})()},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("EditBrandController",["$scope","$http","brand","$location","$marketcloud","$utils","$validation","$models",function(scope,http,brandResponse,location,$marketcloud,$utils,$validation,$models){scope.brand=brandResponse.data.data;var coreProperties=Models.Brand.getPropertyNames();coreProperties.push("id","locales","seo","application_id","images","slug","updated_at","created_at"),scope.customPropertiesData={};for(var k in scope.brand)coreProperties.indexOf(k)===-1&&(scope.customPropertiesData[k]=scope.brand[k],delete scope.brand[k]);scope.removeImage=function(i){scope.brand.images.splice(i,1)},scope.updateBrand=function(){scope.brand.image_url=scope.brand.images[0];var toSave=angular.copy(scope.brand);for(var k in scope.customPropertiesData)toSave[k]=scope.customPropertiesData[k];$marketcloud.brands.update(scope.brand.id,toSave).then(function(response){notie.alert(1,"Brand successfully update.",1.5)}).catch(function(response){if(400===response.status){notie.alert(2,"The data you entered has some errors",1.5);var validation=response.data.errors[0];$validation.showErrorMessage(validation,$models.Brand.schema,'[ng-model="brand.'+validation.invalidPropertyName+'"]')}else notie.alert(3,"An error has occurred.",2)})},scope.unsafeSlug=!1,scope.updateSlug=function(){scope.brand.slug=$utils.getSlugFromString(scope.brand.name)}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("BrandsController",["$scope","$marketcloud","brands",function(scope,$marketcloud,resources){scope.brands=resources.data.data,scope.pagination={currentPage:resources.data.page,numberOfPages:resources.data.pages,nextPage:resources.data._links.next||null,previousPage:resources.data._links.prev||null,count:resources.data.count},scope.query={per_page:20},scope.loadPage=function(page_number){return scope.loadData({page:page_number})},scope.loadData=function(query){query||(query=scope.query),$marketcloud.brands.list(query).then(function(response){scope.brands=response.data.data,scope.pagination={currentPage:response.data.page,numberOfPages:response.data.pages,nextPage:response.data._links.next||null,previousPage:response.data._links.prev||null,count:response.data.count}}).catch(function(response){notie.alert(3,"An error has occurred. Please try again.",1.5)})},scope.deleteBrand=function(brand_id,index){$marketcloud.brands.delete(brand_id).then(function(response){scope.loadData({page:scope.currentPage}),notie.alert(1,"Brand deleted",1.5)}).catch(function(response){notie.alert(3,"An error has occurred.Please try again.",1.5)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("BrandController",["$scope","$http","$marketcloud","$location","$utils","$validation","$models",function(scope,http,$marketcloud,location,$utils,$validation,$models){scope.newBrand={};var coreProperties=Models.Brand.getPropertyNames();coreProperties.push("id","locales","seo","application_id","images","slug","updated_at","created_at"),scope.customPropertiesData={},scope.removeImage=function(i){scope.newBrand.images.splice(i,1)},scope.unsafeSlug=!1,scope.updateSlug=function(){scope.newBrand.slug=$utils.getSlugFromString(scope.newBrand.name)},scope.saveBrand=function(){scope.newBrand.image_url=scope.newBrand.images[0];var toSave=angular.copy(scope.newBrand);for(var k in scope.customPropertiesData)toSave[k]=scope.customPropertiesData[k];$marketcloud.brands.save(toSave).then(function(response){notie.alert(1,"Brand saved",1.5),location.path("/brands")}).catch(function(response){if(400===response.status){notie.alert(2,"The data you entered has some errors",1.5);var validation=response.data.errors[0];$validation.showErrorMessage(validation,$models.Brand.schema,'[ng-model="newBrand.'+validation.invalidPropertyName+'"]')}else notie.alert(3,"An error has occurred.",2)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("EditCategoryController",["$scope","$http","category","$location","$marketcloud","$utils","$validation","$models",function(scope,http,category,location,$marketcloud,$utils,$validation,$models){scope.loadingData=!0,scope.category=category.data.data,scope.categories=[];var coreProperties=Models.Brand.getPropertyNames();coreProperties.push("id","locales","seo","application_id","images","slug","parent_id","path","updated_at","created_at"),scope.customPropertiesData={};for(var k in scope.category)coreProperties.indexOf(k)===-1&&(scope.customPropertiesData[k]=scope.category[k],delete scope.category[k]);scope.removeImage=function(i){scope.category.images.splice(i,1)},$marketcloud.categories.list().then(function(response){scope.categories=response.data.data}).catch(function(){notie.alert(2,"An error has occurred while loading categories",1.5)}),scope.updateCategory=function(){scope.category.image_url=scope.category.images[0];var toSave=angular.copy(scope.category);for(var k in scope.customPropertiesData)toSave[k]=scope.customPropertiesData[k];$marketcloud.categories.update(category.data.data.id,toSave).then(function(response){notie.alert(1,"Category updated with success ",2),location.path("/categories")}).catch(function(response){if(400===response.status){notie.alert(2,"The data you entered has some errors",1.5);var validation=response.data.errors[0];$validation.showErrorMessage(validation,$models.Category.schema,'[ng-model="category.'+validation.invalidPropertyName+'"]')}else notie.alert(3,"An error has occurred.",2)})},scope.unsafeSlug=!1,scope.updateSlug=function(){scope.category.slug=$utils.getSlugFromString(scope.category.name)}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("CategoriesController",["$scope","categories","$q","$marketcloud",function(scope,resources,$q,$marketcloud){scope.categories=resources.data.data,scope.pagination={currentPage:resources.data.page,numberOfPages:resources.data.pages,nextPage:resources.data._links.next||null,previousPage:resources.data._links.prev||null,count:resources.data.count},scope.query={per_page:20},scope.toggleAll=function(){scope.categories.forEach(function(p){p.selected=scope.selectAll})},scope.getSelectedItems=function(){return scope.categories.filter(function(p){return p.selected===!0})},scope.bulkDelete=function(){notie.confirm("Delete "+scope.getSelectedItems().length+" items?","Delete","Cancel",function(){var defer=$q.defer(),promises=[];return scope.getSelectedItems().forEach(function(category){promises.push($marketcloud.categories.delete(category.id))}),$q.all(promises).then(function(){notie.alert(1,"All items have been deleted",1.5),scope.loadPage(scope.currentPage)}),defer.promise})},scope.loadPage=function(page_number){return scope.query.page=page_number,scope.loadData()},scope.loadData=function(query){query||(query=scope.query),$marketcloud.categories.list(query).then(function(response){scope.categories=response.data.data,scope.pagination={currentPage:response.data.page,numberOfPages:response.data.pages,nextPage:response.data._links.next||null,previousPage:response.data._links.prev||null,count:response.data.count}}).catch(function(response){notie.alert(3,"An error has occurred. Please try again.",1.5)})},scope.deleteCategory=function(category_id,index){$marketcloud.categories.delete(category_id).then(function(response){scope.loadData({page:1}),notie.alert(1,"Category deleted",1.5)}).catch(function(response){notie.alert(3,"An error has occurred.Please try again.",1.5)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("CategoryController",["$scope","$http","$marketcloud","$location","$utils","$validation","$models",function(scope,http,$marketcloud,location,$utils,$validation,$models){scope.customPropertiesData={},scope.newCategory={},scope.categories=[],$marketcloud.categories.list().then(function(response){scope.categories=response.data.data}).catch(function(){notie.alert(3,"An error has occurred. Please retry",1.5)});var coreProperties=$models.Category.getPropertyNames();coreProperties.push("id","locales","seo","application_id","images","slug","parent_id","path","updated_at","created_at"),scope.removeImage=function(i){scope.newCategory.images.splice(i,1)},scope.saveCategory=function(){scope.newCategory.image_url=scope.newCategory.images[0];var toSave=angular.copy(scope.newCategory);for(var k in scope.customPropertiesData)toSave[k]=scope.customPropertiesData[k];$marketcloud.categories.save(toSave).then(function(response){notie.alert(1,"Category saved",1.5),location.path("/categories")}).catch(function(response){if(400===response.status){notie.alert(2,"The data you entered has some errors",1.5);var validationObject=response.data.errors[0],invalidPropertyName=validationObject.invalidPropertyName;$validation.showErrorMessage(validationObject,$models.Category.schema,'[ng-model="newCategory.'+invalidPropertyName+'"]')}else notie.alert(3,"An error has occurred. Please try again",1.5)})},scope.unsafeSlug=!1,scope.updateSlug=function(){scope.newCategory.slug=$utils.getSlugFromString(scope.newCategory.name)}}])},function(module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!(function(){function EditCategoryTranslationsController(scope,$marketcloud,category,$http,$location,$application,locales){function getSlugFromString(v){return v.split(" ").map(function(item){return item.replace(/\W/g,"")}).map(function(item){return item.toLowerCase()}).join("-")}return 0===$application.getAvailableLocaleCodes().length?(notie.alert(2,"This store has no additional locale. Please add a locale first.",2),$location.path("/system/localization")):(scope.category=category.data.data,scope.availableLocales=[],scope.locales=locales,scope.availableLocales=$application.get().locales.split(",").filter(function(localeCode){return""!==localeCode}).map(function(code){return scope.locales[code]}),scope.currentLocale=scope.availableLocales[0],scope.category.hasOwnProperty("locales")||(scope.category.locales={}),scope.availableLocales.forEach(function(locale){scope.category.locales.hasOwnProperty(locale.code)||(scope.category.locales[locale.code]={})}),scope.unsafeSlug=!1,scope.updateSlug=function(){scope.category.locales[scope.currentLocale.code].slug=getSlugFromString(scope.category.locales[scope.currentLocale.code].name)},scope.getFlagClassName=function(){if(scope.currentLocale)return"flag-icon-"+scope.currentLocale.code.slice(-2).toLocaleLowerCase()},scope.updateTranslations=function(){var payload={locales:angular.copy(scope.category.locales)};$marketcloud.categories.update(scope.category.id,payload).then(function(response){notie.alert(1,"All updates have been saved.",2)}).catch(function(error){notie.alert(3,"An error has occurred, please try again",2)})},scope.filterNotNullProperties=function(item){var result={};for(var k in item)item[k]&&(result[k]=item[k]);return result},void(scope.typeof=function(y){return"undefined"==typeof y?"undefined":_typeof(y)}))}angular.module("DataDashboard").controller("EditCategoryTranslationsController",EditCategoryTranslationsController),EditCategoryTranslationsController.$inject=["$scope","$marketcloud","category","$http","$location","$application","LocalesFactory"]})()},function(module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!(function(){function EditCollectionTranslationsController(scope,$marketcloud,collection,$http,$application,$location,locales){function getSlugFromString(v){return v.split(" ").map(function(item){return item.replace(/\W/g,"")}).map(function(item){return item.toLowerCase()}).join("-")}return 0===$application.getAvailableLocaleCodes().length?(notie.alert(2,"This store has no additional locale. Please add a locale first.",2),$location.path("/system/localization")):(scope.collection=collection.data.data,scope.availableLocales=[],scope.locales=locales,scope.availableLocales=$application.get().locales.split(",").map(function(code){return scope.locales[code]}),scope.currentLocale=scope.availableLocales[0],scope.collection.hasOwnProperty("locales")||(scope.collection.locales={}),scope.availableLocales.forEach(function(locale){scope.collection.locales.hasOwnProperty(locale.code)||(scope.collection.locales[locale.code]={})}),scope.unsafeSlug=!1,scope.updateSlug=function(){scope.collection.locales[scope.currentLocale.code].slug=getSlugFromString(scope.collection.locales[scope.currentLocale.code].name)},scope.getFlagClassName=function(){return"flag-icon-"+scope.currentLocale.code.slice(-2).toLocaleLowerCase()},scope.updateTranslations=function(){var payload={locales:angular.copy(scope.collection.locales)};$marketcloud.collections.update(scope.collection.id,payload).then(function(response){notie.alert(1,"All updates have been saved.",2)}).catch(function(error){notie.alert(3,"An error has occurred, please try again",2)})},scope.filterNotNullProperties=function(item){var result={};for(var k in item)item[k]&&(result[k]=item[k]);return result},void(scope.typeof=function(y){return"undefined"==typeof y?"undefined":_typeof(y)}))}angular.module("DataDashboard").controller("EditCollectionTranslationsController",EditCollectionTranslationsController),EditCollectionTranslationsController.$inject=["$scope","$marketcloud","collection","$http","$application","$location","LocalesFactory"]})()},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("CollectionController",["$scope","$http","$marketcloud","$location","$utils",function(scope,http,$marketcloud,location,$utils){scope.collection={items:[]},scope.products=[],scope.itemsToAdd=[],scope.query={},scope.prepareRegex=function(){scope.query.name.$options="i"},scope.addProductToCollection=function(product){scope.itemsToAdd.push(product),scope.query.name.$regex="",scope.products=[]},scope.removeProductFromCollection=function(i){scope.itemsToAdd.splice(i,1)},scope.showTheList=!1,scope.showList=function(){scope.showTheList=!0},scope.hideList=function(){window.setTimeout(function(){scope.showTheList=!1,scope.$apply()},200)},scope.loadProducts=function(query){query=query||scope.query,$marketcloud.products.list(query).then(function(response){scope.products=response.data.data.filter(function(item){return scope.itemsToAdd.map(function(i){return i.id}).indexOf(item.id)<0})}).catch(function(response){notie.alert(3,"An error has occurred. Please try again")})},scope.loadProducts(),scope.saveCollection=function(){scope.collection.items=scope.itemsToAdd.map(function(item){return{product_id:item.id}}),$marketcloud.collections.save(scope.collection).then(function(response){notie.alert(1,"Collection saved",1.5),location.path("/collections")}).catch(function(response){notie.alert(2,"An error has occurred, please try again",1.5)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("CreateCollectionController",["$scope","$http","$marketcloud","$location",function(scope,http,$marketcloud,location){function getSlugFromString(v){return v.split(" ").map(function(item){return item.replace(/\W/g,"")}).map(function(item){return item.toLowerCase()}).join("-")}scope.collection={items:[]},scope.products=[],scope.itemsToAdd=[],scope.customPropertiesData={},scope.query={},scope.unsafeSlug=!1,scope.updateSlug=function(){scope.collection.slug=getSlugFromString(scope.collection.name)},scope.prepareRegex=function(){scope.query.name.$options="i"},scope.addProductToCollection=function(product){scope.itemsToAdd.push(product),scope.query.name.$regex="",scope.products=[]},scope.removeProductFromCollection=function(i){scope.itemsToAdd.splice(i,1)},scope.showTheList=!1,scope.showList=function(){scope.showTheList=!0},scope.hideList=function(){window.setTimeout(function(){scope.showTheList=!1,scope.$apply()},200)},scope.loadProducts=function(query){query=query||scope.query,$marketcloud.products.list(query).then(function(response){scope.products=response.data.data.filter(function(item){return scope.itemsToAdd.map(function(i){return i.id}).indexOf(item.id)<0})}).catch(function(response){notie.alert(3,"An error has occurred. Please try again")})},scope.loadProducts(),scope.saveCollection=function(){for(var k in scope.customPropertiesData)scope.collection[k]=scope.customPropertiesData[k];scope.collection.items=scope.itemsToAdd.map(function(item){return{product_id:item.id}}),$marketcloud.collections.save(scope.collection).then(function(response){notie.alert(1,"Collection saved",1.5),location.path("/collections")}).catch(function(response){notie.alert(2,"An error has occurred, please try again",1.5)})}}])},function(module,exports){"use strict";angular.module("DataDashboard").controller("EditCollectionController",["$scope","$http","$marketcloud","$location","collection","$utils","$validation","$models",function(scope,http,$marketcloud,location,collection,$utils,$validation,$models){scope.collection=collection.data.data,scope.products=[],scope.itemsToAdd=angular.copy(scope.collection.items),scope.query={},scope.customPropertiesData={};var coreProperties=Models.Collection.getPropertyNames();coreProperties.push("id","application_id","seo");for(var k in scope.collection)coreProperties.indexOf(k)<0&&(scope.customPropertiesData[k]=scope.collection[k],delete scope.collection[k]);scope.unsafeSlug=!1,scope.updateSlug=function(){scope.collection.slug=$utils.getSlugFromString(scope.collection.name)},scope.prepareRegex=function(){scope.query.name.$options="i"},scope.addProductToCollection=function(product){scope.itemsToAdd.push(product),scope.query.name.$regex="",scope.products=[]},scope.removeProductFromCollection=function(i){scope.itemsToAdd.splice(i,1)},scope.showTheList=!1,scope.showList=function(){scope.showTheList=!0},scope.hideList=function(){window.setTimeout(function(){scope.showTheList=!1,scope.$apply()},200)},scope.loadProducts=function(query){query=query||scope.query,$marketcloud.products.list(query).then(function(response){scope.products=response.data.data.filter(function(item){return scope.itemsToAdd.map(function(i){return i.id}).indexOf(item.id)<0})}).catch(function(response){notie.alert(3,"An error has occurred. Please try again")})},scope.loadProducts(),scope.saveCollection=function(){for(var k in scope.customPropertiesData)scope.collection[k]=scope.customPropertiesData[k];scope.collection.items=scope.itemsToAdd.map(function(item){return{product_id:item.id}}),$marketcloud.collections.update(scope.collection.id,scope.collection).then(function(response){notie.alert(1,"Collection saved",1.5)}).catch(function(response){if(400===response.status){notie.alert(2,"The data you entered has some errors",1.5);var validation=response.data.errors[0];$validation.showErrorMessage(validation,$models.Collection.schema,'[ng-model="collection.'+validation.invalidPropertyName+'"]')}else notie.alert(3,"An error has occurred.",2)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("CreateCollectionController",["$scope","$http","$marketcloud","$location","$utils","$validation","$models",function(scope,http,$marketcloud,location,$utils,$validation,$models){scope.collection={items:[]},scope.products=[],scope.itemsToAdd=[],scope.customPropertiesData={},scope.query={},scope.unsafeSlug=!1,scope.updateSlug=function(){scope.collection.slug=$utils.getSlugFromString(scope.collection.name)},scope.prepareRegex=function(){scope.query.name.$options="i"},scope.addProductToCollection=function(product){scope.itemsToAdd.push(product),scope.query.name.$regex="",scope.products=[]},scope.removeProductFromCollection=function(i){scope.itemsToAdd.splice(i,1)},scope.showTheList=!1,scope.showList=function(){scope.showTheList=!0},scope.hideList=function(){window.setTimeout(function(){scope.showTheList=!1,scope.$apply()},200)},scope.loadProducts=function(query){query=query||scope.query,$marketcloud.products.list(query).then(function(response){scope.products=response.data.data.filter(function(item){return scope.itemsToAdd.map(function(i){return i.id}).indexOf(item.id)<0})}).catch(function(response){notie.alert(3,"An error has occurred. Please try again")})},scope.loadProducts(),scope.saveCollection=function(){for(var k in scope.customPropertiesData)scope.collection[k]=scope.customPropertiesData[k];scope.collection.items=scope.itemsToAdd.map(function(item){return{product_id:item.id}}),$marketcloud.collections.save(scope.collection).then(function(response){notie.alert(1,"Collection saved",1.5),location.path("/collections")}).catch(function(response){if(400===response.status){notie.alert(2,"The data you entered has some errors",1.5);var validation=response.data.errors[0];$validation.showErrorMessage(validation,$models.Collection.schema,'[ng-model="collection.'+validation.invalidPropertyName+'"]')}else notie.alert(3,"An error has occurred.",2)})}}])},function(module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!(function(){function EditContentTranslationsController(scope,$marketcloud,content,$http,$application,$location,locales){function getSlugFromString(v){return v.split(" ").map(function(item){return item.replace(/\W/g,"")}).map(function(item){return item.toLowerCase()}).join("-")}return 0===$application.getAvailableLocaleCodes().length?(notie.alert(2,"This store has no additional locale. Please add a locale first.",2),$location.path("/system/localization")):(scope.content=content.data.data,scope.availableLocales=[],scope.locales=locales,scope.availableLocales=$application.get().locales.split(",").map(function(code){return scope.locales[code]}),scope.currentLocale=scope.availableLocales[0],scope.content.hasOwnProperty("locales")||(scope.content.locales={}),scope.availableLocales.forEach(function(locale){scope.content.locales.hasOwnProperty(locale.code)||(scope.content.locales[locale.code]={})}),scope.unsafeSlug=!1,scope.updateSlug=function(){scope.content.locales[scope.currentLocale.code].slug=getSlugFromString(scope.content.locales[scope.currentLocale.code].name)},scope.getFlagClassName=function(){return"flag-icon-"+scope.currentLocale.code.slice(-2).toLocaleLowerCase()},scope.updateTranslations=function(){var payload={locales:angular.copy(scope.content.locales)};$marketcloud.contents.update(scope.content.id,payload).then(function(response){notie.alert(1,"All updates have been saved.",2)}).catch(function(error){notie.alert(3,"An error has occurred, please try again",2)})},scope.filterNotNullProperties=function(item){var result={};for(var k in item)item[k]&&(result[k]=item[k]);return result},void(scope.typeof=function(y){return"undefined"==typeof y?"undefined":_typeof(y);
}))}angular.module("DataDashboard").controller("EditContentTranslationsController",EditContentTranslationsController),EditContentTranslationsController.$inject=["$scope","$marketcloud","content","$http","$application","$location","LocalesFactory"]})()},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("EditContentController",["$scope","$http","content","$location","$marketcloud","moment","$utils","$validation","$models",function(scope,http,content,location,$marketcloud,$moment,$utils,$validation,$model){scope.content=content.data.data,scope.content.date=$moment(scope.content.date);var coreProperties=Models.Content.getPropertyNames();coreProperties.push("id","locales","seo","application_id","images","slug","published","category","date","updated_at","created_at","type"),scope.customPropertiesData={};for(var k in scope.content)coreProperties.indexOf(k)===-1&&(scope.customPropertiesData[k]=scope.content[k],delete scope.content[k]);scope.unsafeSlug=!1,scope.updateSlug=function(){scope.content.slug=$utils.getSlugFromString(scope.content.title)},scope.getImagesContainer=function(){return scope.content.author.images},scope.removeImage=function(i){scope.content.author.images.splice(i,1)},scope.updateContent=function(){var toSave=angular.copy(scope.content);for(var k in scope.customPropertiesData)toSave[k]=scope.customPropertiesData[k];$marketcloud.contents.update(scope.content.id,toSave).then(function(response){notie.alert(1,"Content updated with success",1.5)}).catch(function(response){if(400===response.status){notie.alert(2,"The data you entered has some errors",1.5);var validation=response.data.errors[0],selector='[ng-model="content.'+validation.invalidPropertyName+'"]';0===angular.element(selector).length&&(selector='[validate-for="'+validation.invalidPropertyName+'"]'),$validation.showErrorMessage(validation,$models.Content.schema,selector)}else notie.alert(3,"An error has occurred.",2)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("ContentController",["$scope","$http","$location","$marketcloud","$utils","$validation","$models","$account",function(scope,http,location,$marketcloud,$utils,$validation,$models,$account){scope.content={title:"",slug:"",text:"",published:!1,author:{name:$account.get("full_name"),description:"",images:[$account.get("image_url")]},seo:{meta:{},twitter:{},facebook:{}}},scope.customPropertiesData={},scope.getImagesContainer=function(){return scope.content.author.images},scope.removeImage=function(i){scope.content.author.images.splice(i,1)},scope.computeSeoTags=function(){},scope.unsafeSlug=!1,scope.updateSlug=function(){scope.content.slug=$utils.getSlugFromString(scope.content.title)},scope.saveContent=function(){for(var k in scope.customPropertiesData)scope.content[k]=scope.customPropertiesData[k];console.log("Salvo questo",scope.content),$validation.hideErrors(),$marketcloud.contents.save(scope.content).then(function(response){notie.alert(1,"Content saved",2),location.path("/contents")}).catch(function(response){if(400===response.status){notie.alert(2,"The data you entered has some errors",1.5);var validation=response.data.errors[0],selector='[ng-model="content.'+validation.invalidPropertyName+'"]';0===angular.element(selector).length&&(selector='[validate-for="'+validation.invalidPropertyName+'"]'),$validation.showErrorMessage(validation,$models.Content.schema,selector)}else notie.alert(3,"An error has occurred.",2)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("ContentsController",["$scope","$http","contents","$marketcloud",function(scope,http,resources,$marketcloud){scope.pagination={currentPage:resources.data.page,numberOfPages:resources.data.pages,nextPage:resources.data._links.next||null,previousPage:resources.data._links.prev||null,count:resources.data.count},scope.query={per_page:20},scope.contents=resources.data.data,scope.loadPage=function(p){return scope.loadData({page:p})},scope.loadData=function(query){query||(query=scope.query),$marketcloud.contents.list(query).then(function(response){scope.contents=response.data.data,scope.pagination={currentPage:response.data.page,numberOfPages:response.data.pages,nextPage:response.data._links.next||null,previousPage:response.data._links.prev||null,count:response.data.count}}).catch(function(response){notie.alert(3,"An error has occurred. Please try again.",1.5)})},scope.setPublishing=function(content){return http({method:"PUT",url:API_BASE_URL+"/contents/"+content.id,data:{published:content.published},headers:{Authorization:window.public_key+":"+window.token}}).then(function(response){notie.alert(1,"Updated!",1.5)}).catch(function(response){notie.alert(3,"An error has occurred, please try again.",1.5)})},scope.deleteContent=function(content_id,index){$marketcloud.contents.delete(content_id).then(function(response){scope.loadData({page:1}),notie.alert(1,"Content deleted",1.5)}).catch(function(response){notie.alert(3,"An error has occurred.Please try again.",1.5)})}}])},function(module,exports){"use strict";angular.module("DataDashboard").controller("EditGroupedProductController",["$scope","$marketcloud","product","$http",function(scope,$marketcloud,product,$http){function getSlugFromString(v){return v.split(" ").map(function(item){return item.replace(/\W/g,"")}).map(function(item){return item.toLowerCase()}).join("-")}scope.customPropertiesData={},scope.itemsToAdd=[],scope.product=product.data.data;var product_ids=scope.product.items.map(function(product){return product.product_id});$marketcloud.products.list({id:product_ids.join(",")}).then(function(response){var p_map={};scope.product.items.forEach(function(i){p_map[i.product_id]=i}),scope.itemsToAdd=response.data.data.map(function(prod){var p=angular.copy(prod);return p.quantity=p_map[p.id].quantity,p})}).catch(function(error){notie.alert(3,"An error has occurred",1.5)});var coreProperties=Models.Product.getPropertyNames();coreProperties.push("product_id","variant_id","display_price","display_price_discount","items");for(var k in scope.product)coreProperties.indexOf(k)<0&&(scope.customPropertiesData[k]=scope.product[k],delete scope.product[k]);scope.unsafeSlug=!1,scope.updateSlug=function(){scope.product.slug=getSlugFromString(scope.product.name)},scope.getImagesContainer=function(){return scope.product.images},scope.removeImage=function(i){scope.product.images.splice(i,1)},scope.categories=[],$marketcloud.categories.list().success(function(response){scope.categories=response.data}).error(function(){notie.alert(2,"An error has occurred while loading categories",2)}),scope.brands=[],$marketcloud.brands.list().success(function(response){scope.brands=response.data}).error(function(){notie.alert(2,"An error has occurred while loading brands",2)}),scope.filterVariantProps=function(o){var p={};for(var k in o)scope.product.variantsDefinition.hasOwnProperty(k)&&(p[k]=o[k]);return p},scope.getVariantStyle=function(i){var r=["label-info","label-danger","label-warning","label-success"];return r[i%r.length]},scope.getVariantStyle=function(i){var r=[{color:"red"},{color:"green"},{color:"blue"},{color:"pink"}];return r[i%r.length]},scope.newAttribute={name:null,value:null,type:null},scope.newAttribute.type="string",scope.availableTypes=[{name:"String",value:"string"},{name:"Number",value:"number"},{name:"Boolean",value:"boolean"}],scope.filterNotNullProperties=function(item){var result={};for(var k in item)item[k]&&(result[k]=item[k]);return result},scope.updateProduct=function(){for(var k in scope.customPropertiesData)scope.product[k]=scope.customPropertiesData[k];scope.product.items=scope.itemsToAdd.map(function(item){return{product_id:item.id,quantity:item.quantity}}),$marketcloud.products.update(scope.product.id,scope.product).success(function(response){notie.alert(1,"Update Succeded",1.5)}).error(function(response){notie.alert(3,"Update failed",1.5)})}}])},function(module,exports){"use strict";angular.module("DataDashboard").controller("NewGroupedProductController",["$scope","$http","$location","$marketcloud",function(scope,$http,location,$marketcloud){function getSlugFromString(v){return v.split(" ").map(function(item){return item.replace(/\W/g,"")}).map(function(item){return item.toLowerCase()}).join("-")}scope.categories=[],scope.error=null,scope.newCategory={},scope.brands=[],scope.newBrand={},scope.getImagesContainer=function(){return scope.product.images},scope.removeImage=function(i){scope.product.images.splice(i,1)},scope.unsafeSlug=!1,scope.updateSlug=function(){scope.product.slug=getSlugFromString(scope.product.name)},scope.loadCategories=function(){$marketcloud.categories.list({}).success(function(response){scope.categories=response.data}).error(function(){console.log("An error has occurred while loading categories")})},scope.loadCategories(),scope.saveCategory=function(){$marketcloud.categories.save(scope.newCategory).success(function(response){$("#newCategoryModal").modal("hide"),scope.categories.push(scope.newCategory),scope.newCategory={}}).error(function(response){$("#newCategoryModal").hide(),notie.alert(3,"An error has occurred. Category not saved",1)})},scope.loadBrands=function(){$marketcloud.brands.list({}).success(function(response){scope.brands=response.data}).error(function(){console.log("An error has occurred while loading brands")})},scope.loadBrands(),scope.saveBrand=function(){$marketcloud.brands.save(scope.newBrand).success(function(response){$("#newBrandModal").modal("hide"),scope.brands.push(scope.newBrand),scope.newBrand={}}).error(function(response){$("#newBrandModal").hide(),notie.alert(3,"An error has occurred. Brand not saved",1)})},scope.product={type:"grouped_product",price:0,name:"",description:"",stock_type:"status",stock_status:"in_stock",images:[],has_variants:!1,published:!0,items:[]},scope.productError=null,scope.newCustomProperty={},scope.customPropertiesData={},scope.Forms={},scope.Forms.newCustomProperty={name:null,value:null},scope.customPropertiesNames=[],scope.hideErrors=function(){scope.error=null,scope.errorField=null},scope.saveProduct=function(){for(var k in scope.product)null===scope.product[k]&&(delete scope.product[k],console.log("Un null"));scope.hideErrors();var props_to_validate={},known_props=Models.GroupedProduct.getPropertyNames();for(var k in scope.product)known_props.indexOf(k)>-1&&(props_to_validate[k]=scope.product[k]);for(var k in scope.customPropertiesData)scope.product[k]=scope.customPropertiesData[k];for(var key in scope.product)null===scope.product[key]&&delete scope.product[key];console.log("Saving this prod",scope.product),scope.product.items=scope.product.items.map(function(item){return{product_id:item.id}}),$marketcloud.products.save(scope.product).success(function(response){notie.alert(1,"Product saved",1.5),location.path("/products")}).error(function(response){notie.alert(2,"An error has occurred. Product not saved",1)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("EditCouponController",["$scope","$http","$marketcloud","$location","$validation","$models","coupon",function(scope,http,$marketcloud,location,$validation,$models,coupon){scope.coupon=coupon.data.data,scope.save=function(){$validation.hideErrors(),$marketcloud.coupons.update(scope.coupon.id,scope.coupon).then(function(response){notie.alert(1,"Coupon updated",1.5)}).catch(function(response){if(400===response.status){notie.alert(2,"The data you entered has some errors",1.5);var validation=response.data.errors[0],selector='[ng-model="coupon.'+validation.invalidPropertyName+'"]';0===angular.element(selector).length&&(selector='[validate-for="'+validation.invalidPropertyName+'"]'),$validation.showErrorMessage(validation,$models.Coupon.schema,selector)}else notie.alert(3,"An error has occurred.",2)})},"expiration_date"in scope.coupon&&(scope.hasExpirationDate=!0),"usages_left"in scope.coupon&&(scope.limitedUsage=!0),scope.toggleCouponExpiration=function(){scope.coupon.expiration_date=null},scope.toggleCouponUsage=function(){scope.coupon.usages_left=null},scope.clearTargetId=function(){scope.coupon.target_id=null},scope.addCondition=function(){scope.coupon.conditions.push(scope.newCondition),scope.newCondition={}},scope.addEffect=function(){scope.coupon.effects.push(scope.newEffect),scope.newEffect={}},scope.products=[],scope.itemsToAdd=[],scope.targetProduct=null,"PRODUCT_COUPON"===scope.coupon.target_type&&$marketcloud.products.getById(scope.coupon.target_id).then(function(response){scope.targetProduct=response.data.data}).catch(function(response){notie.alert(2,"An error has occurred",2)}),scope.query={},scope.prepareRegex=function(){scope.query.name.$options="i"},scope.showTheList=!1,scope.showList=function(){scope.showTheList=!0},scope.hideList=function(){window.setTimeout(function(){scope.showTheList=!1,scope.$apply()},200)},scope.loadProducts=function(query){query=query||scope.query,$marketcloud.products.list(query).then(function(response){scope.products=response.data.data.filter(function(item){return scope.itemsToAdd.map(function(i){return i.id}).indexOf(item.id)<0})}).catch(function(response){notie.alert(3,"An error has occurred. Please try again")})},scope.selectProductAsTarget=function(product){scope.targetProduct=product,scope.coupon.target_id=product.id},scope.resetTargetProduct=function(){scope.targetProduct=null},scope.loadProducts(),scope.handleCategoryChange=function(){}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("NewCouponController",["$scope","$http","$marketcloud","$location","$validation","$models",function(scope,http,$marketcloud,location,$validation,$models){scope.coupon={active:!0,discount_type:"NET_REDUCTION"},scope.randomizeCode=function(){scope.coupon.code=Math.random().toString(36).substr(2,10).toUpperCase()},scope.updateCouponExpiration=function(){scope.hasExpirationDate!==!0&&delete scope.coupon.expiration_date},scope.clearTargetId=function(){scope.coupon.target_id=null},scope.updateCouponUsage=function(){scope.limitedUsage!==!0&&delete scope.coupon.usages_left},scope.save=function(){for(var k in scope.coupon)null===scope.coupon[k]&&delete scope.coupon[k];$validation.hideErrors(),$marketcloud.coupons.save(scope.coupon).then(function(response){notie.alert(1,"Coupon saved",1.5),location.path("/coupons")}).catch(function(response){if(400===response.status){notie.alert(2,"The data you entered has some errors",1.5);var validation=response.data.errors[0],selector='[ng-model="coupon.'+validation.invalidPropertyName+'"]';0===angular.element(selector).length&&(selector='[validate-for="'+validation.invalidPropertyName+'"]'),$validation.showErrorMessage(validation,$models.Coupon.schema,selector)}else notie.alert(3,"An error has occurred.",2)})},scope.addCondition=function(){scope.coupon.conditions.push(scope.newCondition),scope.newCondition={}},scope.addEffect=function(){scope.coupon.effects.push(scope.newEffect),scope.newEffect={}},scope.products=[],scope.itemsToAdd=[],scope.targetProduct=null,scope.query={},scope.prepareRegex=function(){scope.query.name.$options="i"},scope.showTheList=!1,scope.showList=function(){scope.showTheList=!0},scope.hideList=function(){window.setTimeout(function(){scope.showTheList=!1,scope.$apply()},200)},scope.loadProducts=function(query){query=query||scope.query,$marketcloud.products.list(query).then(function(response){scope.products=response.data.data.filter(function(item){return scope.itemsToAdd.map(function(i){return i.id}).indexOf(item.id)<0})}).catch(function(response){notie.alert(3,"An error has occurred. Please try again")})},scope.selectProductAsTarget=function(product){scope.targetProduct=product,scope.coupon.target_id=product.id},scope.resetTargetProduct=function(){scope.targetProduct=null},scope.loadProducts(),scope.handleCategoryChange=function(){}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("DeployController",["$scope","$application",function(scope,$application){scope.selectedTemplate=null,scope.getHerokuURL=function(){var str="https://heroku.com/deploy";return str+="?template="+scope.selectedTemplate,str+="&env[MARKETCLOUD_PUBLIC_KEY]="+$application.get().public_key,str+="&env[MARKETCLOUD_SECRET_KEY]="+$application.get().secret_key}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("HomeController",["$scope","$http","$routeParams","analytics","moment",function(scope,http,params,analytics,moment){scope.activities=[];scope.alerts=[],scope.analytics={today:{total:0,count:0},yesterday:{total:0,count:0},this_week:{total:0,count:0},this_month:{total:0,count:0}};var today=new Date;today.setHours(0,0,0,0),today=today.getTime();var yesterday=new Date;yesterday.setDate(yesterday.getDate()-1),yesterday.setHours(0,0,0,0),yesterday=yesterday.getTime();var oneWeekAgo=new Date;oneWeekAgo.setDate(oneWeekAgo.getDate()-7),oneWeekAgo.setHours(0,0,0,0),oneWeekAgo=oneWeekAgo.getTime();var orders=analytics.data.data;scope.ordersToManage=orders.filter(function(order){return["processing","pending","on_hold"].indexOf(order.status)>-1}).slice(0,10);var salesVolumePerDay={},numberOfOrdersPerDay={};scope.orders_data=[],scope.orders_labels=[];for(var last_30_days=[],last_30_days_labels=[],i=1;i<30;i++){var d=new Date;d.setDate(d.getDate()-i);var month=String(d.getMonth()+1);month.length<2&&(month="0"+month);var day=d.getFullYear()+"-"+month+"-"+d.getDate();last_30_days_labels.push(day),last_30_days.push({date:day,value:0}),salesVolumePerDay[day]=0}orders.filter(function(x){var invalid_orders=["failed","canceled","refunded"];return invalid_orders.indexOf(x.status)<0}).map(function(x){return{created_at:x.created_at,total:x.total}}).forEach(function(x){var d=new Date(x.created_at),month=String(d.getMonth()+1);month.length<2&&(month="0"+month);var day=d.getFullYear()+"-"+month+"-"+d.getDate();salesVolumePerDay[day]||(salesVolumePerDay[day]=0),salesVolumePerDay[day]+=x.total,numberOfOrdersPerDay[day]||(numberOfOrdersPerDay[day]=0),numberOfOrdersPerDay[day]++}),orders.filter(function(x){var invalid_orders=["failed","canceled","refunded"];return invalid_orders.indexOf(x.status)<0}).map(function(x){return{created_at:x.created_at,total:x.total}}).forEach(function(x){x.created_at>today?(scope.analytics.today.total=Math.round(1e3*(scope.analytics.today.total+x.total))/1e3,scope.analytics.today.count++,scope.analytics.this_month.total=Math.round(1e3*(scope.analytics.this_month.total+x.total))/1e3,scope.analytics.this_month.count++):x.created_at>yesterday?(scope.analytics.yesterday.total=Math.round(1e3*(scope.analytics.yesterday.total+x.total))/1e3,scope.analytics.yesterday.count++,scope.analytics.this_month.total=Math.round(1e3*(scope.analytics.this_month.total+x.total))/1e3,scope.analytics.this_month.count++):x.created_at>oneWeekAgo?(scope.analytics.this_week.total=Math.round(1e3*(scope.analytics.this_week.total+x.total))/1e3,scope.analytics.this_week.count++,scope.analytics.this_month.total=Math.round(1e3*(scope.analytics.this_month.total+x.total))/1e3,scope.analytics.this_month.count++):(scope.analytics.this_month.total=Math.round(1e3*(scope.analytics.this_month.total+x.total))/1e3,scope.analytics.this_month.count++)}),scope.orders_volume_data=[],scope.orders_count_data=[],scope.orders_volume_labels=[];for(var k in salesVolumePerDay)scope.orders_volume_data.unshift(parseFloat(Number(salesVolumePerDay[k]).toFixed(2))),scope.orders_count_data.unshift(numberOfOrdersPerDay[k]),scope.orders_volume_labels.unshift(moment(k,"YYYY-M-DD").format("MMM Do"));scope.datasets=[scope.orders_volume_data,scope.orders_count_data],scope.getMethodCSSClass=function(a){var cls=null;switch(a.method){case"GET":cls="label-success";break;case"POST":cls="label-info";break;case"PUT":cls="label-warning";break;case"PATCH":cls="label-warning";break;case"DELETE":cls="label-danger";break;default:cls="label-success"}return cls},scope.chartOptions={scaleLabel:"<%= Number(value).toFixed(2).replace('.',',') %> "+scope.application.currency_code},scope.chartOptions={scales:{xAxes:[{gridLines:{display:!1}}],yAxes:[{scaleLabel:{display:!0,labelString:scope.application.currency_code}}]}}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("IntegrationsController",["$scope","$http","$application",function($scope,$http,$application){$scope.integrations=[{name:"braintree",tags:["payments"],image:"https://marketcloud.azureedge.net/storm-images/braintree-logo.jpg",description:"Accept cards and Paypal on web and mobile almost anywhere.",links:{view:"/documentation/integrations/braintree"}},{name:"stripe",tags:["payments"],image:"https://marketcloud.azureedge.net/storm-images/stripe.png",description:"Web and mobile payments. Built for developers.",links:{view:"/documentation/integrations/stripe"}},{name:"facebook",tags:["authentication"],image:"https://marketcloud.azureedge.net/storm-images/facebook.png",description:"Facebook auth integration",links:{view:"/documentation/guides/facebook-login"}},{name:"spaceinvoices",tags:["invoicing"],image:"https://spaceinvoices.com/assets/images/logo/landscape/color.svg",description:"Simple invoicing with Spaceinvoices",links:{view:"/documentation/guides/spaceinvoices"}}]}]),app.controller("IntegrationStripeController",["$scope","$http","$routeParams","StripeIntegration","$application",function($scope,$http,$routeParams,StripeIntegration,$application){StripeIntegration?($scope.isIntegrationInstalled=!0,$scope.StripeIntegration=StripeIntegration.data.data):$scope.isIntegrationInstalled=!1,$scope.currentApplication=$application.get(),$scope.toggleIntegration=function(){return $http({method:"PUT",url:"/applications/"+$application.get().id+"/integrations/stripe",data:{isActive:$scope.StripeIntegration.isActive}}).then(function(response){notie.alert(1,"Integration correctly updated",1)}).catch(function(response){notie.alert(3,"An error has occurred. Integration not updated",1)})}}]),app.controller("IntegrationBraintreeController",["$scope","$http","$routeParams","BraintreeIntegration","$application",function($scope,$http,$routeParams,BraintreeIntegration,$application){$scope.displayCredentialsForm=!1,$scope.currentApplication=$application.get(),BraintreeIntegration?($scope.isIntegrationInstalled=!0,$scope.braintreeConfiguration=BraintreeIntegration.data.data,$scope.braintreeUpdate=angular.copy(BraintreeIntegration.data.data)):$scope.isIntegrationInstalled=!1,$scope.toggleCredentialsForm=function(){$scope.displayCredentialsForm=!$scope.displayCredentialsForm},$scope.showModal=function(){$("#BraintreeCredentialsModal").modal("show")},$scope.toggleIntegration=function(){return $http({method:"PUT",url:"/applications/"+$application.get().id+"/integrations/braintree",data:{isActive:$scope.braintreeConfiguration.isActive}}).then(function(response){notie.alert(1,"Integration correctly updated",1)}).catch(function(response){notie.alert(3,"An error has occurred. Integration not updated",1)})},$scope.saveBraintreeConfiguration=function(){console.log("Sending",$scope.braintreeUpdate),$http({method:"PUT",url:"/applications/"+$application.get().id+"/integrations/braintree",data:$scope.braintreeUpdate}).then(function(response){notie.alert(1,"Integration correctly updated",1),$("#BraintreeCredentialsModal").modal("hide"),$scope.isIntegrationInstalled=!0,$scope.braintreeConfiguration=angular.copy({environment:$scope.braintreeUpdate.environment,isActive:$scope.braintreeUpdate.isActive})}).catch(function(response){notie.alert(3,"An error has occurred. Integration not updated",1)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("NewInvoiceController",["$scope","$http","$marketcloud","$application","$location","parentOrder","orders","Countries","$validation","$models",function(scope,http,$marketcloud,$application,location,parentOrder,orders,countries,$validation,$models){function setNextInvoiceNumber(){$marketcloud.invoices.list().then(function(response){var applicationSettings=$application.get(),lastNumber=response.data.data.map(function(invoice){return invoice.number}).map(function(number){return number.indexOf&&number.indexOf(applicationSettings.invoices_prefix)>-1&&(number=number.replace(applicationSettings.invoices_prefix,"")),isNaN(number)||(number=Number(number)),number}).sort(function(a,b){return a-b}).pop();console.log("LastNumber is ",lastNumber),isNaN(lastNumber)||(lastNumber=Number(lastNumber),scope.invoice.number=applicationSettings.invoices_prefix+String(lastNumber+1))}).catch(function(error){console.log(error)})}function fillDataFromOrder(order){console.log("fillDataFromOrder",order),scope.parentOrder=order,scope.invoice={order_id:scope.parentOrder.id,company:{name:$application.get("company_name"),email:$application.get("email_address"),address:$application.get("company_address"),country:$application.get("company_country"),city:$application.get("company_city"),state:$application.get("company_state"),postal_code:$application.get("company_postalcode"),vat:$application.get("company_taxid")},customer:{},date_created:new Date,date_due:new Date,lineItems:scope.parentOrder.products.map(function(p){return p.description="",p})},scope.parentOrder.hasOwnProperty("shipping")&&scope.invoice.lineItems.push({name:"Shipping "+scope.parentOrder.shipping.name,description:scope.parentOrder.shipping.description,quantity:1,price:scope.parentOrder.shipping_total}),scope.parentOrder.hasOwnProperty("payment_method")&&scope.invoice.lineItems.push({name:"Payment method "+scope.parentOrder.payment_method.name,description:scope.parentOrder.payment_method.description,quantity:1,price:scope.parentOrder.payment_method_total}),scope.parentOrder.hasOwnProperty("coupon")&&scope.invoice.lineItems.push({name:"Coupon "+scope.parentOrder.coupon.name,description:scope.parentOrder.coupon.description,quantity:1,price:0-Number(scope.parentOrder.coupon_total)}),scope.parentOrder.hasOwnProperty("promotion")&&scope.invoice.lineItems.push({name:"Promotion "+scope.parentOrder.promotion.name,description:scope.parentOrder.promotion.description,quantity:1,price:0-Number(scope.parentOrder.promotion_total)});for(var k in scope.parentOrder.billing_address)scope.invoice.customer[k]=scope.parentOrder.billing_address[k]}scope.invoice={company:{name:$application.get("company_name"),email:$application.get("email_address"),address:$application.get("company_address"),country:$application.get("company_country"),city:$application.get("company_city"),state:$application.get("company_state"),postal_code:$application.get("company_postalcode"),vat:$application.get("company_taxid")},customer:{},date_created:new Date,date_due:new Date,lineItems:[{name:"",description:"",quantity:0,price:0}]},console.log(scope.invoice),parentOrder&&parentOrder.data?fillDataFromOrder(parentOrder.data.data):scope.parentOrder=null,setNextInvoiceNumber(),scope.orders=orders.data.data,scope.ordersQuery={per_page:5,page:1},scope.showTheList=!1,scope.showList=function(){scope.showTheList=!0},scope.hideList=function(){window.setTimeout(function(){scope.showTheList=!1,scope.$apply()},200)},scope.loadNextOrders=function(){scope.showTheList=!0,scope.ordersQuery.page+=1,$marketcloud.orders.list(scope.ordersQuery).then(function(response){scope.orders=response.data.data}).catch(function(error){notie.alert(3)})},scope.loadPreviousOrders=function(){scope.showTheList=!0,scope.ordersQuery.page<=1||(scope.ordersQuery.page-=1,$marketcloud.orders.list(scope.ordersQuery).then(function(response){scope.orders=response.data.data}).catch(function(error){notie.alert(3)}))},scope.selectOrder=function(order){scope.showTheList=!1,scope.invoice.order_id=order.id,fillDataFromOrder(order)},scope.countries=countries,scope.customerStates=[],scope.companyStates=[],scope.getInvoiceTotal=function(){return scope.invoice.lineItems.map(function(item){return item.price*item.quantity}).reduce(function(a,b){return a+b}).toFixed(2)},scope.updateCompanyStates=function(){http({method:"GET",url:"/countries/"+scope.invoice.company.country.toLowerCase()}).then(function(response){scope.companyStates=response.data}).catch(function(error){var type=null;error.data&&error.data.errors&&error.data.errors[0]&&(type=error.data.errors[0].type),"StatesListNotAvailable"===type&&(scope.companyStates=[])})},scope.invoice.company.country&&scope.updateCompanyStates(),scope.updateCustomerStates=function(){scope.invoice.customer.country&&http({method:"GET",url:"/countries/"+scope.invoice.customer.country.toLowerCase()}).then(function(response){scope.customerStates=response.data}).catch(function(error){var type=null;error.data&&error.data.errors&&error.data.errors[0]&&(type=error.data.errors[0].type),"StatesListNotAvailable"===type&&(scope.customerStates=[])})},scope.invoice.customer.country&&scope.updateCustomerStates(),scope.saveInvoice=function(goToOrder){goToOrder=goToOrder||!1,$validation.hideErrors(),console.log("Salvo questo",angular.copy(scope.invoice)),$marketcloud.invoices.save(scope.invoice).then(function(response){return notie.alert(1,"Invoice saved",1.5),goToOrder===!0?location.path("/orders/"+scope.invoice.order_id+"/view"):void location.path("/invoices")}).catch(function(response){if(400===response.status){notie.alert(2,"The data you entered has some errors",1.5);var validation=response.data.errors[0],selector='[ng-model="invoice.'+validation.invalidPropertyName+'"]';0===angular.element(selector).length&&(selector='[validate-for="'+validation.invalidPropertyName+'"]'),$validation.showErrorMessage(validation,$models.Invoice.schema,selector)}else notie.alert(3,"An error has occurred. Please try again",2)})},scope.addLineItem=function(){scope.invoice.lineItems.push({name:"",description:"",quantity:null,price:null})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("EditInvoiceController",["$scope","$http","$marketcloud","$location","invoice","Countries","$validation","$models",function(scope,http,$marketcloud,location,invoice,countries,$validation,$models){scope.invoice=invoice.data.data,console.log("Prima di fottere le date",angular.copy(scope.invoice)),scope.invoice.date_due=moment(scope.invoice.date_due),scope.invoice.date_created=moment(scope.invoice.date_created),console.log("Dopo di fottere le date",angular.copy(scope.invoice)),scope.countries=countries,scope.customerStates=[],scope.companyStates=[],scope.alert=function(m){window.alert(m)},scope.getInvoiceTotal=function(){return scope.invoice.lineItems.map(function(item){return item.price*item.quantity}).reduce(function(a,b){return a+b}).toFixed(2)},scope.updateCompanyStates=function(){http({method:"GET",url:"/countries/"+scope.invoice.company.country.toLowerCase()}).then(function(response){scope.companyStates=response.data}).catch(function(error){console.log(error);var type=null;error.data&&error.data.errors&&error.data.errors[0]&&(type=error.data.errors[0].type),"StatesListNotAvailable"===type?scope.companyStates=[]:notie.alert(3,"An error has occurred. Please try again.",1.5)})},scope.updateCustomerStates=function(){scope.invoice.customer.country&&http({method:"GET",url:"/countries/"+scope.invoice.customer.country.toLowerCase()}).then(function(response){scope.customerStates=response.data}).catch(function(error){var type=null;error.data&&error.data.errors&&error.data.errors[0]&&(type=error.data.errors[0].type),"StatesListNotAvailable"===type?scope.customerStates=[]:notie.alert(3,"An error has occurred. Please try again.",1.5)})},scope.updateCustomerStates(),scope.updateCompanyStates(),scope.debug=function(){console.log(scope.invoice)},scope.saveInvoice=function(){"function"==typeof scope.invoice.date_created.toDate&&(scope.invoice.date_created=scope.invoice.date_created.toDate(),scope.invoice.date_created.setHours(12)),"function"==typeof scope.invoice.date_due.toDate&&(scope.invoice.date_due=scope.invoice.date_due.toDate(),scope.invoice.date_due.setHours(12)),
console.log("Salvo",angular.copy(scope.invoice)),$validation.hideErrors(),$marketcloud.invoices.update(scope.invoice.id,scope.invoice).then(function(response){notie.alert(1,"Invoice saved",1.5),location.path("/invoices")}).catch(function(response){if(400===response.status){notie.alert(2,"The data you entered has some errors",1.5);var validation=response.data.errors[0],selector='[ng-model="invoice.'+validation.invalidPropertyName+'"]';0===angular.element(selector).length&&(selector='[validate-for="'+validation.invalidPropertyName+'"]'),$validation.showErrorMessage(validation,$models.Invoice.schema,selector)}else notie.alert(3,"An error has occurred.",2)})},scope.addLineItem=function(){scope.invoice.lineItems.push({name:"",description:"",quantity:null,price:null})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("LocalizationController",["$scope","$http","Currencies","Timezones","LocalesFactory","$application",function(scope,http,currencies,timezones,locales,$application){function buildURL(from_currency_code,to_currency_code){return"https://api.fixer.io/latest?symbols="+to_currency_code+"&base="+from_currency_code}function compare(a,b){return a.name<b.name?-1:a.name>b.name?1:0}function activeLocalesToString(){return scope.activeLocales.map(function(locale){return locale.code}).join(",")}function activeCurrenciesToString(){return JSON.stringify(scope.activeCurrencies.map(function(c){return{code:c.code,rate:c.rate}}))}scope.application=$application.get(),scope.currencies=currencies;for(var k in scope.currencies)scope.currencies[k].name_plus_code=scope.currencies[k].name+" ("+scope.currencies[k].code+")";scope.activeCurrencies=[],"string"!=typeof $application.get().currencies&&($application.get().currencies="[]");var saved_currencies=JSON.parse($application.get().currencies);for(var k in scope.currencies){var currency=scope.currencies[k];saved_currencies.forEach(function(saved_currency){if(saved_currency.code===currency.code){var new_currency_obj=angular.copy(currency);new_currency_obj.rate=saved_currency.rate,scope.activeCurrencies.push(new_currency_obj)}})}scope.addCurrency=function(currency){scope.activeCurrencies.map(function(c){return c.code}).indexOf(currency.code)>-1||(currency.rate=1,scope.activeCurrencies.push(currency),scope.updateSettings())},scope.removeCurrency=function(i){scope.activeCurrencies.splice(i,1),scope.updateSettings()},scope.applyExchangeRate=function(currencyToApply){http({method:"GET",url:buildURL($application.get().currency_code,currencyToApply.code)}).then(function(response){console.log("LA RISPOSONA DI FIXER",response),console.log("Io "),currencyToApply.rate=Number(response.data.rates[currencyToApply.code])}).catch(function(err){notie.alert(2,"Sorry, we couldn't find exchange rates for for "+currencyToApply.name,2)})},scope.applyAllExchangeRates=function(){scope.activeCurrencies.forEach(function(currencyToApply){scope.exchangeRates.hasOwnProperty(currencyToApply.code)&&(currencyToApply.rate=scope.exchangeRates[currencyToApply.code])})},scope.locales=Object.keys(locales).map(function(k){return locales[k]}).sort(compare),""===scope.application.locales?scope.activeLocales=[]:scope.activeLocales=scope.application.locales.split(",").map(function(code){return locales[code]}),scope.addLocale=function(locale){scope.activeLocales.map(function(l){return l.code}).indexOf(locale.code)>-1||(scope.activeLocales.push(locale),scope.updateSettings())},scope.getFlagClassName=function(locale){return"flag-icon-"+locale.code.slice(-2).toLocaleLowerCase()},scope.removeLocale=function(i){scope.activeLocales.splice(i,1),scope.updateSettings()},scope.updateSettings=function(){var payload={locales:activeLocalesToString(),currencies:activeCurrenciesToString()};http({method:"PUT",url:"/applications/"+scope.application.id,data:payload}).then(function(response){notie.alert(1,"Application successfully updated",1),console.log("Setto i locales a ",response.data.data.locales),$application.set("locales",response.data.data.locales),$application.set("currencies",response.data.data.currencies)}).catch(function(err){notie.alert(3,"An error has occurred.")})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("MediaListController",["$scope","$http","media","$marketcloud","$q",function(scope,http,resources,$marketcloud,$q){scope.pagination={currentPage:resources.data.page,numberOfPages:resources.data.pages,nextPage:resources.data._links.next||null,previousPage:resources.data._links.prev||null,count:resources.data.count},scope.inspectFile=function(file){scope.inspectedFile=file,$("#inspectFileModal").modal("show")},scope.formatFileSize=function(file){if(!file)return"";var size=Number(file.size),kb=1e3,mb=1e3*kb,gb=1e3*mb;return size>kb&&size<mb?(size=(size/kb).toFixed(2),String(size)+" KB"):size>mb&&size<gb?(size=(size/mb).toFixed(2),String(size)+" MB"):(size=(size/gb).toFixed(2),String(size)+" GB")},scope.query={per_page:20},scope.prepareRegex=function(){scope.query.name.$options="i"},scope.toggleAll=function(){scope.media.forEach(function(p){p.selected=scope.selectAll})},scope.getSelectedItems=function(){return scope.media.filter(function(p){return p.selected===!0})},scope.bulkDelete=function(){notie.confirm("Delete "+scope.getSelectedItems().length+" items?","Delete","Cancel",function(){var defer=$q.defer(),promises=[];return scope.getSelectedItems().forEach(function(item){promises.push($marketcloud.media.delete(item.id))}),$q.all(promises).then(function(){notie.alert(1,"All items have been deleted",1.5),scope.loadPage(scope.currentPage)}),defer.promise})},scope.media=resources.data.data,scope.getImagesContainer=function(){return scope.media},scope.loadPage=function(page){return scope.query.page=page,scope.loadData({page:page})},scope.loadData=function(query){return query||(query=scope.query),$marketcloud.media.list(query).then(function(response){scope.pagination={currentPage:response.data.page,numberOfPages:response.data.pages,nextPage:response.data._links.next||null,previousPage:response.data._links.prev||null,count:response.data.count},scope.media=response.data.data}).catch(function(response){notie.alert(3,"An error has occurred. Please try again.",1.5)})},scope.updateInspectedFile=function(){console.log("Saving this",scope.inspectedFile),$marketcloud.media.update(scope.inspectedFile.id,{name:scope.inspectedFile.name}).then(function(response){notie.alert(1,"File updated",1.5)}).catch(function(error){notie.alert(3,"An error has occurred. Please retry.",1.5)})},scope.deleteMedia=function(media_id,index){$marketcloud.media.delete(media_id).then(function(response){scope.loadData({page:scope.currentPage}),notie.alert(1,"Media deleted",1.5)}).catch(function(response){notie.alert(3,"An error has occurred.Please try again.",1.5)})}}])},function(module,exports){"use strict";var MediaManagerControllerDependencies=["$scope","FileUploader","$http","$element","$attrs","$exceptionHandler","$marketcloud"],MediaManagerController=function(scope,FileUploader,$http,$element,$attrs,$exceptionHandler,$marketcloud){var ctrl=null;this.$onInit=function(){ctrl=this,ctrl.images=ctrl.images||[],scope.closeOnUploadComplete=$attrs.closeOnUploadComplete,scope.buttonClass=$attrs.buttonClass,scope.buttonText=$attrs.buttonText,scope.buttonIcon=$attrs.buttonIcon||null;var tabs=$attrs.tabs||"library,from_disk,from_url";scope.tabs=tabs.split(",")},scope.uploader=new FileUploader({url:window.API_BASE_URL+"/media",arrayKey:"",headers:{Authorization:window.public_key+":"+window.token},filters:[]}),scope.closeDialog=function(){ctrl.onCloseDialog()},scope.openDialog=function(){ctrl.onOpenDialog()},scope.uploadImages=function(){ctrl.onUploadImages()},scope.image={},scope.media_files=[],scope.loadingMediaFiles=!1,scope.query={},scope.pagination=null,scope.loadMedias=function(query){scope.media_files=[],scope.loadingMediaFiles=!0,$marketcloud.media.list(query||{}).then(function(response){scope.loadingMediaFiles=!1,scope.media_files=response.data.data,scope.pagination={currentPage:response.data.page,numberOfPages:response.data.pages,nextPage:response.data._links.next||null,previousPage:response.data._links.prev||null,count:response.data.count}}).catch(function(response){scope.loadingMediaFiles=!1,notie.alert(2,"An error has occurred, please retry.",1.5)})},scope.loadPage=function(page_number){return scope.query.page=page_number,scope.loadData()},scope.loadMore=function(){var pageToFetch=scope.media_files.length/20+1;$marketcloud.media.list({page:pageToFetch}).then(function(response){scope.loadingMediaFiles=!1,scope.media_files=scope.media_files.concat(response.data.data)}).catch(function(response){scope.loadingMediaFiles=!1,notie.alert(2,"An error has occurred, please retry.",1.5)})},scope.loadData=function(query){scope.media_files=[],scope.loadingMediaFiles=!0,query||(query=scope.query||{}),$marketcloud.media.list(query).then(function(response){scope.loadingMediaFiles=!1,scope.media_files=response.data.data,scope.pagination={currentPage:response.data.page,numberOfPages:response.data.pages,nextPage:response.data._links.next||null,previousPage:response.data._links.prev||null,count:response.data.count}}).catch(function(response){scope.loadingMediaFiles=!1,notie.alert(3,"An error has occurred. Please try again.",1.5)})},0===scope.media_files.length&&scope.loadMedias(),scope.showProgressBar=!1,scope.uploadingImages=!1,scope.howManySelectedMedia=function(){return ctrl.images.length},scope.addSelectedFromLibrary=function(){var modal=$element.find("#MediaManagerModal");$(modal).modal("hide")},scope.isImageSelected=function(image){return ctrl.images.indexOf(image.url)>-1},scope.selectImage=function(image){image.selected===!0?(image.selected=!1,removeImage(image)):(image.selected=!0,ctrl.images.push(image.url))};var removeImage=function(image){var pos=ctrl.images.indexOf(image.url);pos>-1&&ctrl.images.splice(pos,1)};scope.uploader.onCompleteAll=function(){if(scope.loadMedias(),scope.showProgressBar=!1,scope.uploadingImages=!1,scope.uploader.clearQueue(),"true"===scope.closeOnUploadComplete){scope.closeDialog();var modal=$element.find("#MediaManagerModal");$(modal).modal("hide")}ctrl.onUploadComplete&&ctrl.onUploadComplete()},scope.uploader.onProgressAll=function(progress){},scope.uploader.onErrorItem=function(item,response,status,headers){var err=new Error("Error uploading an item");err.response=response,err.status=status,err.headers=headers,$exceptionHandler(err)},scope.chooseFileFromStorage=function(){$("#chooseFileFromStorageButton").trigger("click")},scope.uploadSelectedImages=function(){scope.showProgressBar=!0,scope.uploadingImages=!0,scope.uploader.uploadAll()},scope.addImageFromUrl=function(){ctrl.images.push(scope.image.url),scope.image.url=null},scope.showMediaManagerModal=function(){var modal=$element.find("#MediaManagerModal");$(modal).modal("show"),scope.openDialog()}};MediaManagerController.$inject=MediaManagerControllerDependencies,angular.module("DataDashboard").controller("MediaManagerController",MediaManagerController),angular.module("DataDashboard").component("mediaManager",{templateUrl:"/modules/data_dashboard/templates/modals/media_manager.html",controller:"MediaManagerController",bindings:{onCloseDialog:"&",onOpenDialog:"&",onUploadComplete:"&",images:"=?",media:"=?",buttonClass:"@",buttonIcon:"@",buttonText:"@",closeOnUploadComplete:"@"}})},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("EditNotificationController",["$scope","$http","notification","$location","$marketcloud","NotificationsPresetsFactory",function(scope,http,notification,$location,$marketcloud,NotificationsPresets){scope.events={"invoices.create":"An invoice is created","orders.create":"An order is created","users.create":"A new user is created","users.recoverPassword":"A user wants to recover the password","orders.update.processing":"An order is paid","orders.update.completed":"An order is shipped"},scope.templateVariablesLabels={title:"Title",introduction:"introduction",productLabel:"Product Label",priceLabel:"Price Label",customerInformationLabel:"Customer information label",shippingAddressLabel:"Shipping address label",billingAddressLabel:"Billing address label",tracking_code_introduction:"Shipment tracking introduction",redirect_url:"Redirect URL",buttonLabel:"Button Label"},scope.presets=NotificationsPresets,scope.eventKeys=Object.keys(scope.events).map(function(e){return scope.events[e]}),scope.updateNotificationPreset=function(){if(scope.presets.hasOwnProperty(scope.notification.event)){var e=scope.notification.event;for(var k in scope.presets[e])scope.notification[k]=scope.presets[e][k]}},scope.notification=notification.data.data,scope.notification.template||(scope.notification.template=angular.copy(scope.presets[scope.notification.event].template));for(var tplKey in scope.presets[scope.notification.event].template)tplKey in scope.notification.template||(scope.notification.template[tplKey]=scope.presets[scope.notification.event].template[tplKey]);scope.save=function(){$marketcloud.notifications.update(scope.notification.id,scope.notification).then(function(response){notie.alert(1,"Item successfully updated!",1.5),$location.path("/notifications")}).catch(function(error){notie.alert(3,"An error has occurred, please try again",1.5)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("NotificationsController",["$scope","$http","$marketcloud","notifications",function(scope,http,$marketcloud,notifications){scope.notifications=notifications.data.data,scope.delete=function(notification,index){$marketcloud.notifications.delete(notification.id).then(function(response){notie.alert(1,"Notification deleted",1.5),scope.notifications.splice(index,1)}).catch(function(error){notie.alert(3,"An error has occurred, please try again.",1.5)})},scope.toggleNotification=function(notification){$marketcloud.notifications.update(notification.id,notification).then(function(response){notie.alert(1,"Update successful",1.5)}).catch(function(error){notie.alert(3,"An error has occurred, please try again.",1.5)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("NewNotificationController",["$scope","$http","$location","$marketcloud","NotificationsPresetsFactory",function(scope,http,$location,$marketcloud,NotificationsPresets){scope.events={"invoices.create":"An invoice is created","orders.create":"An order is created","users.create":"A new user is created","users.recoverPassword":"A user wants to recover the password","orders.update.processing":"An order is paid","orders.update.completed":"An order is shipped"},scope.notification={event:null,name:null,description:null,subject:null,sendCopyToOwner:!1,active:!1},scope.query={},scope.prepareRegex=function(){scope.query.name.$options="i"},scope.presets=NotificationsPresets,scope.templateVariablesLabels={title:"Title",introduction:"introduction",productLabel:"Product Label",priceLabel:"Price Label",customerInformationLabel:"Customer information label",shippingAddressLabel:"Shipping address label",billingAddressLabel:"Billing address label",tracking_code_introduction:"Shipment tracking introduction",redirect_url:"Redirect URL",buttonLabel:"Button Label"},scope.updateNotificationPreset=function(){if(scope.presets.hasOwnProperty(scope.notification.event)){var e=scope.notification.event;for(var k in scope.presets[e])scope.notification[k]=scope.presets[e][k]}},scope.eventKeys=Object.keys(scope.events).map(function(e){return scope.events[e]}),scope.save=function(){$marketcloud.notifications.save(scope.notification).then(function(response){notie.alert(1,"Notification saved",1.5),$location.path("/notifications")}).catch(function(error){notie.alert(3,"An error has occurred, please try again",1.5)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("PreviewNotificationController",["$scope","$http","notification","$location","$marketcloud",function(scope,http,notification,$location,$marketcloud){scope.notification=JSON.parse(notification),scope.sampleData={},scope.sampleData["orders.update.completed"]={},scope.sampleData["orders.update.processing"]={},scope.sampleData["orders.created"]={},scope.sampleData["users.created"]={}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("TranslateNotificationController",["$scope","$http","notification","$marketcloud","LocalesFactory","$application","$location","NotificationsPresetsFactory",function(scope,http,notification,$marketcloud,locales,$application,$location,NotificationsPresets){if(0===$application.getAvailableLocaleCodes().length)return notie.alert(2,"This store has no additional locale. Please add a locale first.",2),$location.path("/system/localization");scope.presets=NotificationsPresets,scope.notification=notification.data.data,scope.availableLocales=[],scope.locales=locales,scope.templateVariablesLabels={title:"Title",introduction:"introduction",productLabel:"Product Label",priceLabel:"Price Label",customerInformationLabel:"Customer information label",shippingAddressLabel:"Shipping address label",billingAddressLabel:"Billing address label",tracking_code_introduction:"Shipment tracking introduction",redirect_url:"Redirect URL",buttonLabel:"Button Label"},scope.availableLocales=$application.get().locales.split(",").map(function(code){return scope.locales[code]}),scope.currentLocale=scope.availableLocales[0],scope.notification.hasOwnProperty("locales")||(scope.notification.locales={}),scope.availableLocales.forEach(function(locale){scope.notification.locales.hasOwnProperty(locale.code)||(scope.notification.locales[locale.code]={})}),scope.getFlagClassName=function(){return"flag-icon-"+scope.currentLocale.code.slice(-2).toLocaleLowerCase()},scope.events={"invoices.create":"An order is created","orders.create":"An order is created","users.create":"A new user is created","orders.update.processing":"An order is paid","orders.update.completed":"An order is shipped"},scope.eventKeys=Object.keys(scope.events).map(function(e){return scope.events[e]}),scope.updateNotificationPreset=function(){if(scope.presets.hasOwnProperty(scope.notification.event)){var e=scope.notification.event;for(var k in scope.presets[e])scope.notification[k]=scope.presets[e][k]}},scope.notification.template||(scope.notification.template=angular.copy(scope.presets[scope.notification.event]));for(var tplKey in scope.presets[scope.notification.event].template)tplKey in scope.notification.template||(scope.notification.template[tplKey]=scope.presets[scope.notification.event].template[tplKey]);scope.updateTranslations=function(){var payload={locales:angular.copy(scope.notification.locales)};$marketcloud.notifications.update(scope.notification.id,payload).then(function(response){notie.alert(1,"All updates have been saved.",2)}).catch(function(error){notie.alert(3,"An error has occurred, please try again",2)})}}])},function(module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},app=angular.module("DataDashboard");app.controller("OrdersController",["$q","$scope","$http","$location","ordersResponse","$marketcloud","$route","$utils",function($q,scope,http,$location,resources,$marketcloud,$route,$utils){function setPaidFlag(order){order.hasOwnProperty("payment")?order.paid=!0:order.hasOwnProperty("payments")?order.paid=order.payments.filter(function(p){return p.successful}).length>0:order.paid=!1}function jsonToCsv(json){var order_fields=["id","created_at","status","total","items_total","shipping_total","taxes_total","shipping_address_email","shipping_address_full_name","shipping_address_country","shipping_address_city","shipping_address_address1","shipping_address_state","shipping_address_postal_code","billing_address_email","billing_address_full_name","billing_address_country","billing_address_city","billing_address_address1","billing_address_state","billing_address_postal_code","product_name","product_id","product_price","product_price_discount","product_weight","product_depth","product_width","product_height","variant_name_1","variant_value_1","variant_name_2","variant_value_2","variant_name_3","variant_value_3","variant_name_4","variant_value_4","variant_name_5","variant_value_5"],fields=order_fields,csv=json.map(function(row){return fields.map(function(fieldName){return JSON.stringify(row[fieldName]||"")})});return csv.unshift(fields),csv.join("\r\n")}function buildDownload(data){var encodedUri=encodeURI("data:text/csv;charset=utf-8,"+jsonToCsv(data)),link=document.createElement("a");link.setAttribute("href",encodedUri),link.setAttribute("download","exported_orders.csv"),document.body.appendChild(link),link.click()}function isOperator(key){return notFilters.indexOf(key)>=0}scope.pagination={currentPage:resources.data.page,numberOfPages:resources.data.pages,nextPage:resources.data._links.next||null,previousPage:resources.data._links.prev||null,count:resources.data.count},scope.query={page:1,per_page:20};var urlQuery={};try{urlQuery=JSON.parse($route.current.params.query)}catch(e){console.log("Non ho potuto parsare il JSON di questa stringa ",$route.current.params.query),urlQuery={}}console.log("Sono il controller ed inizializzo la query usando query URL Params ",urlQuery);for(var k in urlQuery)scope.query[k]=urlQuery[k];scope.orders=resources.data.data,scope.orders.forEach(setPaidFlag),scope.timestampToDate=function(t){var a=new Date(t),months=["January","February","March","April","May","June","July","August","September","October","November","December"];return a.getDate()+" "+months[a.getMonth()]+" "+a.getFullYear()},scope.toggleAll=function(){scope.orders.forEach(function(o){o.selected=scope.selectAll})},scope.getSelectedItems=function(){return scope.orders.filter(function(o){return o.selected===!0})},scope.bulkExport=function(){return 0===scope.getSelectedItems().length?scope.downloadCSV(scope.orders):void scope.downloadCSV(scope.getSelectedItems())},scope.bulkJSONExport=function(){return 0===scope.getSelectedItems().length?$utils.exportAsJSON(scope.orders):void $utils.exportAsJSON(scope.getSelectedItems())},scope.bulkUpdateStatus=function(status){status||(status=scope.bulkStatusChange);var defer=$q.defer(),promises=[];return scope.getSelectedItems().forEach(function(order){promises.push($marketcloud.orders.update(order.id,{status:status}))}),$q.all(promises).then(function(){notie.alert(1,"All orders have been updated",1.5),scope.loadPage(scope.pagination.currentPage)}),defer.promise},scope.bulkDelete=function(){window.Alert.confirm({title:"Delete "+scope.getSelectedItems().length+" orders?",message:"Deleted orders cannot be recovered. Do you want to continue?",onConfirm:function(){var defer=$q.defer(),promises=[];return scope.getSelectedItems().forEach(function(order){promises.push($marketcloud.orders.delete(order.id))}),$q.all(promises).then(function(){notie.alert(1,"All orders have been deleted",1.5),scope.loadPage(scope.pagination.currentPage)}),defer.promise}})},scope.downloadCSV=function(array_to_download){var to_transform=[];array_to_download.forEach(function(order){var order_data={items_total:order.items_total,shipping_total:order.shipping_total,taxes_total:order.taxes_total,total:order.total,created_at:new Date(order.created_at),status:order.status,id:order.id};for(var ks in order.shipping_address)order_data["shipping_address_"+ks]=order.shipping_address[ks];for(var kb in order.billing_address)order_data["billing_address_"+kb]=order.billing_address[kb];to_transform.push(order_data);var product_props=["name","id","price","price_discount","weight","depth","width","height"];order.products.forEach(function(product){var prod_data={};if(product_props.forEach(function(prop){prod_data["product_"+prop]=product[prop]}),product.has_variants===!0){product_props.forEach(function(prop){product.variant.hasOwnProperty(prop)&&(prod_data["product_"+prop]=product.variant[prop])});var variants_counter=1;for(var variant_name in product.variantsDefinition)prod_data["variant_name_"+variants_counter]=variant_name,prod_data["variant_value_"+variants_counter]=product.variant[variant_name],variants_counter++}to_transform.push(prod_data)})}),buildDownload(to_transform)},scope.nullOrUndefined=function(value){return null===value||"undefined"==typeof value},scope.loadPage=function(page_number){return scope.query.page=Number(page_number),scope.loadData(scope.query)},scope.loadData=function(query){return query||(query=scope.query),$marketcloud.orders.list(query).then(function(response){scope.pagination={currentPage:response.data.page,numberOfPages:response.data.pages,nextPage:response.data._links.next||null,previousPage:response.data._links.prev||null,count:response.data.count},scope.orders=response.data.data,scope.orders.forEach(setPaidFlag),window.history.pushState(scope.query,"List orders","#/orders?query="+angular.$$encodeUriSegment(JSON.stringify(scope.query)))}).catch(function(error){console.log(error),notie.alert(3,"An error has occurred. Please try again.",1.5)})},scope.deleteOrder=function(order){notie.confirm("Delete order?<p>Deleting the order, inventory quantities will be re-assigned.</p>","Delete","Cancel",function(){$marketcloud.orders.delete(order.id).then(function(){notie.alert(1,"Order deleted succesfully",1),scope.loadPage(scope.pagination.currentPage)}).catch(function(){notie.alert(3,"An error has occurred, order not deleted.",1)})})},scope.filters=[];var notFilters=["per_page","page","sort_by","sort_order"];for(var k in scope.query)isOperator(k)||(console.log(k+" is not an operator"),scope.filters.push({name:k,value:scope.query[k]}));scope.applyFilters=function(){scope.filters.forEach(function(filter){scope.query[filter.name]=filter.value}),scope.loadData()},scope.saveNewFilterAndApply=function(){scope.addFilter(scope.newFilter),scope.newFilter={name:"",value:null},$("#singleFilterModal").modal("hide")},scope.addFilter=function(key,value){if("object"===("undefined"==typeof key?"undefined":_typeof(key)))this.filters.push(key);else{if("string"!=typeof key)throw new Error("addFilter(Filter: f) or addFilter(String: fName, Any: fValue)");this.filters.push({name:key,value:value})}scope.applyFilters()},scope.removeFilter=function(index,applyToQuery){"undefined"==typeof applyToQuery&&(applyToQuery=!0);var filterToRemove=scope.filters.splice(index,1);filterToRemove=filterToRemove[0],delete scope.query[filterToRemove.name],applyToQuery===!0&&scope.applyFilters()},scope.removeFilterByName=function(name){scope.filters=scope.filters.filter(function(filter){return filter.name!==name}),delete scope.query[name],scope.applyFilters()},scope.removeFilterByPosition=function(pos){scope.filters.splice(pos,1),scope.applyFilters()},scope.setQueryParam=function(key,value){scope.query[key]=value,scope.loadData()},scope.deleteQueryParam=function(key){delete scope.query[key],scope.loadData()},scope.sortingAttributes=["id","status","created_at","total","items_total","shipping_total","taxes_total","coupon_total","promotion_total"],scope.applySorting=function(){scope.loadData()}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("NewOrderController",["$scope","$marketcloud",function(scope,marketcloud){scope.order={items:[]},scope.products=[{name:"Scolapasta",price:12},{name:"Cucchiaio",price:1},{name:"Forchetta",price:2}],scope.saveOrder=function(){console.log("Saving this order",scope.order)},scope.toggleProductsModal=function(){console.log("Showing products modal"),$("#itemsModal").modal("show")},scope.loadInventory=function(query){console.log("Loading inventory",query)},scope.addItemToOrder=function(item){console.log("Item added to order",item)},scope.loadAddresses=function(query){console.log("Loading addresses",query)}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("OrderController",["$scope","$http","order","shippingMethods","$marketcloud","paymentMethods","Countries",function(scope,http,order,shippingMethods,$marketcloud,paymentMethods,countries){function assignDataToShipments(){Array.isArray(scope.order.shipments)&&(scope.order.shipments=scope.order.shipments.map(function(shipment){return shipment.date&&(shipment.date=moment(shipment.date)),shipment.delivery_date&&(shipment.delivery_date=moment(shipment.delivery_date)),shipment.method&&scope.shippingMethods.forEach(function(method){shipment.method.id===method.id&&(shipment.method=method)}),shipment}))}function getLineItemPrice(lineItem){return lineItem.variant?lineItem.variant.price_discount?lineItem.variant.price_discount*lineItem.quantity:lineItem.variant.price*lineItem.quantity:lineItem.price_discount?lineItem.price_discount*lineItem.quantity:lineItem.price*lineItem.quantity}function getLineItemTaxes(lineItem){var price=getLineItemPrice(lineItem),tax_rate=lineItem.applied_tax_rate;return tax_rate/100*price*lineItem.quantity}function syntaxHighlight(json){return"string"!=typeof json&&(json=JSON.stringify(json,null,2)),json=json.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(new RegExp("\n","g"),"<br>").replace(new RegExp("\t"),"&nbsp;&nbsp;"),json.replace(/("(\\u[a-zA-Z0-9]{4}|\\[^u]|[^\\"])*"(\s*:)?|\b(true|false|null)\b|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?)/g,function(match){var cls="number";return/^"/.test(match)?cls=/:$/.test(match)?"key":"string":/true|false/.test(match)?cls="boolean":/null/.test(match)&&(cls="null"),'<span class="'+cls+'">'+match+"</span>"})}scope.paymentMethods=paymentMethods.data.data,scope.countries=countries,scope.order=order.data.data,scope.products=[],scope.itemsToAdd=[],scope.addressToEdit={},scope.shippingMethods=shippingMethods.data.data,scope.newShipment={tracking_code:null,tracking_link:null,date:new Date,delivery_date:new Date,method:null,description:null},scope.saveShipmentAndFullfill=!1,scope.newPayment={method:"Manual",description:null,amount:scope.order.total},scope.savePaymentAndSetToProcessing=!1,scope.payments=[],scope.showEditAddressDialog=function(addressToEdit){scope.addressToEdit=addressToEdit,$("#editAddressModal").modal("show")},scope.onUpdateOrder=function(){$marketcloud.orders.update(scope.order.id,scope.order).then(function(res){notie.alert(1,"Order successfully updated",1.5),scope.order=res.data.data,scope.addingProduct=!1,scope.editingOrder=!1})},scope.editOrder=function(){scope.editingOrder=!0},scope.onRemoveItemFromOrder=function(idx){console.log(idx);var product=scope.order.products[idx];notie.confirm("Are you sure you want to remove "+product.name+"?","Yes, remove."," No.",function(){scope.$apply(function(){scope.order.items.splice(idx,1),scope.order.products.splice(idx,1)})})},scope.query={},scope.onAddProduct=function(){scope.addingProduct=!0},scope.onCloseAddingProduct=function(){scope.addingProduct=!1},scope.prepareRegex=function(){scope.query.name.$options="i"},scope.loadProducts=function(query){query=query||scope.query,$marketcloud.products.list(query).then(function(response){scope.products=response.data.data.filter(function(item){return scope.itemsToAdd.map(function(i){return i.id}).indexOf(item.id)<0})}).catch(function(response){notie.alert(3,"An error has occurred. Please try again")})},scope.addProduct=function(product){product.quantity=1,scope.order.items.push({product_id:product.id,quantity:product.quantity,variant_id:product.variant_id?product.variant_id:null}),scope.order.products.push(product),scope.query.name.$regex="",scope.products=[]},scope.showTheList=!1,scope.showList=function(){scope.showTheList=!0},scope.hideList=function(){window.setTimeout(function(){scope.showTheList=!1,scope.$apply()},200)},scope.saveAddress=function(){$marketcloud.orders.update(scope.order.id,{billing_address:scope.order.billing_address,
shipping_address:scope.order.shipping_address}).then(function(){notie.alert(1,"Order successfully updated",1.5),$("#editAddressModal").modal("hide")}).catch(function(){notie.alert(2,"An error has occurred, order not updated",1.5),$("#editAddressModal").modal("hide")})},assignDataToShipments(),scope.refundedProducts=[],scope.order.refunds&&scope.order.refunds.forEach(function(refund){refund.line_items.forEach(function(item){scope.refundedProducts.push(item)})}),scope.showRefundModal=function(){scope.newRefund={created_at:new Date,reason:"",line_items:[],items_total:0,taxes_total:0,total:0,restock_refunded_items:!1},scope.newRefund.line_items=scope.order.products.map(function(product){var p=angular.copy(product);return p.quantityInOrder=product.quantity,p.product_id=product.id,p.variant_id=0,p.hasOwnProperty("variant")&&(p.variant_id=p.variant.id),p}),scope.updateNewRefund(),$("#RefundModal").modal("show")},scope.saveRefund=function(){return scope.refundErrorMessage="",scope.newRefund.line_items=scope.newRefund.line_items.filter(function(item){return item.quantity>0}),scope.newRefund.total<=0?void(scope.refundErrorMessage="Refund total must be greater than zero."):void $marketcloud.refunds.save(scope.order.id,scope.newRefund).then(function(response){$("#RefundModal").modal("hide"),window.Alert.success({message:"Refund saved successfully!"})}).catch(function(response){scope.refundErrorMessage="Unable to create refund. Please review the inserted data."})},scope.updateNewRefund=function(){scope.newRefund.items_total=0,scope.newRefund.taxes_total=0,scope.newRefund.line_items.forEach(function(item){scope.newRefund.items_total+=getLineItemPrice(item),scope.newRefund.taxes_total+=getLineItemTaxes(item)}),scope.newRefund.total=scope.newRefund.items_total+scope.newRefund.taxes_total,console.log("updateNewRefund "+scope.newRefund.total)},scope.getVariantStyle=function(i){var r=[{color:"#c0392b"},{color:"#27ae60"},{color:"#2c3e50"},{color:"#d35400"}];return r[i%r.length]},scope.getVariantClass=function(i){var classes=["label-empty-info","label-empty-success","label-empty-warning","label-empty-danger"];return"label solid "+classes[i%classes.length]},scope.getSelectedVariantValues=function(p){var temp={};return Object.keys(p.variantsDefinition).forEach(function(k){temp[k]=p.variant[k]}),temp},scope.getSelectedVariantKeysAndValues=function(p){var temp={};return Object.keys(p.variantsDefinition).forEach(function(k){temp[k]=k+": "+String(p.variant[k])}),temp},scope.updateStatus=function(status){scope.order.status=status,$marketcloud.orders.update(scope.order.id,{status:scope.order.status}).then(function(response){notie.alert(1,"Order successfully updated",1)}).catch(function(response){notie.alert(2,"An error has occurred. Please try again.",1)})},scope.timestampToDate=function(t,showHours){var a=new Date(t),months=["January","February","March","April","May","June","July","August","September","October","November","December"],the_date=a.getDate()+" "+months[a.getMonth()]+" "+a.getFullYear();return showHours===!0&&(the_date+=" at "+a.getHours()+":"+a.getMinutes()),the_date},scope.inspectObject=function(p){scope.json=syntaxHighlight(p),$("#JsonInspector").modal("show")},scope.round=function(numb){return Math.round(1e3*numb)/1e3},scope.fullfill=function(){notie.confirm("This will set the order as completed, and eventually send notifications. Confirm?","Confirm","Cancel",function(){$marketcloud.orders.update(scope.order.id,{status:"completed"}).then(function(response){scope.order.status="completed",notie.alert(1,"Order successfully updated",1)}).catch(function(response){notie.alert(2,"An error has occurred. Please try again.",1)})})},scope.setToProcessing=function(){window.Alert.confirm({title:"Confirm order status update?",message:'This will set the order status to "processing", and eventually send notifications to the customer. Confirm?',onConfirm:function(){$marketcloud.orders.update(scope.order.id,{status:"processing"}).then(function(response){scope.order.status="processing",window.Alert.success({message:"Order successfully updated"})}).catch(function(response){window.Alert.error({})})}})},scope.saveShipment=function(){if($("#shipmentModal .has-error").removeClass("has-error"),$("#shipmentModal .error").remove(),null===scope.newShipment.method)return $('select[ng-model="newShipment.method"]').parent().addClass("has-error"),void $('select[ng-model="newShipment.method"]').parent().append($('<div class="text-danger">This field is required</div>'));scope.newShipment.date&&(scope.newShipment.date=new Date(scope.newShipment.date)),scope.newShipment.delivery_date&&(scope.newShipment.delivery_date=new Date(scope.newShipment.delivery_date));var shipmentToSave=angular.copy(scope.newShipment);http({method:"POST",url:window.API_BASE_URL+"/orders/"+scope.order.id+"/shipments",data:shipmentToSave,headers:{Authorization:window.public_key+":"+window.token}}).then(function(response){scope.newShipment={tracking_code:null,tracking_link:null,date:new Date,delivery_date:new Date,method:null,description:null},scope.order.shipments?scope.order.shipments.push(shipmentToSave):scope.order.shipments=[shipmentToSave],$("#shipmentModal").modal("hide"),scope.saveShipmentAndFullfill===!0&&scope.fullfill(),assignDataToShipments()}).catch(function(response){notie.alert(2,"An error has occurred, please check your input",1.5)})},scope.updateShipment=function(){if($("#esitShipmentModal .has-error").removeClass("has-error"),$("#editShipmentModal .error").remove(),null===scope.shipmentToEdit.method)return $('select[ng-model="shipmentToEdit.method"]').parent().addClass("has-error"),void $('select[ng-model="shipmentToEdit.method"]').parent().append($('<div class="text-danger">This field is required</div>'));var shipmentToSave=angular.copy(scope.shipmentToEdit);shipmentToSave.date&&shipmentToSave.date.toDate&&(shipmentToSave.date=shipmentToSave.date.toDate()),shipmentToSave.delivery_date&&shipmentToSave.delivery_date.toDate&&(shipmentToSave.delivery_date=shipmentToSave.delivery_date.toDate()),http({method:"PUT",url:window.API_BASE_URL+"/orders/"+scope.order.id+"/shipments/"+scope.shipmentToEditIndex,data:shipmentToSave,headers:{Authorization:window.public_key+":"+window.token}}).then(function(response){scope.shipmentToEdit={},$("#editShipmentModal").modal("hide"),notie.alert(1,"Shipment updated",1.5)}).catch(function(error){console.log(error),notie.alert(2,"An error has occurred, please check your input",1.5)})},scope.showShipmentModal=function(){$("#shipmentModal").modal("show")},scope.showEditShipmentModal=function(shipment,index){scope.shipmentToEdit=shipment,scope.shipmentToEditIndex=index,$("#editShipmentModal").modal("show")},scope.showPaymentModal=function(){$("#paymentModal").modal("show")},scope.orderToCSV=function(){},scope.createPDFInvoice=function(){return scope.order.invoice_id?void http({method:"POST",url:window.API_BASE_URL+"/invoices/"+scope.order.invoice_id+"/pdf",headers:{Authorization:window.public_key+":"+window.token}}).then(function(response){var invoiceUrl=response.data.data.url;Object.assign(document.createElement("a"),{target:"_blank",href:invoiceUrl}).click()}).catch(function(error){alert("error"),console.log(error)}):console.log("Order withouth invoice")},scope.createPDFCreditNote=function(refund){http({method:"POST",url:window.API_BASE_URL+"/orders/"+scope.order.id+"/refunds/"+refund.id+"/pdf",headers:{Authorization:window.public_key+":"+window.token}}).then(function(response){var refundUrl=response.data.data.url;Object.assign(document.createElement("a"),{target:"_blank",href:refundUrl}).click()}).catch(function(error){alert("error"),console.log(error)})},scope.savePayment=function(){http({method:"POST",url:window.API_BASE_URL+"/orders/"+scope.order.id+"/payments",data:scope.newPayment,headers:{Authorization:window.public_key+":"+window.token}}).then(function(response){$("#paymentModal").modal("hide"),notie.alert(1,"Payment saved",1.5),scope.order.payments=response.data.data.payments,scope.newPayment={},scope.savePaymentAndSetToProcessing===!0&&scope.setToProcessing()}).catch(function(response){notie.alert(3,"An error has occurred, please try again.",1.5),$("#paymentModal").modal("hide")})}}])},function(module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!(function(){function EditProductTranslationsController(scope,$marketcloud,product,$http,$application,$location,locales){function getSlugFromString(v){return v.split(" ").map(function(item){return item.replace(/\W/g,"")}).map(function(item){return item.toLowerCase()}).join("-")}if(0===$application.getAvailableLocaleCodes().length)return notie.alert(2,"This store has no additional locale. Please add a locale first.",2),$location.path("/system/localization");scope.product=product.data.data,scope.availableLocales=[],scope.locales=locales,scope.availableLocales=[],scope.availableLocales=$application.get().locales.split(",").map(function(code){return scope.locales[code]}),scope.currentLocale=scope.availableLocales[0],scope.customPropertiesData={};var coreProperties=Models.Product.getPropertyNames();scope.unsafeSlug=!1,coreProperties.push("id","variants","variantsDefinition","display_price_discount","display_price","has_variants","type","media","tax_id","locales","seo","requires_shipping","product_id","variant_id","application_id");for(var k in scope.product)coreProperties.indexOf(k)<0&&(scope.customPropertiesData[k]=scope.product[k],delete scope.product[k]);if("product_with_variants"===product.type)for(var localeName in scope.product.locales){var locale=scope.product.locales[localeName];if(!locale.hasOwnProperty("variants")){locale.variants={};for(v_name in scope.product.variantsDefinition){var variant_values_translations={},variant_values=scope.product.variantsDefinition[v_name];variant_values.forEach(function(v){variant_values_translations[v]=""}),locale.variants[v_name]={label:"",values:variant_values_translations}}}}scope.product.hasOwnProperty("locales")||(scope.product.locales={}),scope.customPropertiesDataLocales={},scope.availableLocales.forEach(function(locale){function getTranslatedValueForCustomProperty(k,locale){return"undefined"!=typeof scope.product.locales[locale.code][k]?scope.product.locales[locale.code][k]:{value:scope.customPropertiesData[k],label:k}}scope.product.locales.hasOwnProperty(locale.code)||(scope.product.locales[locale.code]={}),scope.customPropertiesDataLocales[locale.code]={};for(var k in scope.customPropertiesData)scope.customPropertiesDataLocales[locale.code][k]=getTranslatedValueForCustomProperty(k,locale)}),scope.getFlagClassName=function(){return"flag-icon-"+scope.currentLocale.code.slice(-2).toLocaleLowerCase()},scope.isRichText=function(str){if("string"!=typeof str)return!1;var doc=(new DOMParser).parseFromString(str,"text/html");return[].slice.call(doc.body.childNodes).some(function(node){return 1===node.nodeType})},scope.updateSlug=function(){scope.product.locales[scope.currentLocale.code].slug=getSlugFromString(scope.product.locales[scope.currentLocale.code].name)},scope.updateTranslations=function(){var payload={locales:angular.copy(scope.product.locales)};for(var locale in scope.customPropertiesDataLocales){var customPropertiesForSingleLocale=scope.customPropertiesDataLocales[locale];for(var k in customPropertiesForSingleLocale)payload.locales[locale][k]=customPropertiesForSingleLocale[k]}$marketcloud.products.update(scope.product.id,payload).then(function(response){notie.alert(1,"All updates have been saved.",2)}).catch(function(error){notie.alert(3,"An error has occurred, please try again",2)})},scope.filterNotNullProperties=function(item){var result={};for(var k in item)item[k]&&(result[k]=item[k]);return result},scope.typeof=function(y){return"undefined"==typeof y?"undefined":_typeof(y)}}angular.module("DataDashboard").controller("EditProductTranslationsController",EditProductTranslationsController),EditProductTranslationsController.$inject=["$scope","$marketcloud","product","$http","$application","$location","LocalesFactory"]})()},function(module,exports){"use strict";angular.module("DataDashboard").controller("EditBundledProductController",["$scope","$marketcloud","product","$http",function(scope,$marketcloud,product,$http){function getSlugFromString(v){return v.split(" ").map(function(item){return item.replace(/\W/g,"")}).map(function(item){return item.toLowerCase()}).join("-")}if(scope.customPropertiesData={},scope.product=product.data.data,!scope.product.hasOwnProperty())var product_ids=[];scope.product.lists.forEach(function(list){var this_list_ids=list.items.map(function(item){return item.product_id});product_ids=product_ids.concat(this_list_ids)}),scope.addProductsCardConfig={additionalFields:[]},scope.addNewList=function(){scope.product.lists.unshift({name:"",required:!1,items:[]})},scope.removeList=function(index){scope.product.lists.splice(index,1)},scope.showAddProductsToListModal=function(list){scope.currentList=list,$("#addProductsToListModal").modal("show")},$marketcloud.products.list({id:product_ids.join(",")}).then(function(response){var p_map={};response.data.data.forEach(function(i){p_map[i.id]=i}),scope.product.lists.map(function(opt){return opt.items=opt.items.map(function(item){return p_map[item.product_id]}),opt})}).catch(function(error){notie.alert(3,"An error has occurred",1.5)});var coreProperties=Models.Product.getPropertyNames();coreProperties.push("product_id","variant_id","display_price","display_price_discount","lists");for(var k in scope.product)coreProperties.indexOf(k)<0&&(scope.customPropertiesData[k]=scope.product[k],delete scope.product[k]);scope.unsafeSlug=!1,scope.updateSlug=function(){scope.product.slug=getSlugFromString(scope.product.name)},scope.getImagesContainer=function(){return scope.product.images},scope.removeImage=function(i){scope.product.images.splice(i,1)},scope.categories=[],$marketcloud.categories.list().then(function(response){scope.categories=response.data.data}).catch(function(){notie.alert(2,"An error has occurred while loading categories",1.5)}),scope.brands=[],$marketcloud.brands.list().then(function(response){scope.brands=response.data.data}).catch(function(){notie.alert(2,"An error has occurred while loading brands",1.5)}),scope.newAttribute={name:null,value:null,type:null},scope.newAttribute.type="string",scope.availableTypes=[{name:"String",value:"string"},{name:"Number",value:"number"},{name:"Boolean",value:"boolean"}],scope.filterNotNullProperties=function(item){var result={};for(var k in item)item[k]&&(result[k]=item[k]);return result},scope.updateProduct=function(){var update=angular.copy(scope.product);for(var k in scope.customPropertiesData)update[k]=scope.customPropertiesData[k];update.lists.forEach(function(list){list.items=list.items.map(function(item){return{product_id:item.id}})}),$marketcloud.products.update(update.id,update).then(function(response){notie.alert(1,"Update Succeded",1.5)}).catch(function(response){notie.alert(3,"Update failed",1.5)})}}])},function(module,exports){"use strict";angular.module("DataDashboard").controller("NewBundledProductController",["$scope","$http","$location","$marketcloud",function(scope,$http,location,$marketcloud){function getSlugFromString(v){return v.split(" ").map(function(item){return item.replace(/\W/g,"")}).map(function(item){return item.toLowerCase()}).join("-")}scope.categories=[],scope.catch=null,scope.newCategory={},scope.brands=[],scope.newBrand={},scope.getImagesContainer=function(){return scope.product.images},scope.removeImage=function(i){scope.product.images.splice(i,1)},scope.unsafeSlug=!1,scope.updateSlug=function(){scope.product.slug=getSlugFromString(scope.product.name)},scope.loadCategories=function(){$marketcloud.categories.list({}).then(function(response){scope.categories=response.data.data}).catch(function(){console.log("An error has occurred while loading categories")})},scope.loadCategories(),scope.saveCategory=function(){$marketcloud.categories.save(scope.newCategory).then(function(response){$("#newCategoryModal").modal("hide"),scope.categories.push(scope.newCategory),scope.newCategory={}}).catch(function(response){$("#newCategoryModal").hide(),notie.alert(3,"An error has occurred. Category not saved",1)})},scope.loadBrands=function(){$marketcloud.brands.list({}).then(function(response){scope.brands=response.data.data}).catch(function(){notie.alert(2,"An error has occurred while loading brands",1.5)})},scope.loadBrands(),scope.saveBrand=function(){$marketcloud.brands.save(scope.newBrand).then(function(response){$("#newBrandModal").modal("hide"),scope.brands.push(scope.newBrand),scope.newBrand={}}).catch(function(response){$("#newBrandModal").hide(),notie.alert(3,"An error has occurred. Brand not saved",1)})},scope.addProductsCardConfig={additionalFields:[]},scope.addNewList=function(){scope.product.lists.unshift({name:"",required:!1,items:[]})},scope.removeList=function(index){scope.product.lists.splice(index,1)},scope.showAddProductsToListModal=function(list){scope.currentList=list,$("#addProductsToListModal").modal("show")},scope.product={type:"bundled_product",name:"",description:"",stock_type:"status",stock_status:"in_stock",images:[],media:[],has_variants:!1,published:!0,lists:[]},scope.productError=null,scope.newCustomProperty={},scope.customPropertiesData={},scope.Forms={},scope.Forms.newCustomProperty={name:null,value:null},scope.customPropertiesNames=[],scope.hideErrors=function(){scope.catch=null,scope.catchField=null},scope.saveProduct=function(skipSaving){for(var k in scope.product)null===scope.product[k]&&delete scope.product[k];scope.hideErrors();var props_to_validate={},known_props=Models.GroupedProduct.getPropertyNames();for(var k in scope.product)known_props.indexOf(k)>-1&&(props_to_validate[k]=scope.product[k]);for(var k in scope.customPropertiesData)scope.product[k]=scope.customPropertiesData[k];for(var key in scope.product)null===scope.product[key]&&delete scope.product[key];var to_save=angular.copy(scope.product);for(var k in to_save.lists)to_save.lists[k].items=to_save.lists[k].items.map(function(item){return{product_id:item.id}});skipSaving!==!0&&$marketcloud.products.save(to_save).then(function(response){notie.alert(1,"Product saved",1.5),location.path("/products")}).catch(function(response){notie.alert(2,"An error has occurred. Product not saved",1)})}}])},function(module,exports){"use strict";angular.module("DataDashboard").controller("EditConfigurableProductController",["$scope","$marketcloud","product","$http",function(scope,$marketcloud,product,$http){function getSlugFromString(v){return v.split(" ").map(function(item){return item.replace(/\W/g,"")}).map(function(item){return item.toLowerCase()}).join("-")}if(scope.customPropertiesData={},scope.product=product.data.data,!scope.product.hasOwnProperty())var product_ids=[];scope.product.options.forEach(function(option){var this_option_ids=option.items.map(function(item){return item.product_id});product_ids=product_ids.concat(this_option_ids)}),scope.addProductsCardConfig={additionalFields:[]},scope.addNewOption=function(){scope.product.options.unshift({name:"",required:!1,items:[]})},scope.removeOption=function(index){scope.product.options.splice(index,1)},scope.showAddProductsToOptionModal=function(option){scope.currentOption=option,$("#addProductsToOptionModal").modal("show")},$marketcloud.products.list({id:product_ids.join(",")}).then(function(response){var p_map={};response.data.data.forEach(function(i){p_map[i.id]=i}),scope.product.options.map(function(opt){return opt.items=opt.items.map(function(item){return p_map[item.product_id]}),opt})}).catch(function(error){notie.alert(3,"An error has occurred",1.5)});var coreProperties=Models.Product.getPropertyNames();coreProperties.push("product_id","variant_id","display_price","display_price_discount","options");for(var k in scope.product)coreProperties.indexOf(k)<0&&(scope.customPropertiesData[k]=scope.product[k],delete scope.product[k]);scope.unsafeSlug=!1,scope.updateSlug=function(){scope.product.slug=getSlugFromString(scope.product.name)},scope.getImagesContainer=function(){return scope.product.images},scope.removeImage=function(i){scope.product.images.splice(i,1)},scope.categories=[],$marketcloud.categories.list().then(function(response){scope.categories=response.data.data}).catch(function(){notie.alert(2,"An error has occurred while loading categories",1.5)}),scope.brands=[],$marketcloud.brands.list().then(function(response){scope.brands=response.data.data}).catch(function(){notie.alert(2,"An error has occurred while loading brands",1.5)}),scope.newAttribute={name:null,value:null,type:null},scope.newAttribute.type="string",scope.availableTypes=[{name:"String",value:"string"},{name:"Number",value:"number"},{name:"Boolean",value:"boolean"}],scope.filterNotNullProperties=function(item){var result={};for(var k in item)item[k]&&(result[k]=item[k]);return result},scope.updateProduct=function(){var update=angular.copy(scope.product);for(var k in scope.customPropertiesData)update[k]=scope.customPropertiesData[k];update.options.forEach(function(option){option.items=option.items.map(function(item){return{product_id:item.id}})}),$marketcloud.products.update(update.id,update).then(function(response){notie.alert(1,"Update Succeded",1.5)}).catch(function(response){notie.alert(3,"Update failed",1.5)})}}])},function(module,exports){"use strict";angular.module("DataDashboard").controller("NewConfigurableProductController",["$scope","$http","$location","$marketcloud",function(scope,$http,location,$marketcloud){function getSlugFromString(v){return v.split(" ").map(function(item){return item.replace(/\W/g,"")}).map(function(item){return item.toLowerCase()}).join("-")}scope.categories=[],scope.catch=null,scope.newCategory={},scope.brands=[],scope.newBrand={},scope.getImagesContainer=function(){return scope.product.images},scope.removeImage=function(i){scope.product.images.splice(i,1)},scope.unsafeSlug=!1,scope.updateSlug=function(){scope.product.slug=getSlugFromString(scope.product.name)},scope.loadCategories=function(){$marketcloud.categories.list({}).then(function(response){scope.categories=response.data.data}).catch(function(){console.log("An error has occurred while loading categories")})},scope.loadCategories(),scope.saveCategory=function(){$marketcloud.categories.save(scope.newCategory).then(function(response){$("#newCategoryModal").modal("hide"),scope.categories.push(scope.newCategory),scope.newCategory={}}).catch(function(response){$("#newCategoryModal").hide(),notie.alert(3,"An error has occurred. Category not saved",1)})},scope.loadBrands=function(){$marketcloud.brands.list({}).then(function(response){scope.brands=response.data.data}).catch(function(){notie.alert(2,"An error has occurred while loading brands",1.5)})},scope.loadBrands(),scope.saveBrand=function(){$marketcloud.brands.save(scope.newBrand).then(function(response){$("#newBrandModal").modal("hide"),scope.brands.push(scope.newBrand),scope.newBrand={}}).catch(function(response){$("#newBrandModal").hide(),notie.alert(3,"An error has occurred. Brand not saved",1)})},scope.addProductsCardConfig={additionalFields:[]},scope.addNewOption=function(){scope.product.options.unshift({name:"",required:!1,items:[]})},scope.removeOption=function(index){scope.product.options.splice(index,1)},scope.showAddProductsToOptionModal=function(option){scope.currentOption=option,$("#addProductsToOptionModal").modal("show")},scope.product={type:"configurable_product",name:"",description:"",stock_type:"status",stock_status:"in_stock",images:[],media:[],has_variants:!1,published:!0,options:[]},scope.productError=null,scope.newCustomProperty={},scope.customPropertiesData={},scope.Forms={},scope.Forms.newCustomProperty={name:null,value:null},scope.customPropertiesNames=[],scope.hideErrors=function(){scope.catch=null,scope.catchField=null},scope.saveProduct=function(skipSaving){for(var k in scope.product)null===scope.product[k]&&delete scope.product[k];scope.hideErrors();var props_to_validate={},known_props=Models.GroupedProduct.getPropertyNames();for(var k in scope.product)known_props.indexOf(k)>-1&&(props_to_validate[k]=scope.product[k]);for(var k in scope.customPropertiesData)scope.product[k]=scope.customPropertiesData[k];for(var key in scope.product)null===scope.product[key]&&delete scope.product[key];var to_save=angular.copy(scope.product);for(var k in to_save.options)to_save.options[k].items=to_save.options[k].items.map(function(item){return{product_id:item.id}});skipSaving!==!0&&$marketcloud.products.save(to_save).then(function(response){notie.alert(1,"Product saved",1.5),location.path("/products")}).catch(function(response){notie.alert(2,"An error has occurred. Product not saved",1)})}}])},function(module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};angular.module("DataDashboard").controller("ListProductsController",["$scope","$location","$marketcloud","$http","$q","products","$route","$rootScope","StormConfiguration","$utils","$models",function(scope,$location,$marketcloud,http,$q,resources,$route,$rootScope,StormConfiguration,$utils,$models){function importData(items){function push(r){promises.push(r)}console.log("GOING TO IMPORT "+items.length+" PRODUCTS FROM FILE");var defer=$q.defer(),promises=[],failures=[];return items.forEach(function(product){if("simple_product"===product.type&&promises.push($marketcloud.products.save(product).then(push).catch(function(error){failures.push(product)})),"product_with_variants"===product.type){var productWithoutVariants=angular.copy(product);delete productWithoutVariants.variants;var newPromise=$q(function(resolve,reject){return $marketcloud.products.save(productWithoutVariants).then(function(response){var product_id=response.data.data.id;return $marketcloud.variants.save(product_id,product.variants)}).then(resolve).catch(reject)});promises.push(newPromise.then(push).catch(function(error){failures.push(product)}))}}),$q.all(promises).then(function(data){if(failures.length>0){console.log("FAILURES",failures);var msg="<p>Not every item was imported. Import failed for "+failures.length+" items:</p><ul>";failures.forEach(function(item){msg+='<li class="text-left">'+item.name+"</lI>"}),msg+="</ul>",Alert.warning({message:msg})}else Alert.success({message:"All items were imported"});scope.loadPage(1)}).catch(function(){console.log("ALL FINISHED WITH ERROR"),console.log("Failures",failures),notie.alert(2,"Import succeded partially, Only the first "),scope.loadPage(1)}),defer.promise}scope.products=[],scope.selected=[],scope.showBulkControls=!1,scope.selections={},scope.products=resources.data.data,scope.showing_attributes=StormConfiguration.get("products_list_showing_attributes")||[],scope.reserved_attributes=["name","type","price","inventory","published"],scope.pagination={currentPage:resources.data.page,numberOfPages:resources.data.pages,nextPage:resources.data._links.next||null,previousPage:resources.data._links.prev||null,count:resources.data.count},scope.query={per_page:20,page:scope.pagination.currentPage};var urlQuery={};try{urlQuery=JSON.parse($route.current.params.query)}catch(e){urlQuery={}}for(var k in urlQuery)scope.query[k]=urlQuery[k];scope.available_attributes=[],scope.products.forEach(function(p){var new_attributes=Object.keys(p).filter(function(key){return scope.reserved_attributes.indexOf(key)===-1}).filter(function(key){var types=["number","string","boolean"];return types.indexOf(_typeof(p[key]))>-1}).filter(function(key){return scope.available_attributes.indexOf(key)===-1});scope.available_attributes=scope.available_attributes.concat(new_attributes)}),scope.products.forEach(function(product){"simple_product"!==product.type&&"product_with_variants"!==product.type&&(product.hasOwnProperty("variants")&&product.hasOwnProperty("variantsDefinition")?product.type="product_with_variants":product.type="simple_product")}),scope.toggleColumn=function(name){var i=scope.showing_attributes.indexOf(name);i>-1?scope.showing_attributes.splice(i,1):scope.showing_attributes.push(name),StormConfiguration.set("products_list_showing_attributes",scope.showing_attributes)},scope.filterColumnNamesPattern="",scope.filterColumnNames=function(item){return item.indexOf(scope.filterColumnNamesPattern)>-1},scope.filterAttributes=scope.reserved_attributes.concat(scope.available_attributes),scope.applyFilters=function(filters){filters.forEach(function(filter){scope.query[filter.name]=filter.value}),scope.loadData()},scope.applySorting=function(){scope.loadData(),$("#sortingModal").modal("hide")},scope.sortByColumn=function(columnName){var order=null;order="DESC"===scope.query.sort_order?"ASC":"DESC",scope.query.sort_by=columnName,scope.query.sort_order=order,scope.loadData()},scope.isItemSelected=function(item){return scope.selected.indexOf(item.id)>-1},scope.toggleItemSelection=function(item){if(!scope.isItemSelected(item))return scope.selected.push(item.id);for(var i=scope.selected.length-1;i>=0;i--)scope.selected[i]===item.id&&scope.selected.splice(i,1)},scope.toggleAll=function(){scope.selectAll===!1?scope.selected=[]:scope.selected=scope.products.map(function(product){return product.id})},scope.$watch("selected",function(newValue,oldValue){var tmp={};scope.selected.forEach(function(id){tmp[id]=!0}),scope.selections=tmp}),scope.getSelectedItems=function(){return scope.products.filter(function(p){return scope.isItemSelected(p)})},scope.bulkSetPublishing=function(flag){var defer=$q.defer(),promises=[];return scope.getSelectedItems().forEach(function(product){promises.push($marketcloud.products.update(product.id,{published:flag}))}),$q.all(promises).then(function(){notie.alert(1,"All products have been updated",1.5),scope.loadPage(scope.pagination.currentPage)}),defer.promise},scope.bulkDelete=function(){notie.confirm("Delete "+scope.getSelectedItems().length+" products?","Delete","Cancel",function(){var defer=$q.defer(),promises=[];return scope.getSelectedItems().forEach(function(product){promises.push($marketcloud.products.delete(product.id))}),$q.all(promises).then(function(){notie.alert(1,"All products have been deleted",1.5),scope.loadPage(scope.pagination.currentPage)}),defer.promise})},scope.bulkJSONExport=function(){return 0===scope.getSelectedItems().length?$utils.exportAsJSON(scope.products):void $utils.exportAsJSON(scope.getSelectedItems())},scope.bulkCSVExport=function(){var _data=scope.getSelectedItems();0===_data.length&&(_data=scope.products);var bucket=[];_data.forEach(function(product){if("simple_product"===product.type)bucket.push(product);else if("product_with_variants"===product.type){var productWithoutVariants=angular.copy(product);delete productWithoutVariants.variants,bucket.push(productWithoutVariants);product.variants.forEach(function(i){i.type="variant",bucket.push(i)})}else bucket.push(product)}),_data=bucket,console.log("Prima di flatten",angular.copy(_data)),_data=_data.map($utils.flatten),console.log("Dopo di flatten",angular.copy(_data));var _csv=$utils.JSONToCSV(_data);return console.log("IL CSV",angular.copy(_csv)),$utils.exportAsCSV(_csv)},scope.importProducts=function(){notie.alert(4,"Contact us at info@marketcloud.studio404.net with import subject",1.5)},scope.chooseJSONFile=function(){scope.importMode="JSON",document.querySelector("#JSONFileInput").click()},scope.chooseCSVFile=function(){scope.importMode="CSV",document.querySelector("#CSVFileInput").click()},scope.JSONFileChanged=function(){var file=document.getElementById("JSONFileInput").files[0];if(document.getElementById("JSONFileInput").value="",file){var reader=new FileReader;reader.readAsText(file,"UTF-8"),reader.onload=function(evt){
try{var jsonLines=JSON.parse(evt.target.result)}catch(e){return Alert.error({message:"Invalid JSON file, please check file syntax"})}scope.importJSON(jsonLines)},reader.onerror=function(evt){notie.alert(3,"error reading file",2)}}},scope.CSVFileChanged=function(){var file=document.getElementById("CSVFileInput").files[0];if(document.getElementById("CSVFileInput").value="",file){var reader=new FileReader;reader.readAsText(file,"UTF-8"),reader.onload=function(evt){var csvFileContent=evt.target.result,productsToImport=$utils.CSVToJSON(csvFileContent);productsToImport=productsToImport.map($utils.unflatten),scope.importJSON(productsToImport)},reader.onerror=function(evt){notie.alert(3,"error reading file",2)}}},scope.uploadJSON=function(){var jsonLines=JSON.parse(scope.fileContent);console.log("jsonLines Ã¨ ",jsonLines),scope.importJSON(jsonLines)},scope.uploadCSV=function(){console.log("To implement...")},scope.importJSON=function(lines){for(var productsToImport=[],invalidItems=[],i=0;i<lines.length;i++){var line=lines[i];if("simple_product"===line.type){var validation=$models.Product.validate(line);if(!1===validation.valid){Alert.error({message:"Please check your import file. Element number "+String(i+1)+" is invalid."}),invalidItems.push(line);break}productsToImport.push(line)}else if("product_with_variants"===line.type){var validation=$models.ProductWithVariants.validate(line);if(!1===validation.valid){Alert.error({message:"Please check your import file. Element number "+String(i+1)+" is invalid."}),invalidItems.push(line);break}productsToImport.push(line)}else if("variant"===line.type){productsToImport[productsToImport.length-1].variants||(productsToImport[productsToImport.length-1].variants=[]);var validation=$models.Variant.validate(line);if(!1===validation.valid){Alert.error({message:"Please check your import file. Element number "+String(i+1)+" is invalid."}),invalidItems.push(line);break}productsToImport[productsToImport.length-1].variants.push(line)}else notie.alert(3,"Invalid data",2)}0===invalidItems.length?(console.log("Ecco cosa importare",productsToImport),importData(productsToImport)):(console.log("validation",validation),console.log("Import aborted due to invalid items",invalidItems))},scope.cloneProduct=function(product_to_duplicate){var product_to_save=angular.copy(product_to_duplicate);switch(delete product_to_save.id,delete product_to_save.product_id,delete product_to_save.variant_id,delete product_to_save._id,product_to_save.name+=" (Copy)",product_to_save.published=!1,product_to_save.stock_type){case"track":delete product_to_save.stock_status;break;case"status":delete product_to_save.stock_level;break;case"infinite":delete product_to_save.stock_level,delete product_to_save.stock_status}delete product_to_save.variants,$marketcloud.products.save(product_to_save).then(function(response){if(console.log("RESPONSATI",response),product_to_save.has_variants===!0||"product_with_variants"===product_to_save.type)return http({method:"POST",url:API_BASE_URL+"/products/"+response.data.data.id+"/variants",data:product_to_duplicate.variants,headers:{Authorization:window.public_key+":"+window.token}})}).then(function(response){scope.loadPage(scope.pagination.currentPage),notie.alert(1,"Product successfully cloned",1.5)}).catch(function(response){notie.alert(3,"An error has occurred. Please try again.",1.5)})},scope.setPublishing=function(prod){$marketcloud.products.update(prod.id,{published:prod.published}).then(function(response){notie.alert(1,"Updated!",1.5)}).catch(function(response){notie.alert(3,"An error has occurred, please try again.",1.5)})},scope.alterColumnNames=function(name){return"stock_level"===name?"Inventory":name},scope.prepareRegex=function(){scope.query.name.$options="i"},scope.loadData=function(query){if(""===scope.query.q&&delete scope.query.q,query){if("object"!==("undefined"==typeof query?"undefined":_typeof(query)))throw new TypeError("loadData(query) query must be an object of filters");for(var k in query)scope.query[k]=query[k]}return $marketcloud.products.list(scope.query).then(function(response){scope.pagination={currentPage:response.data.page,numberOfPages:response.data.pages,nextPage:response.data._links.next||null,previousPage:response.data._links.prev||null,count:response.data.count},window.history.pushState(scope.query,"List products","#/products?query="+angular.$$encodeUriSegment(JSON.stringify(scope.query))),scope.products=response.data.data}).catch(function(response){notie.alert(3,"An error has occurred. Please try again",1.5)})},scope.loadPage=function(page_number){scope.query.page=Number(page_number),scope.loadData()},scope.deleteProduct=function(prod_id,index){http({method:"DELETE",url:API_BASE_URL+"/products/"+prod_id,headers:{Authorization:window.public_key+":"+window.token}}).then(function(response){scope.loadPage(scope.pagination.currentPage),notie.alert(1,"Product deleted",1.5)}).catch(function(response){notie.alert(3,"An error has occurred.Please try again.",1.5)})}}])},function(module,exports){"use strict";angular.module("DataDashboard").controller("EditProductWithVariantsController",["$scope","$marketcloud","product","$http","$utils",function(scope,$marketcloud,product,$http,$utils){scope.customPropertiesData={},scope.product=product.data.data;var coreProperties=Models.Product.getPropertyNames();coreProperties.push("id","currencies","display_price","display_price_discount","has_variants","type","media","tax_id","locales","seo","requires_shipping","variants","variantsDefinition","product_id","variant_id","application_id");for(var k in scope.product)coreProperties.indexOf(k)<0&&(scope.customPropertiesData[k]=scope.product[k],delete scope.product[k]);scope.unsafeSlug=!1,scope.updateSlug=function(){scope.product.slug=$utils.getSlugFromString(scope.product.name)},scope.getImagesContainer=function(){return scope.product.images},scope.removeImage=function(i){scope.product.images.splice(i,1)},scope.categories=[],$marketcloud.categories.list().then(function(response){scope.categories=response.data.data}).catch(function(){console.error("An error has occurred while loading categories")}),scope.brands=[],$marketcloud.brands.list().then(function(response){scope.brands=response.data.data}).catch(function(){console.error("An error has occurred while loading brands")}),scope.filterVariantProps=function(o){var p={};for(var k in o)scope.product.variantsDefinition.hasOwnProperty(k)&&(p[k]=o[k]);return p},scope.getVariantStyle=function(i){var r=["label-info","label-danger","label-warning","label-success"];return r[i%r.length]},scope.getVariantStyle=function(i){var r=[{color:"red"},{color:"green"},{color:"blue"},{color:"pink"}];return r[i%r.length]},scope.newAttribute={name:null,value:null,type:null},scope.newAttribute.type="string",scope.availableTypes=[{name:"String",value:"string"},{name:"Number",value:"number"},{name:"Boolean",value:"boolean"}],scope.filterNotNullProperties=function(item){var result={};for(var k in item)item[k]&&(result[k]=item[k]);return result},scope.newVariant={},scope.saveNewVariant=function(){var variantToSave=angular.copy(scope.product);delete variantToSave.variants,delete variantToSave.type,delete variantToSave.variantsDefinition,delete variantToSave.is_master,delete variantToSave.has_variants,delete variantToSave.published;for(var k in scope.newVariant)scope.product.variantsDefinition[k].indexOf(scope.newVariant[k])<0&&scope.product.variantsDefinition[k].push(scope.newVariant[k]),variantToSave[k]=scope.newVariant[k];scope.updateProduct().then(function(response){return $http({method:"POST",url:API_BASE_URL+"/products/"+scope.product.id+"/variants",data:variantToSave,headers:{Authorization:window.public_key+":"+window.token}})}).then(function(response){notie.alert(1,"Variant successfully created",1),scope.product=response.data.data,$("#addVariantModal").modal("hide")}).catch(function(response){notie.alert(2,"An error has occurred. Variants not saved",1)})},scope.deleteVariant=function(variant,i){return $http({method:"DELETE",url:API_BASE_URL+"/products/"+scope.product.id+"/variants/"+variant.id,headers:{Authorization:window.public_key+":"+window.token}}).then(function(response){notie.alert(1,"Variant deleted",1.5),scope.product.variants.splice(i,1)}).catch(function(response){notie.alert(3,"An error has occurred, please try again.",1.5)})},scope.updateProduct=function(){var payload=angular.copy(scope.product);for(var k in scope.customPropertiesData)payload[k]=scope.customPropertiesData[k];switch(payload.stock_type){case"infinite":delete payload.stock_level,delete payload.stock_status;break;case"status":delete payload.stock_level;break;case"track":delete payload.stock_status}return $marketcloud.products.update(payload.id,payload).then(function(response){notie.alert(1,"Update Succeded",1.5)}).catch(function(response){notie.alert(3,"Update failed",1.5)})}}])},function(module,exports){"use strict";angular.module("DataDashboard").controller("NewProductWithVariantsController",["$scope","$http","$location","$marketcloud","$utils",function(scope,$http,location,$marketcloud,$utils){function attachInheritedProperties(variants){return variants.map(function(variant){return console.log("ATTACHO LE INHERITED PROPERTIES DA ",angular.copy(scope.product)),scope.properties_to_inherit.forEach(function(i,index){scope.product[i]&&(variant[i]=scope.product[i])}),variant})}function getArrayOfVariants2(variants){if(variants=variants.filter(function(v){return v.values.length>0}),0===variants.length)return[];if(1===variants.length){var result=[];return variants[0].values.forEach(function(v){var o={};o[variants[0].name]=v,result.push(o)}),result}for(var combine=function(v1,v2){var output=[];if(v1 instanceof Array){var _out=[];return v1.forEach(function(variant){v2.values.forEach(function(value){var o=angular.copy(variant);o[v2.name]=value,_out.push(o)})}),_out}return v1.values.forEach(function(val1){v2.values.forEach(function(val2){var o={};o[v1.name]=val1,o[v2.name]=val2,output.push(o)})}),output},counter=0,out=[];variants[counter+1];)out=combine(variants[counter],variants[counter+1]),variants[counter+1]=out,counter++;return out}scope.categories=[],scope.error=null,scope.newCategory={},scope.brands=[],scope.newBrand={},scope.addedVariants={};var coreProperties=Models.Product.getPropertyNames();coreProperties.push("id","display_price","display_price_discount","has_variants","type","media","tax_id","locales","seo","requires_shipping","variants","variantsDefinition","product_id","variant_id","application_id"),scope.isBoolean=function(d){return"boolean"==typeof d},scope.isString=function(d){return"string"==typeof d},scope.isNumber=function(d){return"number"==typeof d},scope.getImagesContainer=function(){return scope.product.images},scope.removeImage=function(i){scope.product.images.splice(i,1)},scope.unsafeSlug=!1,scope.updateSlug=function(){scope.product.slug=$utils.getSlugFromString(scope.product.name)},scope.loadCategories=function(){$marketcloud.categories.list({}).then(function(response){scope.categories=response.data.data}).catch(function(){notie.alert(2,"An error has occurred while loading categories",2)})},scope.loadCategories(),scope.query={type:"product_with_variants"},scope.prepareRegex=function(){scope.query.name.$options="i"},scope.showTheList=!1,scope.showList=function(){scope.showTheList=!0},scope.hideList=function(){window.setTimeout(function(){scope.showTheList=!1,scope.$apply()},200)},scope.applyTemplate=function(product){var tpl=angular.copy(product);console.log("====================","Vado ad applicare questo template",angular.copy(tpl),"=========================="),delete tpl.id,scope.addedVariants2=[];for(var k in tpl.variantsDefinition){var newAddedVariant={name:k,values:tpl.variantsDefinition[k].map(function(v){return{text:v}})};scope.addedVariants2.push(newAddedVariant)}scope.computedVariants=tpl.variants.map(function(item){var v=angular.copy(item);return delete v.id,delete v.product_id,delete v.variant_id,v}),console.log("Ora computedVariants Ã¨",angular.copy(scope.computedVariants)),delete tpl.variants,scope.product=tpl,scope.product.stock_type=tpl.stock_type||"status",scope.product.stock_status=tpl.stock_status||"in_stock",console.log("Applicato questo template",tpl),console.log("Dopo updateVariantsConfiguration",angular.copy(scope.computedVariants));for(var k in scope.product)coreProperties.indexOf(k)<0&&(scope.customPropertiesData[k]=scope.product[k],delete scope.product[k])},scope.loadProducts=function(query){query=query||scope.query,$marketcloud.products.list(query).then(function(response){scope.products=response.data.data}).catch(function(response){notie.alert(3,"An error has occurred. Please try again",1.5)})},scope.loadProducts(),scope.saveCategory=function(){$marketcloud.categories.save(scope.newCategory).then(function(response){$("#newCategoryModal").modal("hide"),scope.categories.push(scope.newCategory),scope.newCategory={}}).catch(function(response){$("#newCategoryModal").hide(),notie.alert(3,"An error has occurred. Category not saved",1)})},scope.loadBrands=function(){$marketcloud.brands.list({}).then(function(response){scope.brands=response.data.data}).catch(function(){notie.alert(2,"An error has occurred while loading brands",2)})},scope.loadBrands(),window.inspect=function(){console.log(angular.copy(scope.product))},scope.saveBrand=function(){$marketcloud.brands.save(scope.newBrand).then(function(response){$("#newBrandModal").modal("hide"),scope.brands.push(scope.newBrand),scope.newBrand={}}).catch(function(response){$("#newBrandModal").hide(),notie.alert(3,"An error has occurred. Brand not saved",1)})},scope.product={type:"product_with_variants",name:"",description:"",stock_type:"status",stock_status:"in_stock",images:[],variants:{},published:!1,has_variants:!0},scope.customPropertiesData={},scope.customPropertiesNames=[],scope.computedVariants=[],scope.updateStockManagementForVariants=function(){var stock_type=scope.product.stock_type;return"track"===stock_type?(delete scope.product.stock_status,void scope.computedVariants.forEach(function(v){delete v.stock_status})):"status"===stock_type?(delete scope.product.stock_level,void scope.computedVariants.forEach(function(v){delete v.stock_level})):"infinite"===stock_type?(delete scope.product.stock_status,delete scope.product.stock_level,void scope.computedVariants.forEach(function(v){delete v.stock_level,delete v.stock_status})):void 0},scope.properties_to_inherit=["price","sku","stock_level","stock_type","stock_status"],scope.filterVariantProps=function(o){var p={};for(var k in o)scope.properties_to_inherit.indexOf(k)<0&&"save"!==k&&(p[k]=o[k]);return p},scope.filterVariantProps=function(o){var variantNames=scope.addedVariants2.map(function(v){return v.name}),p={};for(var k in o)variantNames.indexOf(k)>-1&&(p[k]=o[k]);return p},scope.getVariantStyle=function(i){var r=[{color:"red"},{color:"green"},{color:"blue"},{color:"pink"}];return r[i%r.length]},scope.deleteVariant=function(variantName,$index){scope.addedVariants2.splice($index,1),scope.updateVariantsConfiguration()},scope.addedVariants2=[],scope.addEmptyVariant=function(){scope.addedVariants2.push({name:"",values:[]})},scope.updateVariantsConfiguration=function(){scope.computedVariants=[],scope.addedVariants={},scope.addedVariants2.forEach(function(variant){scope.addedVariants[variant.name]=variant.values.map(function(i){return i.text}),variant.values=variant.values.map(function(i){return i.text})});var temp_ComputedVariants=getArrayOfVariants2(angular.copy(scope.addedVariants2));scope.computedVariants=temp_ComputedVariants,scope.computedVariants=attachInheritedProperties(temp_ComputedVariants),scope.computedVariants.forEach(function(v){v.save=!0}),scope.product.variantsDefinition=scope.addedVariants},scope.getVariantClass=function(i){var classes=["label-default","label-info","label-success","label-warning","label-danger"];return"label solid "+classes[i%classes.length]},scope.hideErrors=function(){scope.error=null,scope.errorField=null},scope.saveProduct=function(overwrites){for(var k in scope.product)null===scope.product[k]&&delete scope.product[k];scope.hideErrors(),scope.product.variants=[];var props_to_validate={},known_props=Models.Product.getPropertyNames();for(var k in scope.product)known_props.indexOf(k)>-1&&(props_to_validate[k]=scope.product[k]);var validation=Models.Product.validate(props_to_validate);if(validation.valid===!1)return scope.errorField=validation.invalidPropertyName,void("required"===validation.failedValidator?scope.error="The "+scope.errorField+" field is required":"min"===validation.failedValidator?"string"==typeof scope.product[validation.invalidPropertyName]?scope.error="The "+scope.errorField+" field must have at least "+Models.Product.schema[validation.invalidPropertyName].min+" characters":scope.error="The "+scope.errorField+" field must be greater than or equal to "+Models.Product.schema[validation.invalidPropertyName].min:"max"===validation.failedValidator?"string"==typeof scope.product[validation.invalidPropertyName]?scope.error="The "+scope.errorField+" field must have less than "+Models.Product.schema[validation.invalidPropertyName].max+" characters":scope.error="The "+scope.errorField+" field must be lesser than or equal to "+Models.Product.schema[validation.invalidPropertyName].min:scope.error="The "+scope.errorField+" field has an invalid value ("+props_to_validate[scope.errorField]+")");for(var k in scope.customPropertiesData)scope.product[k]=scope.customPropertiesData[k];for(var key in scope.product)null===scope.product[key]&&delete scope.product[key];var variantsToSave=angular.copy(scope.computedVariants.filter(function(variant){return variant.save===!0}).map(function(variant){var obj=angular.copy(scope.product);delete obj.variants,delete obj.variantsDefinition,delete obj.is_master,delete obj.has_variants,delete obj.published;for(var k in variant)obj[k]=variant[k];return delete variant.save,obj}));for(var k in overwrites)scope.product[k]=overwrites[k];$marketcloud.products.save(scope.product).then(function(response){var savedProduct=response.data.data;$http({method:"POST",url:API_BASE_URL+"/products/"+savedProduct.id+"/variants",data:variantsToSave,headers:{Authorization:window.public_key+":"+window.token}}).then(function(response){notie.alert(1,"Product successfully created",1),location.path("/products")}).catch(function(response){notie.alert(2,"An error has occurred. Variants not saved",1)})}).catch(function(response){notie.alert(2,"An error has occurred. Product not saved",1)})}}])},function(module,exports){"use strict";!(function(){function EditSimpleProductController(scope,$marketcloud,product,$http,$utils,$validation){scope.product=product.data.data,scope.customPropertiesData={},scope.unsafeSlug=!1;var coreProperties=Models.Product.getPropertyNames();scope.schema=Models.Product.schema,coreProperties.push("id","currencies","display_price_discount","display_price","has_variants","type","media","tax_id","locales","seo","requires_shipping","product_id","variant_id","application_id");for(var k in scope.product)coreProperties.indexOf(k)<0&&(scope.customPropertiesData[k]=scope.product[k],delete scope.product[k]);scope.updateSlug=function(){scope.product.slug=$utils.getSlugFromString(scope.product.name)},scope.swapArrayItemPosition=function(fromIndex,toIndex,target){var toMove=JSON.parse(JSON.stringify(target[fromIndex]));fromIndex>target.length-1||(target.splice(fromIndex,1),target.splice(toIndex,0,toMove))},scope.getImagesContainer=function(){return scope.product.images},scope.removeImage=function(i){scope.product.images.splice(i,1)},scope.newAttribute={name:null,value:null,type:null},scope.newAttribute.type="string",scope.availableTypes=[{name:"String",value:"string"},{name:"Number",value:"number"},{name:"Boolean",value:"boolean"}],scope.filterNotNullProperties=function(item){var result={};for(var k in item)item[k]&&(result[k]=item[k]);return result},scope.updateProduct=function(){for(var k in scope.customPropertiesData)scope.product[k]=scope.customPropertiesData[k];switch(scope.product.stock_type){case"status":delete scope.product.stock_level;break;case"track":delete scope.product.stock_status}$marketcloud.products.update(scope.product.id,scope.product).then(function(response){notie.alert(1,"Update Succeded",1.5)}).catch(function(error){if(console.log("erore",error),400===error.status){notie.alert(2,"Please check the data you entered",1.5);var validation=error.data.errors[0],invalidPropertyName="product."+validation.invalidPropertyName;angular.element('[ng-model="'+invalidPropertyName+'"]').parent();$validation.showErrorMessage(validation,'[ng-model="'+invalidPropertyName+'"]')}else notie.alert(3,"Update failed",1.5)})}}angular.module("DataDashboard").controller("EditSimpleProductController",EditSimpleProductController),EditSimpleProductController.$inject=["$scope","$marketcloud","product","$http","$utils","$validation"]})()},function(module,exports){"use strict";angular.module("DataDashboard").controller("NewSimpleProductController",["$scope","$http","$location","$marketcloud","$utils","$models",function(scope,$http,location,$marketcloud,$utils,Models){scope.error=null,scope.brands=[],scope.newBrand={},scope.validation={valid:!0},console.log("Cerco qui le core propseties",Models.Product,Models);var coreProperties=Models.Product.getPropertyNames();coreProperties.push("id","display_price_discount","display_price","has_variants","type","media","tax_id","locales","seo","requires_shipping","product_id","variant_id","application_id"),scope.product={price:null,name:"",description:"",stock_type:"status",images:[],media:[],published:!1,type:"simple_product"},scope.removeImage=function(i){scope.product.images.splice(i,1)},scope.unsafeSlug=!1,scope.updateSlug=function(){scope.product.slug=$utils.getSlugFromString(scope.product.name)},scope.applyTemplate=function(product){var tpl=angular.copy(product);delete tpl.id,scope.product=tpl;for(var k in scope.product)coreProperties.indexOf(k)<0&&(scope.customPropertiesData[k]=scope.product[k],delete scope.product[k])},scope.query={type:"simple_product"},scope.prepareRegex=function(){scope.query.name.$options="i"},scope.showTheList=!1,scope.showList=function(){scope.showTheList=!0},scope.hideList=function(){window.setTimeout(function(){scope.showTheList=!1,scope.$apply()},200)},scope.loadProducts=function(query){query=query||scope.query,$marketcloud.products.list(query).then(function(response){scope.products=response.data.data}).catch(function(response){notie.alert(3,"An error has occurred. Please try again",1.5)})},scope.loadProducts(),scope.productError=null,scope.newCustomProperty={},scope.customPropertiesData={},scope.Forms={},scope.Forms.newCustomProperty={name:null,value:null},scope.customPropertiesNames=[],scope.properties_to_inherit=["price","sku","stock_level","stock_type","stock_status"],scope.hideErrors=function(){scope.error=null,scope.errorField=null},scope.saveProduct=function(overwrites){for(var k in scope.product)null===scope.product[k]&&delete scope.product[k];if(scope.hideErrors(),scope.validation=Models.Product.validate(scope.product),scope.validation.valid!==!1){for(var kk in scope.customPropertiesData)scope.product[kk]=scope.customPropertiesData[kk];for(var key in scope.product)null===scope.product[key]&&delete scope.product[key];for(var k in overwrites)scope.product[k]=overwrites[k];$marketcloud.products.save(scope.product).then(function(response){notie.alert(1,"Product saved successfully.",1.5),location.path("/products")}).catch(function(error){return 400===error.status?void(scope.validation=error.data.errors[0]):void notie.alert(2,"An error has occurred. Product not saved",1)})}}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("EditPromotionController",["$scope","$http","$marketcloud","promotion",function(scope,http,$marketcloud,promotion){scope.promotion=promotion.data.data,scope.newCondition={},scope.newEffect={},scope.save=function(){scope.$promotionValidation=window.Models.Promotion.validate(scope.promotion),scope.$promotionValidation.valid===!0&&$marketcloud.promotions.update(scope.promotion.id,scope.promotion).then(function(response){notie.alert(1,"Promotion saved",1.5)}).catch(function(response){notie.alert(3,"An error has occurred. Promotion not saved",1.5)})},scope.addCondition=function(){scope.$newConditionValidation=window.Models.PromotionCondition.validate(scope.newCondition),scope.$newConditionValidation.valid===!0&&(scope.promotion.conditions.push(scope.newCondition),scope.newCondition={})},scope.removeCondition=function(i){scope.promotion.conditions.splice(i,1)},scope.removeEffect=function(i){scope.promotion.effects.splice(i,1)},scope.addEffect=function(){scope.$newEffectValidation=window.Models.PromotionEffect.validate(scope.newEffect),scope.$newEffectValidation.valid===!0&&(scope.promotion.effects.push(scope.newEffect),scope.newEffect={})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("NewPromotionController",["$scope","$http","$marketcloud","$location",function(scope,http,$marketcloud,location){scope.promotion={name:null,conditions:[],effects:[],active:!1,priority:0},scope.newCondition={},scope.newEffect={},scope.save=function(){scope.$promotionValidation=window.Models.Promotion.validate(scope.promotion),scope.$promotionValidation.valid===!0&&$marketcloud.promotions.save(scope.promotion).then(function(response){notie.alert(1,"Promotion saved",1.5),location.path("/promotions")}).catch(function(response){notie.alert(3,"An error has occurred. Promotion not saved",1.5)})},scope.addCondition=function(){scope.$newConditionValidation=window.Models.PromotionCondition.validate(scope.newCondition),scope.$newConditionValidation.valid===!0&&(scope.promotion.conditions.push(scope.newCondition),scope.newCondition={})},scope.removeCondition=function(i){scope.promotion.conditions.splice(i,1)},scope.removeEffect=function(i){scope.promotion.effects.splice(i,1)},scope.addEffect=function(){scope.$newEffectValidation=window.Models.PromotionEffect.validate(scope.newEffect),scope.$newEffectValidation.valid===!0&&(scope.promotion.effects.push(scope.newEffect),scope.newEffect={})}}])},function(module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},app=angular.module("DataDashboard");app.controller("ListResourcesController",["$scope","resources","resourceName","$q","$marketcloud","dependencies","$utils",function(scope,resources,resource_name,$q,$marketcloud,$dependencies,$utils){scope.resources=resources.data.data,scope.dependencies={},scope.$dependencies=$dependencies,scope.pagination=$utils.getPaginationFromHTTPResponse(resources),scope.query={per_page:20},scope.prepareRegex=function(){for(var k in scope.query)"object"===_typeof(scope.query[k])&&scope.query[k].hasOwnProperty("$regex")&&(scope.query[k].$options="i")},scope.toggleAll=function(){scope.resources.forEach(function(p){p.selected=scope.selectAll})},scope.getSelectedItems=function(){return scope.resources.filter(function(p){return p.selected===!0})},scope.update=function(id,update){return $marketcloud[resource_name].update(id,update).then(function(response){notie.alert(1,"Item updated.",1.5)}).catch(function(error){notie.alert(3,"An error has occurred, please try again.",1.5)})},scope.bulkDelete=function(){notie.confirm("Delete "+scope.getSelectedItems().length+" items?","Delete","Cancel",function(){var defer=$q.defer(),promises=[];return scope.getSelectedItems().forEach(function(item){promises.push($marketcloud[resource_name].delete(item.id))}),$q.all(promises).then(function(){notie.alert(1,"All items have been deleted",1.5),scope.loadData()}),defer.promise})},scope.bulkUpdate=function(update){notie.confirm("Update "+scope.getSelectedItems().length+" items?","Update","Cancel",function(){var defer=$q.defer(),promises=[];return scope.getSelectedItems().forEach(function(item){promises.push($marketcloud[resource_name].update(item.id,update))}),$q.all(promises).then(function(){notie.alert(1,"All items have been updated",1.5),scope.loadData()}),defer.promise})},scope.bulkJSONExport=function(){return 0===scope.getSelectedItems().length?$utils.exportAsJSON(scope.resources):void $utils.exportAsJSON(scope.getSelectedItems())},scope.toggle=function(resource){$marketcloud[resource_name].update(resource.id,resource).then(function(response){notie.alert(1,"Update successful",1.5)}).catch(function(error){notie.alert(3,"An error has occurred, please try again.",1.5)})},scope.loadPage=function(page_number){return scope.query.page=page_number,scope.loadData()},scope.resetQuery=function(){var currentPage=scope.query.page||1;scope.query={per_page:20,page:currentPage}},scope.loadData=function(query){if(query){if("object"!==("undefined"==typeof query?"undefined":_typeof(query)))throw new TypeError("loadData(query) query must be an object of filters");for(var k in query)scope.query[k]=query[k]}if($dependencies.queryOverrides)for(var k in $dependencies.queryOverrides)scope.query[k]=$dependencies.queryOverrides[k];return $marketcloud[resource_name].list(scope.query).then(function(response){scope.resources=response.data.data,scope.pagination=$utils.getPaginationFromHTTPResponse(response)}).catch(function(response){notie.alert(3,"An error has occurred. Please try again.",1.5)})},scope.delete=function(resource_id,index){$marketcloud[resource_name].delete(resource_id).then(function(response){scope.loadData(),notie.alert(1,"Item deleted",1.5)}).catch(function(response){notie.alert(3,"An error has occurred.Please try again.",1.5)})},scope.clone=function(instance){var toSave=angular.copy(instance);delete toSave.id,delete toSave._id,toSave.name?toSave.name+=" (Copy)":toSave.title&&(toSave.title+=" (Copy)"),$marketcloud[resource_name].save(toSave).then(function(response){scope.loadData(),notie.alert(1,"Item successfully cloned",1.5)}).catch(function(response){notie.alert(3,"An error has occurred. Please try again.",1.5)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("SettingsController",["$scope","$http","Currencies","Timezones","Countries","$application",function(scope,http,currencies,timezones,countries,$application){scope.countries=countries,scope.timezones=timezones,scope.application=$application.get(),scope.images=[],scope.application.apply_discounts_before_taxes=Boolean(scope.application.apply_discounts_before_taxes),scope.application.show_prices_plus_taxes=Boolean(scope.application.show_prices_plus_taxes),console.log(scope.application),scope.currencies=Object.keys(currencies).map(function(c){return currencies[c]}).map(function(c){return c.label=c.name+" ("+c.symbol+")",c}).sort(function(a,b){return a=a.name,b=b.name,a>b?1:b>a?-1:0}),scope.tax_options=[{value:"nothing",label:"Don't tax"},{value:"products_only",label:"Tax products only"},{value:"shipping_only",label:"Tax shipping only"},{value:"all",label:"Tax shipping and products"}],scope.refreshApplicationData=function(){$http({url:"/applications/list/"+Number(scope.application.id),method:"GET"}).then(function(response){$application.set(response.data.data)}).catch(function(error){notie.alert(3,"An error has occurred while reloading application's data. Refreshing the page..."),window.location.reload()})},scope.updateSettings=function(){var payload={name:scope.application.name,url:scope.application.url,timezone:scope.application.timezone,currency_code:scope.application.currency_code,tax_rate:scope.application.tax_rate,tax_type:scope.application.tax_type,apply_discounts_before_taxes:scope.application.apply_discounts_before_taxes,show_prices_plus_taxes:scope.application.show_prices_plus_taxes,email_address:scope.application.email_address,company_name:scope.application.company_name,company_taxid:scope.application.company_taxid,
company_country:scope.application.company_country,company_state:scope.application.company_state,company_city:scope.application.company_city,company_address:scope.application.company_address,company_postalcode:scope.application.company_postalcode,invoices_prefix:scope.application.invoices_prefix};console.log(payload),scope.images.length>=1&&(payload.logo=scope.images[0]),http({method:"PUT",url:window.API_BASE_URL+"/application",data:payload,headers:{"Content-Type":"application/json",Authorization:window.public_key+":"+window.token}}).then(function(response){notie.alert(1,"Application successfully updated",1)}).catch(function(err){notie.alert(3,"An error has occurred.")})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("EditShippingController",["$scope","$http","$location","Countries","shipping","$marketcloud","$validation","$models",function(scope,http,location,countries,shippingRequest,$marketcloud,$validation,$models){scope.availableRules=["max_value","min_value","max_weight","min_weight","max_height","min_height","max_depth","min_depth","max_width","min_width"],scope.getShippingRules=function(){var o={};for(var k in scope.shipping)scope.availableRules.indexOf(k)>-1&&(o[k]=angular.copy(scope.shipping[k]));return o},scope.howManyRules=function(o){var count=0;for(var k in scope.shipping)scope.availableRules.indexOf(k)>-1&&count++;return count},scope.countries=angular.copy(countries),scope.countries.unshift({name:"All countries",code:"ALL"},{name:"Europe",code:"EUROPE"}),scope.shipping={availability:"ALL",base_cost:0,per_item_cost:0,zones:[]},scope.shipping=shippingRequest.data.data,scope.shipping.zones=scope.shipping.zones||[],scope.newRule={},scope.addRule=function(){scope.shipping[scope.newRule.name]=scope.newRule.value,scope.newRule={}},scope.removeRule=function(name){scope.shipping[name]=null},scope.ruleNameToDescription=function(name){return name.replace(/\_/gi," ").replace(/min/,"Minimum").replace(/max/,"Maximum")},scope.newZone={},scope.addZone=function(){scope.shipping.zones.push(scope.newZone),scope.newZone=null},scope.removeZone=function($index){scope.shipping.zones.splice($index,1)},scope.updateShipping=function(){$validation.hideErrors(),$marketcloud.shippings.update(scope.shipping.id,scope.shipping).then(function(response){notie.alert(1,"Shipping updated",2)}).catch(function(response){if(400===response.status){notie.alert(2,"The data you entered has some errors",1.5);var validation=response.data.errors[0],selector='[ng-model="shipping.'+validation.invalidPropertyName+'"]';0===angular.element(selector).length&&(selector='[validate-for="'+validation.invalidPropertyName+'"]'),$validation.showErrorMessage(validation,$models.Shipping.schema,selector)}else notie.alert(3,"An error has occurred.",2)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("ShippingsController",["$scope","$http","$location","Countries","shippings","$marketcloud","$utils",function(scope,http,location,countries,shippings,$marketcloud,$utils){scope.shippings=shippings.data.data,scope.countries=countries,scope.pagination=$utils.getPaginationFromHTTPResponse(shippings),scope.query={per_page:20},scope.availableRules=["max_value","min_value","max_weight","min_weight","max_height","min_height","max_depth","min_depth","max_width","min_width"],scope.getShippingRules=function(shipping){var o={};for(var k in shipping)scope.availableRules.indexOf(k)>-1&&(o[k]=angular.copy(shipping[k]));return console.log("Le shipping rules",o),o},scope.ruleNameToDescription=function(name){return name.replace(/\_/gi," ").replace(/min/,"Minimum").replace(/max/,"Maximum")},scope.loadData=function(){return""===scope.query.q&&delete scope.query.q,$marketcloud.shippings.list(scope.query).then(function(response){scope.shippings=response.data.data,scope.pagination=$utils.getPaginationFromHTTPResponse(response)}).error(function(response){notie.alert(3,"An error has occurred. Please try again",1.5)})},scope.loadPage=function(page_number){scope.query.page=Number(page_number),scope.loadData()},scope.deleteShipping=function(id){$marketcloud.shippings.delete(id).then(function(response){notie.alert(1,"Shipping method successfully deleted",1.5),scope.loadPage()}).catch(function(response){notie.alert(3,"An error has occurred",1.5)})},scope.clone=function(shippingRule){console.log("Cloning");var toSave=angular.copy(shippingRule);delete shippingRule.id,delete toSave._id,toSave.name+=" (Copy)",$marketcloud.shippings.save(toSave).then(function(response){scope.loadPage(),notie.alert(1,"Shipping rule successfully cloned",1.5)}).catch(function(response){notie.alert(3,"An error has occurred. Please try again.",1.5)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("CreateShippingController",["$scope","$http","$location","Countries","$marketcloud","$validation","$models",function(scope,http,location,countries,$marketcloud,$validation,$models){scope.availableRules=["max_value","min_value","max_weight","min_weight","max_height","min_height","max_depth","min_depth","max_width","min_width"],scope.getShippingRules=function(){var o={};for(var k in scope.shipping)scope.availableRules.indexOf(k)>-1&&(o[k]=angular.copy(scope.shipping[k]));return o},scope.howManyRules=function(o){var count=0;for(var k in scope.shipping)scope.availableRules.indexOf(k)>-1&&count++;return count},scope.countries=angular.copy(countries),scope.filterCountries=function(query){var data=scope.countries.filter(function(country){return country.name.indexOf(query)>-1}).sort(function(a,b){return a.name>b.name});return{data:data}},scope.countries.unshift({name:"All countries",code:"ALL"}),scope.shipping={name:"",base_cost:0,per_item_cost:0,zones:[]},scope.newRule={},scope.addRule=function(){scope.shipping[scope.newRule.name]=scope.newRule.value,scope.newRule={}},scope.removeRule=function(name){delete scope.shipping[name]},scope.ruleNameToDescription=function(name){return name.replace(/\_/gi," ").replace(/min/,"Minimum").replace(/max/,"Maximum")},scope.newZone={},scope.addZone=function(){scope.shipping.zones.push(scope.newZone),scope.newZone=null},scope.removeZone=function($index){scope.shipping.zones.splice($index,1)},scope.saveShipping=function(){$validation.hideErrors(),$marketcloud.shippings.save(scope.shipping).then(function(response){notie.alert(1,"Shipping saved.",1.5),location.path("/shippings")}).catch(function(response){if(400===response.status){notie.alert(2,"The data you entered has some errors",1.5);var validation=response.data.errors[0],selector='[ng-model="shipping.'+validation.invalidPropertyName+'"]';0===angular.element(selector).length&&(selector='[validate-for="'+validation.invalidPropertyName+'"]'),$validation.showErrorMessage(validation,$models.Shipping.schema,selector)}else notie.alert(3,"An error has occurred.",2)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("SidebarController",["$scope","$http","$routeParams","$location","$rootScope","$route",function($scope,$http,$params,$location,$root,$route){$scope.showingSubSidebar=!1,$scope.currentSidebarSection=null,$scope.currentSection=null,$scope.$on("$dashboardSectionChange",function($event,args){args.section&&($scope.currentSection=args.section.split(".")[0],$root.currentSection=args.section.split(".")[0],$root.currentSubsection=args.section.split(".")[1]||null,(args.section.indexOf("system")<0||args.section.indexOf("inventory")<0)&&$scope.hideSubSidebar())}),$scope.switchToApp=function(app_id){var url=(window.current_application.id,"/applications/"+app_id+"/dashboard#/");window.location.href=url},$scope.subEntriesGroupToShow=null,$scope.subSideBars={inventory:!1,system:!1},$scope.showSubEntries=function(id){$scope.subEntriesGroupToShow=id},$scope.subEntriesGroupShown={inventory:!1,system:!1},$scope.toggleSubEntries=function(group_id){$scope.currentSection=group_id,$scope.subEntriesGroupShown[group_id]=!$scope.subEntriesGroupShown[group_id]},$scope.showSubSidebar=function(id){$scope.showingSubSidebar=!0;var sidebars=["inventory","system","contents"];return!(sidebars.indexOf(id)<0)&&void($scope.currentSidebarSection=id)},$scope.hideSubSidebar=function(){$scope.showingSubSidebar=!1}}]),app.controller("NavbarController",["$scope","$http","$routeParams","$location",function($scope,$http,$params,$location){}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("CreateStaticContentController",["$scope","$http","$location","$marketcloud","$utils","$validation","$models",function(scope,http,location,$marketcloud,$utils,$validation,$models){scope.content={name:"",content:""},scope.computeSeoTags=function(){},scope.unsafeSlug=!1,scope.updateSlug=function(){scope.content.slug=$utils.getSlugFromString(scope.content.title)},scope.saveContent=function(){$validation.hideErrors(),$marketcloud.staticContents.save(scope.content).then(function(response){notie.alert(1,"Static content saved",2),location.path("/contents/static")}).catch(function(response){if(400===response.status){notie.alert(2,"The data you entered has some errors",1.5);var validation=response.data.errors[0],selector='[ng-model="content.'+validation.invalidPropertyName+'"]';0===angular.element(selector).length&&(selector='[validate-for="'+validation.invalidPropertyName+'"]'),$validation.showErrorMessage(validation,$models.StaticContent.schema,selector)}else notie.alert(3,"An error has occurred.",2)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("EditStaticContentController",["$scope","$http","content","$location","$marketcloud","moment","$utils","$validation","$models",function(scope,http,content,location,$marketcloud,$moment,$utils,$validation,$model){scope.content=content.data.data,scope.unsafeSlug=!1,scope.updateSlug=function(){scope.content.slug=$utils.getSlugFromString(scope.content.title)},scope.getImagesContainer=function(){return scope.content.author.images},scope.updateContent=function(){$marketcloud.staticContents.update(scope.content.id,scope.content).then(function(response){notie.alert(1,"Content updated with success",1.5)}).catch(function(response){if(400===response.status){notie.alert(2,"The data you entered has some errors",1.5);var validation=response.data.errors[0],selector='[ng-model="content.'+validation.invalidPropertyName+'"]';0===angular.element(selector).length&&(selector='[validate-for="'+validation.invalidPropertyName+'"]'),$validation.showErrorMessage(validation,$models.StaticContent.schema,selector)}else notie.alert(3,"An error has occurred.",2)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("EditTaxController",["$scope","$http","$marketcloud","$location","Countries","tax","TaxRates","$validation","$models",function(scope,http,$marketcloud,location,countries,tax,tax_rates,$validation,$models){scope.tax_rates=tax_rates,scope.countriesWithTaxRates=scope.tax_rates.map(function(r){return r.country}).filter(function(item,pos,self){return self.indexOf(item)==pos}),scope.countries=countries,scope.countries.unshift({name:"*"}),scope.states={},scope.tax=tax.data.data,scope.addRate=function(){scope.tax.rates.push({name:"",country:"",state:"",postcode:"",city:"",rate:0,priority:0})},scope.deleteRate=function(index){scope.tax.rates.splice(index,1)},scope.updateCity=function(rate){rate.postcode.indexOf("*")>-1&&(rate.city="*")},scope.updatePostcode=function(rate){"*"===rate.state&&(rate.postcode="*")},scope.updateStates=function(rate){return"*"===rate.country?(rate.state="*",void(rate.city="*")):void http({method:"GET",url:"/countries/"+rate.country.toLowerCase()}).then(function(response){scope.states[rate.country]=response.data,scope.states[rate.country].unshift({name:"*"})}).catch(function(error){var type=error.data.errors[0].type;scope.states[rate.country]=[{name:"*"}],"StatesListNotAvailable"!==type&&notie.alert(3,"An error has occurred. Please try again.",1.5)})},scope.saveTax=function(){$marketcloud.taxes.update(scope.tax.id,scope.tax).then(function(response){notie.alert(1,"Tax saved",1.5)}).catch(function(response){if(400===response.status){notie.alert(2,"The data you entered has some errors",1.5);var validation=response.data.errors[0],selector='[ng-model="tax.'+validation.invalidPropertyName+'"]';0===angular.element(selector).length&&(selector='[validate-for="'+validation.invalidPropertyName+'"]'),$validation.showErrorMessage(validation,$models.Tax.schema,selector)}else notie.alert(3,"An error has occurred.",2)})}}])},function(module,exports){"use strict";function csvToJson(csv){for(var lines=csv.split("\n"),result=[],headers=lines[0].split(","),i=1;i<lines.length;i++){for(var obj={},currentline=lines[i].split(","),j=0;j<headers.length;j++)obj[headers[j]]=currentline[j];result.push(obj)}return result}function validateTaxRates(rates){var testFunction=function(rate){return rate.country&&rate.state&&rate.postcode&&rate.city&&rate.rate&&rate.hasOwnProperty("priority")};return rates.every(testFunction)}function Rate(config){this.state="*",this.postcode="*",this.city="*",this.priority=0;for(var k in config)this[k]=config[k];this.rate&&(this.rate=Number(this.rate))}var app=angular.module("DataDashboard");app.directive("customOnChange",function(){return{restrict:"A",link:function(scope,element,attrs){var onChangeHandler=scope.$eval(attrs.customOnChange);element.bind("change",onChangeHandler)}}}),app.controller("CreateTaxController",["$scope","$http","$marketcloud","$location","Countries","TaxRates","$validation","$models",function(scope,http,$marketcloud,location,countries,tax_rates,$validation,$models){scope.countries=countries,scope.tax_rates=tax_rates,scope.countriesWithTaxRates=scope.tax_rates.map(function(r){return r.country}).filter(function(item,pos,self){return self.indexOf(item)==pos}),scope.countries.unshift({name:"*"}),scope.states={},scope.tax={rates:[]},scope.updateCity=function(rate){rate.postcode.indexOf("*")>-1&&(rate.city="*")},scope.updatePostcode=function(rate){"*"===rate.state&&(rate.postcode="*")},scope.importCSV=function(){$("#chooseFileButton").trigger("click")},scope.handleFileSelect=function(evt){var files=$("#chooseFileButton")[0].files,f=files[0],reader=new FileReader;reader.onload=(function(theFile){return function(e){var csv_file=e.target.result,new_rates=csvToJson(csv_file);return validateTaxRates(new_rates)===!1?void notie.alert(2,"The provided CSV file is not in a valid format",2):(new_rates=new_rates.map(function(rate){return new Rate(rate)}),scope.tax.rates=scope.tax.rates.concat(new_rates),void scope.$apply())}})(f),reader.readAsText(f)},scope.loadRatesFromCountry=function(country){var new_rates=scope.tax_rates.filter(function(rate){return rate.country===country}).map(function(rate){return rate.country=country,new Rate(rate)});scope.tax.rates=scope.tax.rates.concat(new_rates)},scope.updateStates=function(rate){return"*"===rate.country?(rate.state="*",void(rate.city="*")):void http({method:"GET",url:"/countries/"+rate.country.toLowerCase()}).then(function(response){scope.states[rate.country]=response.data,scope.states[rate.country].unshift({name:"*"})}).catch(function(error){var type=error.data.errors[0].type;scope.states[rate.country]="*","StatesListNotAvailable"!==type&&notie.alert(3,"An error has occurred. Please try again.",1.5)})},scope.addRate=function(){scope.tax.rates.push({name:"",country:"",state:"",postcode:"",city:"",rate:0,priority:0})},scope.deleteRate=function(index){scope.tax.rates.splice(index,1)},scope.saveTax=function(){$validation.hideErrors(),$marketcloud.taxes.save(scope.tax).then(function(response){notie.alert(1,"Tax saved",1.5),location.path("/system/taxes")}).catch(function(response){if(400===response.status){notie.alert(2,"The data you entered has some errors",1.5);var validation=response.data.errors[0],selector='[ng-model="tax.'+validation.invalidPropertyName+'"]';0===angular.element(selector).length&&(selector='[validate-for="'+validation.invalidPropertyName+'"]'),$validation.showErrorMessage(validation,$models.Tax.schema,selector)}else notie.alert(3,"An error has occurred.",2)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");JSON.flatten=function(data){function recurse(cur,prop){if(Object(cur)!==cur)result[prop]=cur;else if(Array.isArray(cur)){for(var i=0,l=cur.length;i<l;i++)recurse(cur[i],prop+"["+i+"]");0==l&&(result[prop]=[])}else{var isEmpty=!0;for(var p in cur)isEmpty=!1,recurse(cur[p],prop?prop+"."+p:p);isEmpty&&prop&&(result[prop]={})}}var result={};return recurse(data,""),result},app.controller("TranslationsController",["$scope","resource","resourceType",function(scope,resource,type){scope.resource=resource.data.data,scope.resource.hasOwnProperty("locales")?scope.availableLocales.forEach(function(locale){scope.resource.locales.hasOwnProperty(locale)||(scope.resource.locales[locale]={})}):(scope.resource.locales={},scope.availableLocales.forEach(function(locale){scope.resource.locales[locale]={}})),scope.type=type,scope.getTranslatableProperties=function(){return Object.keys(JSON.flatten(scope.resource)).filter(function(k){return k.indexOf("variant")===-1&&k.indexOf("locale")===-1})},scope.translatables=scope.getTranslatableProperties();scope.save=function(){}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("UsersController",["$scope","$marketcloud","users",function(scope,$marketcloud,resources){scope.users=resources.data.data,scope.pagination={currentPage:resources.data.page,numberOfPages:resources.data.pages,nextPage:resources.data._links.next||null,previousPage:resources.data._links.prev||null,count:resources.data.count},scope.query={per_page:20},scope.timestampToDate=function(t){var a=new Date(t),months=["January","February","March","April","May","June","July","August","September","October","November","December"],str=a.getDate()+" "+months[a.getMonth()]+" "+a.getFullYear();return str},scope.loadPage=function(p){return scope.query.page=Number(p),scope.loadData(scope.query)},scope.delete=function(user){$marketcloud.users.delete(user.id).then(function(response){notie.alert(1,"User deleted",1.5)}).catch(function(response){notie.alert(3,"An error has occurred. Please try again.",1.5)})},scope.loadData=function(query){query||(query=scope.query),$marketcloud.users.list(query).then(function(response){scope.users=response.data.data,scope.pagination={currentPage:response.data.page,numberOfPages:response.data.pages,nextPage:response.data._links.next||null,previousPage:response.data._links.prev||null,count:response.data.count}}).catch(function(response){notie.alert(3,"An error has occurred. Please try again.",1.5)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard"),NewUserController=function(scope,$marketcloud,http,location,Countries){scope.user={name:"",password:"",registered_with:"email",billing_address:{},shipping_address:{}},scope.countries=Countries,scope.customPropertiesData={},scope.copyShippingAddressToBillingAddress=function(){for(var k in scope.user.shipping_address)scope.user.billing_address[k]=scope.user.shipping_address[k]},scope.saveUser=function(){for(var k in scope.customPropertiesData)scope.user[k]=scope.customPropertiesData[k];console.log("Saving this",scope.user),$marketcloud.users.save(scope.user).then(function(response){notie.alert(1,"User saved",2),location.path("/users")}).catch(function(response){notie.alert(2,"An error has occurred. Please check the data you entered",2)})},http({method:"GET",url:"/applications/"+scope.application.id+"/roles"}).then(function(response){scope.roles=response.data.data}).catch(function(response){notie.alert(2,"An error has occurred while reloading roles.",1)}),scope.addCustomProperty=function(){scope.user.hasOwnProperty(scope.newAttributeName)?scope.userError="CUSTOM_PROPERTY_NAME_ALREADY_EXISTS":(scope.customPropertiesData[scope.newAttributeName]=scope.newAttributeValue,scope.newAttributeValue=null,scope.newAttributeName=null)},scope.deleteCustomProperty=function(property_name){delete scope.customPropertiesData[property_name]}};NewUserController.$inject=["$scope","$marketcloud","$http","$location","Countries"],app.controller("NewUserController",NewUserController)},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("UserController",["$scope","$http","$routeParams","user","$marketcloud","Countries","$utils",function(scope,http,params,user,$marketcloud,countries,$utils){scope.user=user.data.data,scope.carts=[],scope.addresses=[],scope.newAddress={email:scope.user.email||"",user_id:scope.user.id},scope.countries=countries,scope.update=function(){var payload=angular.copy(scope.user);for(var k in scope.customPropertiesData)payload[k]=scope.customPropertiesData[k];delete payload.id,delete payload.application_id,$marketcloud.users.update(scope.user.id,payload).then(function(response){notie.alert(1,"Update Succeded",2)}).catch(function(errpr){notie.alert(3,"An error has occurred, please try again",2)})},scope.toggleAddressVisibility=function(address){address.expanded=!address.expanded},scope.saveAddress=function(){$marketcloud.addresses.save(scope.newAddress).then(function(response){return notie.alert(1,"Address created",2),scope.newAddress={email:scope.user.email||"",user_id:scope.user.id},$("#addAddressModal").modal("hide"),$marketcloud.addresses.list({user_id:scope.user.id})}).then(function(response){scope.addresses=response.data.data}).catch(function(error){notie.alert(2,"An error has occurred, please check the data you entered",2)})};var coreProperties=Models.User.getPropertyNames();coreProperties.push("id","role","application_id","registered_with","created_at","updated_at","shipping_address","billing_address"),scope.customPropertiesData={};for(var k in scope.user)coreProperties.indexOf(k)<0&&(scope.customPropertiesData[k]=scope.user[k],delete scope.user[k]);$marketcloud.orders.list({"user.id":params.userId,per_page:10}).then(function(response){scope.orders=response.data.data}).catch(function(response){notie.alert(2,"An error has occurred. Please try again.",2)}),$marketcloud.carts.list({user_id:params.userId,per_page:10}).then(function(response){scope.carts=response.data.data}).catch(function(response){notie.alert(2,"An error has occurred. Please try again.",2)}),$marketcloud.addresses.list({user_id:params.userId,per_page:5}).then(function(response){scope.addresses=response.data.data.map(function(address,index){return 0===index?address.expanded=!0:address.expanded=!1,address})}).catch(function(response){notie.alert(2,"An error has occurred. Please try again.",2)})}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("EditVariableController",["$scope","$http","$location","$marketcloud","variable",function(scope,http,location,$marketcloud,variable){function isURL(s){return"string"==typeof s&&("function"==typeof s.indexOf&&0===s.indexOf("http://"))}scope.variable=variable.data.data,isURL(scope.variable.value)&&(scope.variable.type="URL"),scope.containerForNewMediaAttribute=[],scope.containersForExistingMediaAttributes={},scope.$watchCollection("containerForNewMediaAttribute",function(){scope.containerForNewMediaAttribute[scope.containerForNewMediaAttribute.length-1]&&(scope.variable.value=scope.containerForNewMediaAttribute[scope.containerForNewMediaAttribute.length-1])}),isURL(scope.variable.value)===!0&&(scope.containersForExistingMediaAttributes.value=[scope.variable.value],scope.$watchCollection("containersForExistingMediaAttributes.value",function(){null!==scope.variable.value&&scope.containersForExistingMediaAttributes.value&&(scope.variable.value=scope.containersForExistingMediaAttributes.value[scope.containersForExistingMediaAttributes.value.length-1])})),scope.availableTypes=[{type:"string",label:"String"},{type:"number",label:"Number"},{type:"URL",label:"Url / Media"},{type:"boolean",label:"True/False"}],scope.invalidPropertyName=null,scope.validationMessage=null,scope.validate=function(){},scope.update=function(){var payload=angular.copy(scope.variable);"URL"===payload.type&&(payload.type="string"),$marketcloud.variables.update(scope.variable.id,payload).then(function(response){notie.alert(1,"Variable successfully saved.",1.5)}).catch(function(error){notie.alert(3,"An error has occurred, please try again.",1.5)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("VariablesController",["$scope","$http","variables","$marketcloud",function(scope,http,resources,$marketcloud){scope.pagination={currentPage:resources.data.page,numberOfPages:resources.data.pages,nextPage:resources.data._links.next||null,previousPage:resources.data._links.prev||null,count:resources.data.count},scope.query={per_page:20},scope.variables=resources.data.data,scope.loadPage=function(p){return scope.loadData({page:p})},scope.loadData=function(query){query||(query=scope.query),$marketcloud.variables.list(query).then(function(response){scope.variables=response.data.data,scope.pagination={currentPage:response.data.page,numberOfPages:response.data.pages,nextPage:response.data._links.next||null,previousPage:response.data._links.prev||null,count:response.data.count}}).catch(function(response){notie.alert(3,"An error has occurred. Please try again.",1.5)})},scope.setPublishing=function(variable){$marketcloud.variables.update(variable.id,{published:variable.published}).then(function(response){notie.alert(1,"Updated!",1.5)}).catch(function(response){notie.alert(3,"An error has occurred, please try again.",1.5)})},scope.deleteVariable=function(variable_id,index){$marketcloud.variables.delete(variable_id).then(function(response){scope.loadData({page:1}),notie.alert(1,"Variable deleted",1.5)}).catch(function(response){notie.alert(3,"An error has occurred.Please try again.",1.5)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("CreateVariableController",["$scope","$http","$location","$marketcloud",function(scope,http,location,$marketcloud){scope.variable={type:"string",value:"",name:""},scope.containerForNewMediaAttribute=[],scope.containersForExistingMediaAttributes={},scope.$watchCollection("containerForNewMediaAttribute",function(){scope.variable.value=scope.containerForNewMediaAttribute[scope.containerForNewMediaAttribute.length-1]}),scope.availableTypes=[{type:"string",label:"String"},{type:"number",label:"Number"},{type:"URL",label:"Url / Media"},{type:"boolean",label:"True/False"}],scope.invalidPropertyName=null,scope.validationMessage=null,scope.validate=function(){},scope.save=function(){var payload=angular.copy(scope.variable);"URL"===payload.type&&(payload.type="string"),$marketcloud.variables.save(payload).then(function(response){notie.alert(1,"Variable successfully saved.",1.5),location.path("/variables")}).catch(function(error){notie.alert(3,"An error has occurred, please try again.",1.5)})}}])},function(module,exports){"use strict";angular.module("DataDashboard").controller("EditVariantController",["$scope","$marketcloud","$routeParams","$http","resolvedProduct",function(scope,$marketcloud,params,$http,resolvedProduct){scope.product=resolvedProduct.data.data;var originalVariantData=null;scope.variant=null,scope.product_merge_variant={},scope.customPropertiesData={},scope.variantDefiningProperties={},scope.currentVariantId=null,scope.filterVariantProps=function(o){var p={};for(var k in o)scope.product.variantsDefinition.hasOwnProperty(k)&&(p[k]=k+": "+String(o[k]));return p},scope.getImagesContainer=function(){return scope.product_merge_variant.images},scope.removeImage=function(i){scope.product_merge_variant.images.splice(i,1)},scope.getVariantStyle=function(i){var r=["label-info","label-danger","label-warning","label-success"];return r[i%r.length]},scope.getVariantStyle=function(i){var r=[{color:"#c0392b"},{color:"#27ae60"},{color:"#2c3e50"},{color:"#d35400"}];return r[i%r.length]},scope.getVariantClass=function(i){var classes=["label-empty-info","label-empty-success","label-empty-warning","label-empty-danger"];return"label solid "+classes[i%classes.length]},scope.updateVariant=function(){var variantProperties=["category_id","description","stock_type","stock_status","stock_level","sku","barcode","images","requires_shipping","width","depth","height","weight"],toSend=angular.copy(scope.variant);for(var k in scope.product_merge_variant)toSend[k]!==scope.product_merge_variant[k]&&variantProperties.indexOf(k)>-1&&(toSend[k]=scope.product_merge_variant[k]),"price_discount"===k&&scope.product_merge_variant[k]!==originalVariantData[k]&&(console.log(k+" dovrebbe passare da "+originalVariantData[k]+" a "+scope.product_merge_variant[k]),toSend.price_discount=scope.product_merge_variant[k]),"price"===k&&scope.product_merge_variant[k]!==originalVariantData[k]&&(toSend.price=scope.product_merge_variant[k]);console.log("product_merge_variant",angular.copy(scope.product_merge_variant)),console.log("toSend",angular.copy(toSend)),$http({method:"PUT",url:API_BASE_URL+"/products/"+params.productId+"/variants/"+scope.variant.id,headers:{Authorization:window.public_key+":"+window.token},data:toSend}).then(function(response){notie.alert(1,"Variant successfully updated",1.5)}).catch(function(response){notie.alert(3,"An error has occurred. Please try again.",1.5)})},scope.setCurrentVariant=function(variant_id){scope.currentVariantId=variant_id,scope.product.variants.forEach(function(v){Number(v.id)===Number(variant_id)&&(scope.variant=v,originalVariantData=angular.copy(v))});for(var k in scope.product)scope.product_merge_variant[k]=scope.product[k];for(var j in scope.variant)scope.product_merge_variant[j]=scope.variant[j]},scope.setCurrentVariant(Number(params.variantId)),scope.product=resolvedProduct.data.data}])},function(module,exports){"use strict";angular.module("DataDashboard").controller("ListVariantsController",["$scope","$marketcloud","$routeParams","$http","resolvedProduct",function(scope,$marketcloud,params,$http,resolvedProduct){scope.product=resolvedProduct.data.data,scope.variantDefiningProperties={},scope.deleteVariant=function(variant){return $http({method:"DELETE",url:API_BASE_URL+"/products/"+scope.product.id+"/variants/"+variant.id,headers:{Authorization:window.public_key+":"+window.token}}).then(function(response){notie.alert(1,"Variant deleted",1.5),scope.product=response.data.data}).catch(function(response){notie.alert(3,"An error has occurred, please try again.",1.5)})},scope.clone=function(variant){var variantToSave=angular.copy(variant);return delete variantToSave.id,$http({method:"POST",url:API_BASE_URL+"/products/"+scope.product.id+"/variants",data:variantToSave,headers:{Authorization:window.public_key+":"+window.token}}).then(function(response){notie.alert(1,"Variant successfully cloned",2)}).catch(function(response){notie.alert(2,"An error has occurred, please try again",2)})},scope.filterVariantProps=function(o){var p={};for(var k in o)scope.product.variantsDefinition.hasOwnProperty(k)&&(p[k]=k+": "+String(o[k]));return p},scope.getVariantStyle=function(i){var r=[{color:"#c0392b"},{color:"#27ae60"},{color:"#2c3e50"},{color:"#d35400"}];return r[i%r.length]}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.controller("WebhooksController",["$scope","$http","$location","webhooks",function(scope,http,location,webhooks){scope.mode=null,scope.webhooks=[{event:"products.create",method:"POST",url:"mybackend.herokuapp.com/newproduct",headers:{}}],scope.webhooks=webhooks.data.data,scope.events=["products.create","products.delete","products.update","brands.create","brands.delete","brands.update","categories.create","categories.delete","categories.update","orders.create","orders.delete","orders.update","carts.create","carts.delete","carts.update","payments.create","payments.delete","payments.update","shippings.create","shippings.delete","shippings.update"],
scope.load=function(){http({method:"GET",url:"/applications/"+window.current_application.id+"/webhooks"}).then(function(response){scope.webhooks=response.data.data}).catch(function(response){notie.alert(2,"An error has occurred while reloading webhooks.",1)})},scope.edit=function(hook){scope.newWebhook=hook,scope.showUpdateModal()},scope.showUpdateModal=function(){scope.mode="update",$("#newWebhookModal").modal("show")},scope.showCreateModal=function(){scope.mode="create",$("#newWebhookModal").modal("show")},scope.saveWebhook=function(){http({method:"POST",url:"/applications/"+window.current_application.id+"/webhooks",data:scope.newWebhook}).then(function(response){notie.alert(1,"Webhook correctly created",1),scope.newWebhook={},$("#newWebhookModal").modal("hide"),scope.load()}).catch(function(response){notie.alert(3,"An error has occurred, webhook not created",1),scope.newWebhook={}})},scope.updateWebhook=function(){http({method:"PUT",url:"/applications/"+window.current_application.id+"/webhooks/"+scope.newWebhook.id,data:scope.newWebhook}).then(function(response){notie.alert(1,"Webhook correctly updated",1),scope.newWebhook={}}).catch(function(response){notie.alert(3,"An error has occurred, webhook not updated",1),scope.newWebhook={}})},scope.delete=function(hook){http({method:"DELETE",url:"/applications/"+window.current_application.id+"/webhooks/"+hook.id}).then(function(response){notie.alert(1,"Webhook correctly deleted",1),scope.load()}).catch(function(response){notie.alert(3,"An error has occurred, webhook not deleted",1)})}}])},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.directive("avatar",[function(){return{restrict:"AE",replace:!0,transclude:!0,scope:{initials:"@initials",width:"@width",bgcolor:"@bgColor",textColor:"@textColor",wrapper:"=wrapper",pictureResolution:"@pictureResolution",pixelated:"=pixelated",roundShape:"=roundShape",class:"@class",imgClass:"@imgClass",style:"@style",string:"@string",cornerRadius:"@cornerRadius",pictureFormat:"@pictureFormat",colorsPalette:"=colorsPalette",autoColor:"=autoColor",fontWeight:"@fontWeight",fontScale:"@fontScale",textShadow:"=textShadow",bind:"=bind",maxLength:"@maxLength",upperCase:"=upperCase"},link:function(scope,element,attrs){function checkValues(){if(void 0!=scope.bind&&(_bind=scope.bind),void 0!=scope.textColor&&(_textcolor=scope.textColor),void 0!=scope.pictureResolution&&(_picture_resolution=scope.pictureResolution),void 0!=scope.width&&(_long=scope.width),void 0!=scope.wrapper&&(_wrapper=scope.wrapper,_wrapper===!1&&(_img_width=_long)),void 0!=scope.pixelated&&(_pixelated=scope.pixelated,_pixelated===!0&&(_img_styling+="image-rendering:pixelated; image-rendering:-moz-crisp-edges;")),void 0!=scope.roundShape?(_roundShape=scope.roundShape,_roundShape&&(_wrapper_styling+="border-radius: "+_long+"px;")):void 0!=scope.cornerRadius&&(_corner_radius=scope.cornerRadius,_wrapper_styling+="border-radius: "+_corner_radius+"px;"),void 0!=scope.class&&(_extra_classes=scope.class),void 0!=scope.imgClass&&(_extra_img_classes=scope.imgClass),void 0!=scope.style&&(_extra_styles=scope.style),void 0!=scope.initials&&(_str=scope.initials),void 0!=scope.string&&(_str=getInitialsFromString(scope.string)),void 0!=scope.maxLength&&(_str=_str.substr(0,scope.maxLength)),"jpeg"===scope.pictureFormat&&(_picture_format="jpeg"),void 0!=scope.colorsPalette&&(_colors_palette=scope.colorsPalette),void 0!=scope.bgcolor)_bgcolor=scope.bgcolor;else if(void 0!=scope.autoColor&&(_autoColor=scope.autoColor,_autoColor===!0)){var i,colorIndex,lon=_str.length,charIndex=0;for(i=0;i<lon;i++)charIndex=_str.charCodeAt(i);colorIndex=charIndex%_colors_palette.length,_bgcolor=_colors_palette[colorIndex]}void 0!=scope.fontWeight&&(_font_weight=scope.fontWeight),void 0!=scope.fontScale&&(_font_scale=scope.fontScale),void 0!=scope.textShadow&&(_text_shadow=scope.textShadow),scope.upperCase===!0&&(_str=_str.toUpperCase())}function generateAvatar(name,w,h,bgcolor,textcolor,bgImage){var canvas,ctx,_font_size,WIDTH=256,HEIGHT=256;return void 0!=w&&w>0&&void 0!=h&&h>0&&(WIDTH=w,HEIGHT=h),canvas=document.createElement("canvas"),canvas.id="ngAvatar-"+Date.now(),canvas.width=WIDTH,canvas.height=HEIGHT,ctx=canvas.getContext("2d"),ctx.fillStyle=bgcolor,ctx.fillRect(0,0,WIDTH,HEIGHT),_font_size=WIDTH/(2/(_font_scale/100)),ctx.font=_font_weight+" "+_font_size+"px sans-serif",_text_shadow===!0&&(ctx.shadowColor="black",ctx.shadowOffsetX=0,ctx.shadowOffsetY=0,ctx.shadowBlur=5),ctx.textAlign="center",ctx.fillStyle=textcolor,ctx.fillText(_str,WIDTH/2,HEIGHT-HEIGHT/2+_font_size/3),canvas.toDataURL("image/"+_picture_format)}function getInitialsFromString(str){var output="",i=0,str=str.split(" "),len=str.length;for(i;i<len;i++)""!=str[i]&&(output+=str[i][0]);return output}function render(){var imgData=generateAvatar(_str,_picture_resolution,_picture_resolution,_bgcolor,_textcolor,null),html="";_wrapper&&(html+='<div class="avatar-wrapper '+_extra_classes+'" style="'+_wrapper_styling+" width:"+_long+"px; height:"+_long+"px; "+_extra_styles+'">'),html+='<img src="'+imgData+'" class="avatar-picture '+_extra_img_classes+'" style="'+_img_styling+'" width="'+_img_width+'" height="" />',_wrapper&&(html+="</div>");var replacementElement=angular.element(html);currentElement.replaceWith(replacementElement),currentElement=replacementElement}var _long=45,_picture_resolution=256,_wrapper=!0,_str="",_bgcolor="#000",_textcolor="#fff",_pixelated=!1,_img_styling="vertical-align:top;",_roundShape=!1,_wrapper_styling="border-radius:0; display:block; overflow:hidden;",_extra_classes="",_extra_img_classes="",_extra_styles="",_corner_radius="0",_picture_format="png",_colors_palette=["#bdc3c7","#6f7b87","#2c3e50","#2f3193","#662d91","#922790","#ec2176","#ed1c24","#f36622","#f8941e","#fab70f","#fdde00","#d1d219","#8ec73f","#00a650","#00aa9c","#00adef","#0081cd","#005bab"],_autoColor=!1,_font_weight=100,_font_scale=100,_text_shadow=!1,_bind=!1,_img_width="100%",mc_palette=["#1abc9c","#16a085","#f1c40f","#f39c12","#2ecc71","#27ae60","#27ae60","#e67e22","#d35400","#3498db","#2980b9","#c0392b","#e74c3c","#9b59b6","#8e44ad"];0===scope.initials.length&&(scope.initials="??");var dict=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y"],position=dict.indexOf(scope.initials.substr(0,1).toLowerCase()),chosenColorPosition=position%mc_palette.length;chosenColorPosition===-1&&(chosenColorPosition=0);var chosenColor=mc_palette[chosenColorPosition];_bgcolor=chosenColor;var currentElement=element;checkValues(),_bind===!0?(scope.$watch("string",function(value){checkValues(),render()}),scope.$watch("initials",function(value){checkValues(),render()})):render()}}}])},function(module,exports){"use strict";!(function(app){app.directive("contenteditable",function(){return{restrict:"A",require:"?ngModel",link:function(scope,element,attrs,ngModel){function read(){var html=element.html();attrs.stripBr&&"<br>"==html&&(html=""),ngModel.$setViewValue(html)}ngModel&&(ngModel.$render=function(){element.html(ngModel.$viewValue||"")},element.on("blur keyup change",function(){scope.$apply(read)}),read())}}})})(angular.module("DataDashboard"))},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.directive("dropdown",function($document){return{restrict:"C",link:function(scope,elem,attr){angular.element(".dropdown-submenu > a.dropdown-submenu-toggle").on("click",function(e){var submenu=angular.element(this).next("ul");angular.element(submenu).toggle(),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()})}}})},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.directive("fallbackSrc",function(){return{link:function(scope,element,attrs){element.bind("error",function(){attrs.src!==attrs.fallbackSrc&&attrs.$set("src",attrs.fallbackSrc)})}}})},function(module,exports){"use strict";!(function(app){app.directive("fileModel",["$parse",function($parse){return{restrict:"A",link:function(scope,element,attrs){var model=$parse(attrs.fileModel),modelSetter=model.assign;element.bind("change",function(){scope.$apply(function(){attrs.multiple?modelSetter(scope,element[0].files):modelSetter(scope,element[0].files[0])})})}}}])})(angular.module("DataDashboard"))},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.directive("focusOnShow",function($timeout){return{restrict:"A",link:function($scope,$element,$attr){$attr.ngShow&&$scope.$watch($attr.ngShow,function(newValue){newValue&&$timeout(function(){$element[0].focus()},0)}),$attr.ngHide&&$scope.$watch($attr.ngHide,function(newValue){newValue||$timeout(function(){$element[0].focus()},0)})}}})},function(module,exports){"use strict";!(function(){var NUMBER_REGEXP=/^\s*(\-|\+)?(\d+|(\d*(\.\d*)))\s*$/,DEFAULT_PRECISION=2;angular.module("DataDashboard").directive("money",["$parse",function($parse){function link(scope,el,attrs,ngModelCtrl){function round(num){var d=Math.pow(10,precision);return Math.round(num*d)/d}function formatPrecision(value){return parseFloat(value).toFixed(precision)}function isPrecisionValid(){return!isNaN(precision)&&precision>-1}function isValueValid(value){return angular.isNumber(value)&&!isNaN(value)}function updateValuePrecision(){var modelValue=ngModelCtrl.$modelValue;isValueValid(modelValue)&&isPrecisionValid()&&(ngModelCtrl.$modelValue=round(modelValue),$parse(attrs.ngModel).assign(scope,ngModelCtrl.$modelValue),changeViewValue(formatPrecision(modelValue)),lastValidViewValue=ngModelCtrl.$viewValue)}function changeViewValue(value){ngModelCtrl.$viewValue=value,ngModelCtrl.$commitViewValue(),ngModelCtrl.$render()}var minVal,maxVal,precision,lastValidViewValue,isDefined=angular.isDefined,isUndefined=angular.isUndefined,isNumber=angular.isNumber;ngModelCtrl.$parsers.push(function(value){if(ngModelCtrl.$isEmpty(value))return lastValidViewValue=value,null;if(0===value.indexOf(".")&&(value="0"+value),0===value.indexOf("-")){if(minVal>=0)return changeViewValue(""),null;if("-"===value||"-."===value)return null}return NUMBER_REGEXP.test(value)?(lastValidViewValue=value,parseFloat(value)):(changeViewValue(lastValidViewValue),lastValidViewValue)}),ngModelCtrl.$validators.min=function(value){return ngModelCtrl.$isEmpty(value)||isUndefined(minVal)||value>=minVal},isDefined(attrs.min)||attrs.ngMin?attrs.$observe("min",function(val){isDefined(val)&&!isNumber(val)&&(val=parseFloat(val,10)),minVal=isNumber(val)&&!isNaN(val)?val:void 0,ngModelCtrl.$validate()}):minVal=0,(isDefined(attrs.max)||attrs.ngMax)&&(ngModelCtrl.$validators.max=function(value){return ngModelCtrl.$isEmpty(value)||isUndefined(maxVal)||value<=maxVal},attrs.$observe("max",function(val){isDefined(val)&&!isNumber(val)&&(val=parseFloat(val,10)),maxVal=isNumber(val)&&!isNaN(val)?val:void 0,ngModelCtrl.$validate()})),isDefined(attrs.precision)?attrs.$observe("precision",function(value){precision=parseInt(value,10),updateValuePrecision()}):precision=DEFAULT_PRECISION,ngModelCtrl.$parsers.push(function(value){return value&&(value=isPrecisionValid()?round(value):value),value}),ngModelCtrl.$formatters.push(function(value){return isDefined(value)?isPrecisionValid()&&isValueValid(value)?formatPrecision(value):value:""}),el.bind("blur",function(){ngModelCtrl.$commitViewValue(),updateValuePrecision()})}return{restrict:"A",require:"ngModel",link:link}}])})()},function(module,exports){"use strict";angular.module("Marketcloud.Shared").directive("ngThumb",["$window",function($window){var helper={support:!(!$window.FileReader||!$window.CanvasRenderingContext2D),isFile:function(item){return angular.isObject(item)&&item instanceof $window.File},isImage:function(file){var type="|"+file.type.slice(file.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(type)!==-1}};return{restrict:"A",template:"<canvas/>",link:function(scope,element,attributes){function onLoadFile(event){var img=new Image;img.onload=onLoadImage,img.src=event.target.result}function onLoadImage(){var width=params.width||this.width/this.height*params.height,height=params.height||this.height/this.width*params.width;canvas.attr({width:width,height:height}),canvas[0].getContext("2d").drawImage(this,0,0,width,height)}if(helper.support){var params=scope.$eval(attributes.ngThumb);if(helper.isFile(params.file)&&helper.isImage(params.file)){var canvas=element.find("canvas"),reader=new FileReader;reader.onload=onLoadFile,reader.readAsDataURL(params.file)}}}}}])},function(module,exports){"use strict";!(function(app){app.directive("ngEnter",function(){return function(scope,element,attrs){element.bind("keydown keypress",function(event){13===event.which&&(scope.$apply(function(){scope.$eval(attrs.ngEnter)}),event.preventDefault())})}})})(angular.module("DataDashboard"))},function(module,exports){"use strict";angular.module("DataDashboard").directive("onChangeAsync",function($timeout){return{restrict:"A",require:"ngModel",link:function(scope,element,attr,ctrl){ctrl.$viewChangeListeners.push(function(){$timeout(function(){scope.$eval(attr.onChangeAsync)})})}}})},function(module,exports){"use strict";!(function(app){app.directive("onFileChange",function(){return{restrict:"A",link:function(scope,element,attrs){var onChangeHandler=scope.$eval(attrs.onFileChange);element.bind("change",onChangeHandler)}}})})(angular.module("DataDashboard"))},function(module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!(function(){function AccountFactory($http,$q){var Factory={};return Factory.data={},Factory.get=function(key){return key?Factory.data[key]:Factory.data},Factory.set=function(key,value){"string"==typeof key&&value&&(Factory.data[key]=value),"object"!==("undefined"==typeof key?"undefined":_typeof(key))||value||(Factory.data=key)},Factory}angular.module("DataDashboard").factory("$account",["$http","$q",AccountFactory])})()},function(module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!(function(){function ApplicationFactory(){var Factory={data:{}};return Factory.get=function(key){return key?Factory.data[key]:Factory.data},Factory.set=function(key,value){"string"==typeof key&&value&&(Factory.data[key]=value),"object"!==("undefined"==typeof key?"undefined":_typeof(key))||value||(Factory.data=key)},Factory.getAvailableLocaleCodes=function(){return Factory.data.locales?Factory.data.locales.split(",").filter(function(localeCode){return""!==localeCode}):[]},Factory}angular.module("DataDashboard").factory("$application",ApplicationFactory)})()},function(module,exports){"use strict";!(function(){function CacheFactory(){var Factory={};return Factory.data={},Factory.set=function(key,value){this.data[key]=value},Factory.get=function(key){return this.data[key]},Factory.del=function(key){delete this.data[key]},Factory.delByPattern=function(pattern){for(var k in this.data)k.indexOf(pattern)>-1&&(console.info("Deleting cache for "+k),delete this.data[k])},Factory.has=function(key){return this.data.hasOwnProperty(key)},Factory}angular.module("DataDashboard").factory("$cache",[CacheFactory])})()},function(module,exports){"use strict";!(function(){function LocalesFactory($http){return{"af-ZA":{code:"af-ZA",original:"Afrikaans",name:"Afrikaans"},ar:{code:"ar",original:"Ø§ÙØ¹Ø±Ø¨ÙØ©",name:"Arabic"},"bg-BG":{code:"bg-BG",original:"ÐÑÐ»Ð³Ð°ÑÑÐºÐ¸",name:"Bulgarian"},"ca-AD":{code:"ca-AD",original:"CatalÃ ",name:"Catalan"},"cs-CZ":{code:"cs-CZ",original:"ÄeÅ¡tina",name:"Czech"},"cy-GB":{code:"cy-GB",original:"Cymraeg",name:"Welsh"},"da-DK":{code:"da-DK",original:"Dansk",name:"Danish"},"de-AT":{code:"de-AT",original:"Deutsch (Ãsterreich)",name:"German (Austria)"},"de-CH":{code:"de-CH",original:"Deutsch (Schweiz)",name:"German (Switzerland)"},"de-DE":{code:"de-DE",original:"Deutsch (Deutschland)",name:"German (Germany)"},"el-GR":{code:"el-GR",original:"ÎÎ»Î»Î·Î½Î¹ÎºÎ¬",name:"Greek"},"en-GB":{code:"en-GB",original:"English (UK)",name:"English (UK)",alpha2:"GB"},"en-US":{code:"en-US",original:"English (US)",name:"English (US)"},"es-CL":{code:"es-CL",original:"EspaÃ±ol (Chile)",name:"Spanish (Chile)"},"es-ES":{code:"es-ES",original:"EspaÃ±ol (EspaÃ±a)",name:"Spanish (Spain)"},"es-MX":{code:"es-MX",original:"EspaÃ±ol (MÃ©xico)",name:"Spanish (Mexico)"},"et-EE":{code:"et-EE",original:"Eesti",name:"Estonian"},eu:{code:"eu",original:"Euskara",name:"Basque"},"fa-IR":{code:"fa-IR",original:"ÙØ§Ø±Ø³Û",name:"Persian"},"fi-FI":{code:"fi-FI",original:"Suomi",name:"Finnish"},"fr-CA":{code:"fr-CA",original:"FranÃ§ais (Canada)",name:"French (Canada)"},"fr-FR":{code:"fr-FR",original:"FranÃ§ais (France)",name:"French (France)"},"he-IL":{code:"he-IL",original:"×¢××¨××ª",name:"Hebrew"},"hr-HR":{code:"hr-HR",original:"Hrvatski",name:"Croatian"},"hu-HU":{code:"hu-HU",original:"Magyar",name:"Hungarian"},"id-ID":{code:"id-ID",original:"Bahasa Indonesia",name:"Indonesian"},"is-IS":{code:"is-IS",original:"Ãslenska",name:"Icelandic"},"it-IT":{code:"it-IT",original:"Italiano",name:"Italian"},"ja-JP":{code:"ja-JP",original:"æ¥æ¬èª",name:"Japanese"},"km-KH":{code:"km-KH",original:"áá¶áá¶ááááá",name:"Khmer"},"ko-KR":{code:"ko-KR",original:"íêµ­ì´",name:"Korean"},"lt-LT":{code:"lt-LT",original:"LietuviÅ³",name:"Lithuanian"},"lv-LV":{code:"lv-LV",original:"LatvieÅ¡u",name:"Latvian"},"mn-MN":{code:"mn-MN",original:"ÐÐ¾Ð½Ð³Ð¾Ð»",name:"Mongolian"},"nb-NO":{code:"nb-NO",original:"Norsk bokmÃ¥l",name:"Norwegian (BokmÃ¥l)"},"nl-NL":{code:"nl-NL",original:"Nederlands",name:"Dutch"},"nn-NO":{code:"nn-NO",original:"Norsk nynorsk",name:"Norwegian (Nynorsk)"},"pl-PL":{code:"pl-PL",original:"Polski",name:"Polish"},"pt-BR":{code:"pt-BR",original:"PortuguÃªs (Brasil)",name:"Portuguese (Brazil)"},"pt-PT":{code:"pt-PT",original:"PortuguÃªs (Portugal)",name:"Portuguese (Portugal)"},"ro-RO":{code:"ro-RO",original:"RomÃ¢nÄ",name:"Romanian"},"ru-RU":{code:"ru-RU",original:"Ð ÑÑÑÐºÐ¸Ð¹",name:"Russian"},"sk-SK":{code:"sk-SK",original:"SlovenÄina",name:"Slovak"},"sl-SI":{code:"sl-SI",original:"SlovenÅ¡Äina",name:"Slovenian"},"sr-RS":{code:"sr-RS",original:"Ð¡ÑÐ¿ÑÐºÐ¸ / Srpski",name:"Serbian"},"sv-SE":{code:"sv-SE",original:"Svenska",name:"Swedish"},"th-TH":{code:"th-TH",original:"à¹à¸à¸¢",name:"Thai"},"tr-TR":{code:"tr-TR",original:"TÃ¼rkÃ§e",name:"Turkish"},"uk-UA":{code:"uk-UA",original:"Ð£ÐºÑÐ°ÑÐ½ÑÑÐºÐ°",name:"Ukrainian"},"vi-VN":{code:"vi-VN",original:"Tiáº¿ng Viá»t",name:"Vietnamese"},"zh-CN":{code:"zh-CN",original:"ä¸­æ (ä¸­å½å¤§é)",name:"Chinese (PRC)"},"zh-TW":{code:"zh-TW",original:"ä¸­æ (å°ç£)",name:"Chinese (Taiwan)"}}}angular.module("DataDashboard").factory("LocalesFactory",LocalesFactory)})()},function(module,exports){"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!(function(){function jsonToQueryString(json){return"?"+Object.keys(json).map(function(key){return encodeURIComponent(key)+"="+encodeURIComponent(json[key])}).join("&")}function MarketcloudFactory($http,$q,$cache,$account,$application){var request=function(method,endpoint,data,options){var role=$application.get("role");if("guest"===role&&"GET"!==method)return void notie.alert(2,"Action not allowed since your role is 'guest'.",2);var url=window.API_BASE_URL+"/"+endpoint;if("GET"===method){var cacheKey=endpoint+jsonToQueryString(data||{});if($cache.has(cacheKey))return $q.when($cache.get(cacheKey))}var config={method:method,url:url,headers:{"Content-Type":"application/json",Authorization:window.public_key+":"+window.token}};return options=options||{},"GET"===method?config.params=data||{}:config.data=data||{},$http(config).then(function(response){if("GET"===method&&$cache.set(endpoint,response),"PUT"===method||"PATCH"===method){var deletionPattern=endpoint.split("/");deletionPattern=deletionPattern[0],$cache.delByPattern(deletionPattern)}if("POST"===method&&$cache.delByPattern(endpoint),"DELETE"===method){var deletionPattern=endpoint.split("/");deletionPattern=deletionPattern[0],$cache.delByPattern(deletionPattern)}return $q.when(response)}).catch(function(error){return $q.reject(error)})},resourceFactory=function(resource_name){return{list:function(query,options){if(query=query||{},"object"!==("undefined"==typeof query?"undefined":_typeof(query)))throw new Error("$marketcloud."+resource_name+".list(query) query must be object");return request("GET",resource_name,query,options)},getById:function(id,options){if(isNaN(id))throw new Error("$marketcloud."+resource_name+".getById(id) id must be an integer number");return request("GET",resource_name+"/"+id,options)},save:function(data,options){if("object"!==("undefined"==typeof data?"undefined":_typeof(data)))throw new Error("$marketcloud."+resource_name+".save(data) data must be object");return request("POST",resource_name,data,options)},update:function(id,data,options){if(isNaN(id))throw new Error("$marketcloud."+resource_name+".update(id,data) id must be an integer number");return request("PUT",resource_name+"/"+id,data,options)},delete:function(id,options){if(isNaN(id))throw new Error("$marketcloud."+resource_name+".delete(id) id must be an integer number");return request("DELETE",resource_name+"/"+id,options)}}},subResourceFactory=function(resource_name,sub_resource_name){return{list:function(parent_id,query,options){if(query=query||{},"object"!==("undefined"==typeof query?"undefined":_typeof(query)))throw new Error("$marketcloud."+resource_name+"."+sub_resource_name+".list(query) query must be object");return request("GET",resource_name+"/"+parent_id+"/"+sub_resource_name,query,options)},getById:function(parent_id,id,options){if(isNaN(id))throw new Error("$marketcloud."+resource_name+"."+sub_resource_name+".getById(id) id must be an integer number");return request("GET",resource_name+"/"+parent_id+"/"+sub_resource_name+"/"+id,options)},save:function(parent_id,data,options){if("object"!==("undefined"==typeof data?"undefined":_typeof(data)))throw new Error("$marketcloud."+resource_name+"."+sub_resource_name+".save(data) data must be object, got "+("undefined"==typeof data?"undefined":_typeof(data)));return request("POST",resource_name+"/"+parent_id+"/"+sub_resource_name,data,options)},update:function(parent_id,id,data,options){if(isNaN(id))throw new Error("$marketcloud."+resource_name+"."+sub_resource_name+".update(id,data) id must be an integer number");return request("PUT",resource_name+"/"+parent_id+"/"+sub_resource_name+"/"+id,data,options)},delete:function(parent_id,id,options){if(isNaN(id))throw new Error("$marketcloud."+resource_name+"."+sub_resource_name+".delete(id) id must be an integer number");return request("DELETE",resource_name+"/"+parent_id+"/"+sub_resource_name+"/"+id,options)}}},resources=["addresses","brands","categories","collections","events","coupons","carts","products","orders","invoices","users","contents","staticContents","media","notifications","promotions","shippings","payments","taxes","paymentMethods","variables"],factory={};return resources.forEach(function(resource_name){factory[resource_name]=resourceFactory(resource_name)}),factory.variants=subResourceFactory("products","variants"),factory.refunds=subResourceFactory("orders","refunds"),factory.payments=subResourceFactory("orders","payments"),factory.shipments=subResourceFactory("orders","shipments"),factory}angular.module("DataDashboard").factory("$marketcloud",MarketcloudFactory),MarketcloudFactory.$inject=["$http","$q","$cache","$account","$application"]})()},function(module,exports){"use strict";!(function(){function ModelsFactory($http,$q){if(!Schematic)throw new Error("Models factory requires Schematic library");var Types={};return Types.Notifications={},Types.Notifications["orders.create"]=new Schematic.Schema("orders.create",{type:{required:!0,type:"string"},application:{required:!0,type:"object"},order:{required:!0,type:"object"}}),Types.Notifications["orders.update.processing"]=new Schematic.Schema("orders.update.processing",{type:{required:!0,type:"string"},application:{required:!0,type:"object"},order_id:{required:!0,type:"number"}}),Types.Notifications["orders.update.completed"]=new Schematic.Schema("orders.update.completed",{type:{required:!0,type:"string"},application:{required:!0,type:"object"},order_id:{required:!0,type:"number"}}),Types.Notifications["users.create"]=new Schematic.Schema("users.create",{type:{required:!0,type:"string"},application:{required:!0,type:"object"},user:{required:!0,type:"object"}}),Types.Bundle=new Schematic.Schema("Bundle",{name:{type:"string",min:2,max:30,required:!0},description:{type:"string"},slug:{type:"string"},items:{type:"array",elements:{type:"number"},required:!0},price:{type:"number",required:!0},price_discount:{type:"number"}}),Types.Payment=new Schematic.Schema("Payment",{payment_method_id:{required:!1,type:"number"},method:{required:!0,type:"string"},order_id:{type:"number",required:!0},amount:{type:"number",required:!0},data:{type:"object"}}),Types.PaymentMethod=new Schematic.Schema("PaymentMethod",{name:{type:"string",required:!0,min:1,max:100},description:{type:"string",min:0,max:500},cost_type:{type:"string",required:!0,whitelist:["no_cost","fixed_fee","percentage_fee","fixed_plus_percentage"]},fixed_fee:{type:"number",min:0},percentage_fee:{type:"number",min:0}}),Types.PromotionCondition=new Schematic.Schema("PromotionCondition",{type:{type:"string",whitelist:["MIN_NUMBER_OF_PRODUCTS","MIN_CART_VALUE","CART_HAS_ITEM"],required:!0},value:{type:"number",required:!0}}),Types.PromotionEffect=new Schematic.Schema("PromotionEffect",{type:{type:"string",whitelist:["CART_VALUE_PERCENTAGE_REDUCTION","CART_VALUE_NET_REDUCTION","CART_ITEMS_NET_REDUCTION","CART_ITEMS_PERCENTAGE_REDUCTION","FREE_SHIPPING"],required:!0},value:{required:!0}}),Types.Promotion=new Schematic.Schema("Promotion",{name:{type:"string",min:2,max:130,required:!0},active:{type:"boolean",required:!0},conditions:{type:"array",elements:{type:Types.PromotionCondition}},effects:{type:"array",required:!0,elements:{type:Types.PromotionEffect}}}),Types.BundleEntry=new Schematic.Schema("BundleEntry",{product_id:{type:"number",required:!0},bundle_price:{},variant_id:{type:"number"}}),Types.Bundle=new Schematic.Schema("Bundle",{name:{type:"string",min:1,max:140,required:!0},slug:{type:"string",max:500},description:{type:"string"},items:{type:"array",required:!0,elements:{type:Types.BundleEntry}},pricing_rule:{type:"string",whitelist:["fixed","inherit"]}}),Types.Category=new Schematic.Schema("Category",{name:{type:"string",min:2,max:30,required:!0},description:{type:"string",max:1400},url:{type:"string"},image_url:{type:"string"},parent_id:{type:"number",required:!1}}),Types.CategoryNew=new Schematic.Schema("Category",{name:{type:"string",min:2,max:30,required:!0},description:{type:"string",max:1400},url:{type:"string"},image_url:{type:"string"},path:{type:"string",required:!0},parent:{type:"string",required:!0}}),Types.CollectionEntry=new Schematic.Schema("CollectionEntry",{product_id:{type:"number",required:!0},variant_id:{type:"number"}}),Types.Collection=new Schematic.Schema("Collection",{name:{type:"string",min:1,max:140,required:!0},slug:{type:"string",max:500},description:{type:"string"},items:{type:"array",required:!0,elements:{type:Types.CollectionEntry}}}),Types.ContentAuthor=new Schematic.Schema("ContentAuthor",{image_url:{type:"string"},name:{type:"string"},id:{type:"number"}}),Types.Content=new Schematic.Schema("Content",{title:{type:"string",required:!0},text:{type:"string",required:!0},author:{type:"object"},date:{type:"string"},published:{type:"boolean"}}),Types.StaticContent=new Schematic.Schema("StaticContent",{name:{type:"string",required:!0,min:2},content:{type:"string",required:!0},published:{type:"boolean"}}),Types.CartEntry=new Schematic.Schema("CartEntry",{product_id:{type:"number",required:!0},quantity:{type:"number",required:!0,min:0},variant_id:{type:"number"}}),Types.CartUpdateEntry=new Schematic.Schema("CartUpdateEntry",{product_id:{type:"number",required:!0},quantity:{type:"number",min:0},variant_id:{type:"number"}}),Types.Cart=new Schematic.Schema("Cart",{items:{type:"array",elements:{type:Types.CartEntry},required:!0},user_id:{type:"number"}}),Types.CartUpdate=new Schematic.Schema("CartUpdate",{items:{type:"array",elements:{type:"object"},required:!0},op:{type:"string",whitelist:["add","remove","update"]}}),Types.Coupon=new Schematic.Schema("Coupon",{code:{type:"string",min:"1",max:"30",required:!0},name:{type:"string",min:"1",max:"30",required:!0},target_type:{type:"string",whitelist:["CART_COUPON","PRODUCT_COUPON","CATEGORY_COUPON","PRODUCTS_COUPON"],required:!0},target_id:{type:"number"},discount_type:{type:"string",whitelist:["NET_REDUCTION","PERCENTAGE_REDUCTION"],required:!0},discount_value:{type:"number",min:0,required:!0},active:{type:"boolean",required:!0},usages_left:{type:"number",required:!1},expiration_date:{type:"string",required:!1}}),Types.Brand=new Schematic.Schema("Brand",{name:{type:"string",min:3,max:50,required:!0},description:{type:"string"},url:{type:"string"},image_url:{type:"string"}}),Types.File=new Schematic.Schema("File",{file:{type:"string",required:!0},filename:{type:"string",required:!0},name:{type:"string",required:!0},slug:{type:"string",max:140},description:{type:"string"}}),Types.Notification=new Schematic.Schema("Notification",{event:{type:"string",required:!0,whitelist:["custom","order.create","order.paid","user.create"]},from_name:{type:"string"},from_email:{type:"string"},subject:{type:"string"}}),Types.User=new Schematic.Schema("User",{name:{type:"string",min:1,max:255},email:{type:"string",min:4,max:255},password:{type:"string",min:4,max:255},image_url:{type:"string"}}),Types.TaxRate=new Schematic.Schema("TaxRate",{country:{type:"string",required:!0},state:{type:"string",required:!0},postcode:{type:"string",required:!0},city:{type:"string",required:!0},rate:{type:"number",required:!0,min:0,max:100},priority:{type:"number",required:!0,min:0}}),Types.Tax=new Schematic.Schema("Tax",{name:{type:"string",min:3,max:30,required:!0},description:{type:"string",max:600},rates:{type:"array",elements:{type:Types.TaxRate}}}),Types.Currency=new Schematic.Schema("Currency",{name:{type:"string",min:3,max:30,required:!0},formatting:{type:"string",min:0,max:3,required:!0}}),Types.Product=new Schematic.Schema("Product",{name:{type:"string",required:!0,min:2},type:{type:"string",required:!0,whitelist:["simple_product","product_with_variants","grouped_product","bundled_product"]},category_id:{type:"number"},sku:{type:"string"},price:{type:"number",required:!0},slug:{type:"string"},stock_level:{type:"number",min:0},stock_type:{type:"string",whitelist:["infinite","track","status"],required:!0},stock_status:{type:"string",whitelist:["in_stock","out_of_stock"]},description:{type:"string"},weigth:{type:"number"},height:{type:"number"},depth:{type:"number"},width:{type:"number"},brand_id:{type:"number"},store_id:{type:"number"},images:{type:"array"},published:{type:"boolean"},price_discount:{type:"number"}}),Types.Variant=new Schematic.Schema("Variant",{variant_id:{type:"number",required:!0},product_id:{type:"number",required:!0},stock_level:{type:"number",min:0},stock_type:{type:"string",whitelist:["infinite","track","status"],required:!0},stock_status:{type:"string",whitelist:["in_stock","out_of_stock"]},price:{type:"number",required:!0}}),Types.InvoiceLineItem=new Schematic.Schema("InvoiceLineItem",{name:{type:"string",required:!0,min:1,max:140},description:{type:"string",max:500},price:{type:"number",required:!0,min:0},quantity:{type:"number",required:!0,min:0}}),Types.Invoice=new Schematic.Schema("Invoice",{number:{type:"number",
required:!0},order_id:{type:"number",required:!0},customer:{type:"object",required:!0},company:{type:"object",required:!0},lineItems:{type:"array",elements:{type:Types.InvoiceLineItem}}}),Types.GroupedProductEntry=new Schematic.Schema("GroupedProductEntry",{product_id:{type:"number",required:!0},quantity:{type:"number",required:!0}}),Types.GroupedProduct=new Schematic.Schema("GroupedProduct",{name:{type:"string",required:!0,min:2},category_id:{type:"number"},sku:{type:"string"},items:{type:"array",elements:{type:Types.GroupedProductEntry},min:1},pricing_method:{type:"string",whitelist:["dynamic_pricing","fixed_pricing"],required:!0},price:{type:"number"},price_discount:{type:"number"},slug:{type:"string"},description:{type:"string"},brand_id:{type:"number"},store_id:{type:"number"},images:{type:"array"},published:{type:"boolean"},type:{type:"string",whitelist:["grouped_product"]}}),Types.ProductWithVariants=new Schematic.Schema("Product",{name:{type:"string",required:!0,min:2},category_id:{type:"number"},sku:{type:"string"},price:{type:"number",required:!0},stock_level:{type:"number",min:0},description:{type:"string"},weigth:{type:"number"},height:{type:"number"},width:{type:"number"},depth:{type:"number"},brand_id:{type:"number"},store_id:{type:"number"},images:{type:"array"},slug:{type:"string"},published:{type:"boolean"}}),Types.Order=new Schematic.Schema("Order",{status:{type:"string",whitelist:["created","processing","evaded","shipped"]},shipping_address_id:{type:"number"},billing_address_id:{type:"number"},items_total:{type:"number"},display_items_total:{type:"string"},total:{type:"number"},display_total:{type:"string"},items:{type:"array",required:!0},currency:{type:"string",whitelist:["USD","CAD","EUR","AED","AFN","ALL","AMD","ARS","AUD","AZN","BAM","BDT","BGN","BHD","BIF","BND","BOB","BRL","BWP","BYR","BZD","CDF","CHF","CLP","CNY","COP","CRC","CVE","CZK","DJF","DKK","DOP","DZD","EEK","EGP","ERN","ETB","GBP","GEL","GHS","GNF","GTQ","HKD","HNL","HRK","HUF","IDR","ILS","INR","IQD","IRR","ISK","JMD","JOD","JPY","KES","KHR","KMF","KRW","KWD","KZT","LBP","LKR","LTL","LVL","LYD","MAD","MDL","MGA","MKD","MMK","MOP","MUR","MXN","MYR","MZN","NAD","NGN","NIO","NOK","NPR","NZD","OMR","PAB","PEN","PHP","PKR","PLN","PYG","QAR","RON","RSD","RUB","RWF","SAR","SDG","SEK","SGD","SOS","SYP","THB","TND","TOP","TRY","TTD","TWD","TZS","UAH","UGX","UYU","UZS","VEF","VND","XAF","XOF","YER","ZAR","ZMK"]},store_id:{type:"number"},notes:{type:"string",max:500},shipping_fee:{type:"number",min:0}}),Types.Address=new Schematic.Schema("Address",{full_name:{type:"string",required:!0,max:140},country:{type:"string",required:!0,max:140},state:{type:"string",max:140},city:{type:"string",required:!0,max:140},address1:{type:"string",required:!0,max:250},address2:{type:"string",max:250},postal_code:{type:"string",required:!0,max:20},phone_number:{type:"string",max:30},email:{type:"string",required:!0,max:140},alternate_phone_number:{type:"string",max:140}}),Types.ShippingZone=new Schematic.Schema("ShippingZone",{country:{type:"string",required:!0},state:{type:"string",required:!0},postcode:{type:"string",required:!0},city:{type:"string",required:!0}}),Types.Shipping=new Schematic.Schema("Shipping",{name:{type:"string",required:!0,min:3},base_cost:{type:"number",required:!0,min:0},per_item_cost:{type:"number",min:0},description:{type:"string"},min_price:{type:"number",min:0},max_price:{type:"number",min:0},min_weight:{type:"number",min:0},max_weight:{type:"number",min:0},zones:{type:"array"}}),Types.Store=new Schematic.Schema("Store",{name:{type:"string",required:!0},owner_email:{type:"string",required:!0},description:{type:"string"},custom_attributes:{type:"object"}}),Types.Customer=new Schematic.Schema("Customer",{full_name:{type:"string",required:!0},shipping_address:{type:Types.Address,required:!0},billing_address:{type:Types.Address,required:!0},email:{type:"string",required:!0}}),Types.Variable=new Schematic.Schema("Variable",{name:{type:"string",required:!0,min:1,max:500},type:{type:"string",required:!1,whitelist:["string","number","boolean","object","array"]},value:{required:!0}}),Types.Shipment=new Schematic.Schema("Shipment",{date:{type:"string",required:!0},delivery_date:{type:"string",required:!0},description:{type:"text"},method:{type:Types.Shipping}}),Types}angular.module("DataDashboard").factory("$models",["$http","$q",ModelsFactory])})()},function(module,exports){"use strict";!(function(){function NotificationsPresetsFactory(){var presets={};return presets["invoices.create"]={name:"An order is created",description:"This notification is sent to the customer who creates an order",subject:"Your invoice",locales:{},template:{title:"Your invoice",message:"Attached to this email you can find your most recent invoice for your order at {{application.name}}"}},presets["orders.create"]={name:"An order is created",description:"This notification is sent to the customer who creates an order",subject:"We received your order!",locales:{},template:{title:"Thank you for your order!",introduction:"Your order has been received and is now being processed. Your order's details are shown below for your reference.",productLabel:"Items",priceLabel:"Price",customerInformationLabel:"Customer information",shippingAddressLabel:"Shipping address",billingAddressLabel:"Billing address"}},presets["users.create"]={name:"New customer account",description:"This notification is sent to the customer who creates an account",subject:"Welcome!",locales:{},template:{title:"Welcome to {{application.name}}!",introduction:"Thank you for creating an account with us!",buttonLabel:"Visit our store"}},presets["users.recoverPassword"]={name:"Password recovery",description:"This notification is sent to the customer who requests a password recovery",subject:"Password recovery",locales:{},template:{title:"Recover your password",introduction:"Hello, we sent you this email because you requested to recover your password. If it's not the case, please ignore this email.",redirect_url:"http://example.com/passwordrecovery"}},presets["orders.update.processing"]={name:"An order is paid",description:"This notification is sent to the customer who paid an order",subject:"Your order is confirmed!",locales:{},template:{title:"Thank you for your order!",introduction:"Your order has been confirmed and is now being processed. Your order's details are shown below for your reference.",productLabel:"Items",priceLabel:"Price",customerInformationLabel:"Customer information",shippingAddressLabel:"Shipping address",billingAddressLabel:"Billing address"}},presets["orders.update.completed"]={name:"An order is shipped",description:"This notification is sent to the customer when his/her order is shipped.",subject:"We shipped your order!",locales:{},template:{title:"Your order is on the way",introduction:"We are happy to inform you that we shipped your order #{{order.id}} !",tracking_code_introduction:"You can click on the following tracking number to track your package on the carrier's website.",productLabel:"Items",priceLabel:"Price",customerInformationLabel:"Customer information",shippingAddressLabel:"Shipping address",billingAddressLabel:"Billing address"}},presets["orders.refund"]={name:"An order is refunded",description:"This notification is sent to the customer when his/her order is refunded.",subject:"Refund for order {{order.id}}",locales:{},template:{title:"Refund for order {{order.id}}",introduction:"A refund was recently created for your order. Details are shown below for your reference.",productLabel:"Items"}},presets}angular.module("DataDashboard").factory("NotificationsPresetsFactory",NotificationsPresetsFactory)})()},function(module,exports){"use strict";!(function(){function PaginationFactory(){var Factory={};return Factory.fromHTTPResponse=function(httpResponse){return{currentPage:httpResponse.data.page,numberOfPages:httpResponse.data.pages,nextPage:httpResponse.data._links.next||null,previousPage:httpResponse.data._links.prev||null,count:httpResponse.data.count}},Factory}angular.module("DataDashboard").factory("$pagination",PaginationFactory)})()},function(module,exports){"use strict";var app=angular.module("DataDashboard");app.factory("rolePresets",function(){function getCommonPublicProfile(){return{list:!0,findOne:!0,getById:!0,create:!1,update:!1,delete:!1}}function getAllFalseProfile(){return{list:!1,findOne:!1,getById:!1,create:!1,update:!1,delete:!1}}function getCommonUserProfile(){return{list:!0,findOne:!0,getById:!0,create:!1,update:!1,delete:!1}}function getCommonAdminProfile(){return{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0}}var publicAccessMap={addresses:getAllFalseProfile(),brands:getCommonPublicProfile(),carts:{list:!1,findOne:!1,getById:!0,patch:!0,create:!0,update:!0,checkout:!0,delete:!1},categories:getCommonPublicProfile(),collections:getCommonPublicProfile(),contents:getCommonPublicProfile(),coupons:getAllFalseProfile(),promotions:getCommonPublicProfile(),currencies:getCommonPublicProfile(),orders:{list:!1,findOne:!1,getById:!1,create:!0,update:!1,delete:!1},paymentMethods:getCommonPublicProfile(),invoices:getAllFalseProfile(),products:getCommonPublicProfile(),shippings:getCommonPublicProfile(),stores:getCommonPublicProfile(),taxes:getCommonPublicProfile(),users:{list:!1,findOne:!1,getById:!1,create:!0,update:!1,delete:!1,authenticate:!0},variables:getCommonPublicProfile()},userAccessMap={addresses:{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0},brands:{list:!0,findOne:!0,getById:!0,create:!1,update:!1,delete:!1},carts:{list:!0,findOne:!1,getById:!0,patch:!0,create:!0,update:!0,checkout:!0,delete:!0},categories:{list:!0,findOne:!0,getById:!0,create:!1,update:!1,delete:!1},collections:{list:!0,findOne:!0,getById:!0,create:!1,update:!1,delete:!1},contents:{list:!0,findOne:!0,getById:!0,create:!1,update:!1,delete:!1},coupons:getAllFalseProfile(),promotions:{list:!0,findOne:!0,getById:!0,create:!1,update:!1,delete:!1},currencies:{list:!0,findOne:!0,getById:!0,create:!1,update:!1,delete:!1},orders:{list:!0,findOne:!0,getById:!0,create:!0,update:!1,delete:!1},paymentMethods:{list:!0,findOne:!0,getById:!0,create:!0,update:!1,delete:!1},products:{list:!0,findOne:!0,getById:!0,create:!1,update:!1,delete:!1},shippings:{list:!0,findOne:!0,getById:!0,create:!1,update:!1,delete:!1},stores:{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0},taxes:{list:!0,findOne:!0,getById:!0,create:!1,update:!1,delete:!1},invoices:{list:!1,findOne:!1,getById:!1,create:!1,update:!1,delete:!1},users:{list:!1,findOne:!1,getById:!0,create:!0,update:!0,delete:!0,authenticate:!0},variables:getCommonUserProfile()},adminAccessMap={addresses:{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0},invoices:{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0},brands:{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0},carts:{list:!0,findOne:!0,getById:!0,create:!0,patch:!0,update:!0,checkout:!0,delete:!0},categories:{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0},collections:{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0},contents:{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0},coupons:{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0},promotions:{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0},currencies:{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0},orders:{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0},paymentMethods:{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0},products:{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0},shippings:{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0},stores:{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0},taxes:{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0},users:{list:!0,findOne:!0,getById:!0,create:!0,update:!0,delete:!0,authenticate:!0},variables:getCommonAdminProfile()};return{public:publicAccessMap,user:userAccessMap,admin:adminAccessMap}})},function(module,exports){"use strict";!(function(){function StormConfigurationFactory($window,$application){function loadFromStorage(){var storedJson=window.localStorage.getItem(LOCALSTORAGE_KEY);storedJson?Factory._data=JSON.parse(storedJson):Factory._data={}}function persistToStorage(){var s=JSON.stringify(Factory._data);console.log("Persisting to storage with key "+LOCALSTORAGE_KEY,s),window.localStorage.setItem(LOCALSTORAGE_KEY,s)}var Factory={};console.info("Loading Storm configuration information from localStorage");var LOCALSTORAGE_KEY="Marketcloud.Storm.Configuration."+($application.get("id")||"unkownAppId");return Factory._data={},Factory.loadFromStorage=loadFromStorage,Factory.persistToStorage=persistToStorage,Factory.loadFromStorage(),Factory.get=function(key){return"undefined"!=typeof key?this._data[key]:this._data},Factory.set=function(key,value,persist){if(persist=persist||!0,"string"!=typeof key)throw new Error("StormConfigurationFactory.set(key,value) 'key' must be String");this._data[key]=value,persist===!0&&Factory.persistToStorage()},Factory.applyTheme=function(theme){if(theme){theme.indexOf(".theme.css")===-1&&(theme+=".theme.css");var url="/modules/data_dashboard/css/themes/"+theme;$(".storm-theme-definition").remove(),$('<link rel="stylesheet" class="storm-theme-definition" type="text/css" href="'+url+'" >').appendTo("head")}},Factory}angular.module("DataDashboard").factory("StormConfiguration",StormConfigurationFactory),StormConfigurationFactory.$inject=["$window","$application"]})()},function(module,exports){"use strict";!(function(){function TableManagerFactory(){var factory={};return factory}angular.module("DataDashboard").factory("TableManager",TableManagerFactory),TableManagerFactory.$inject=[]})()},function(module,exports){"use strict";angular.module("Marketcloud.Shared").factory("TaxRates",function(){return[{country:"Australia",state:"*",rate:"10.0000",name:"GST",shipping:!0,country_code:"AU"},{country:"Bangladesh",state:"*",rate:"15.0000",name:"VAT",shipping:!0,country_code:"BD"},{country:"Belgium",state:"*",rate:"21.0000",name:"BTW",shipping:!0,country_code:"BE"},{country:"Canada",state:"British Columbia",rate:"7.0000",name:"PST",shipping:!1,priority:2,country_code:"CA",state_code:"BC"},{country:"Canada",state:"Saskatchewan",rate:"5.0000",name:"PST",shipping:!1,priority:2,country_code:"CA",state_code:"SK"},{country:"Canada",state:"Manitoba",rate:"8.0000",name:"PST",shipping:!1,priority:2,country_code:"CA",state_code:"MB"},{country:"Canada",state:"Quebec",rate:"9.975",name:"QST",shipping:!1,priority:2,country_code:"CA",state_code:"QC"},{country:"Canada",state:"Ontario",rate:"13.0000",name:"HST",shipping:!0,country_code:"CA",state_code:"ON"},{country:"Canada",state:"Newfoundland and Labrador",rate:"13.0000",name:"HST",shipping:!0,country_code:"CA",state_code:"NL"},{country:"Canada",state:"New Brunswick",rate:"13.0000",name:"HST",shipping:!0,country_code:"CA",state_code:"NB"},{country:"Canada",state:"Prince Edward Island",rate:"14.0000",name:"HST",shipping:!0,country_code:"CA",state_code:"PE"},{country:"Canada",state:"Nova Scotia",rate:"15.0000",name:"HST",shipping:!0,country_code:"CA",state_code:"NS"},{country:"Canada",state:"Alberta",rate:"5.0000",name:"GST",shipping:!0,country_code:"CA",state_code:"AB"},{country:"Canada",state:"British Columbia",rate:"5.0000",name:"GST",shipping:!0,country_code:"CA",state_code:"BC"},{country:"Canada",state:"Northwest Territories",rate:"5.0000",name:"GST",shipping:!0,country_code:"CA",state_code:"NT"},{country:"Canada",state:"Nunavut",rate:"5.0000",name:"GST",shipping:!0,country_code:"CA",state_code:"NU"},{country:"Canada",state:"Yukon",rate:"5.0000",name:"GST",shipping:!0,country_code:"CA",state_code:"YT"},{country:"Canada",state:"Saskatchewan",rate:"5.0000",name:"GST",shipping:!0,country_code:"CA",state_code:"SK"},{country:"Canada",state:"Manitoba",rate:"5.0000",name:"GST",shipping:!0,country_code:"CA",state_code:"MB"},{country:"Canada",state:"Quebec",rate:"5.0000",name:"GST",shipping:!0,country_code:"CA",state_code:"QC"},{country:"Finland",state:"*",rate:"24.0000",name:"ALV",shipping:!0,country_code:"FI"},{country:"France",state:"*",rate:"20.0000",name:"TVA",shipping:!0,country_code:"FR"},{country:"Germany",state:"*",rate:"19.0000",name:"Mwst.",shipping:!0,country_code:"DE"},{country:"Hungary",state:"*",rate:"27.0000",name:"ÃFA",shipping:!0,country_code:"HU"},{country:"Italy",state:"*",rate:"22.0000",name:"IVA",shipping:!0,country_code:"IT"},{country:"Japan",state:"*",rate:"8.0000",name:"Consumption tax",shipping:!0,country_code:"JP"},{country:"Nepal",state:"*",rate:"13.0000",name:"VAT",shipping:!0,country_code:"NP"},{country:"Netherlands",state:"*",rate:"21.0000",name:"VAT",shipping:!0,country_code:"NL"},{country:"Norway",state:"*",rate:"25.0000",name:"MVA",shipping:!0,country_code:"NO"},{country:"Poland",state:"*",rate:"23.0000",name:"VAT",shipping:!0,country_code:"PL"},{country:"Romania",state:"*",rate:"19.0000",name:"TVA",shipping:!0,country_code:"RO"},{country:"South Africa",state:"*",rate:"14.0000",name:"VAT",shipping:!0,country_code:"ZA"},{country:"Spain",state:"*",rate:"21.0000",name:"VAT",shipping:!0,country_code:"ES"},{country:"Thailand",state:"*",rate:"7.0000",name:"VAT",shipping:!0,country_code:"TH"},{country:"Turkey",state:"*",rate:"18.0000",name:"KDV",shipping:!0,country_code:"TR"},{country:"United Kingdom",state:"*",rate:"20.0000",name:"VAT",shipping:!0,country_code:"GB"},{country:"United States",state:"Alabama",rate:"4.0000",name:"State Tax",shipping:!1,country_code:"US",state_code:"AL"},{country:"United States",state:"Arizona",rate:"5.6000",name:"State Tax",shipping:!1,country_code:"US",state_code:"AZ"},{country:"United States",state:"Arkansas",rate:"6.5000",name:"State Tax",shipping:!0,country_code:"US",state_code:"AR"},{country:"United States",state:"California",rate:"7.5000",name:"State Tax",shipping:!1,country_code:"US",state_code:"CA"},{country:"United States",state:"Colorado",rate:"2.9000",name:"State Tax",shipping:!1,country_code:"US",state_code:"CO"},{country:"United States",state:"Connecticut",rate:"6.3500",name:"State Tax",shipping:!0,country_code:"US",state_code:"CT"},{country:"United States",state:"District of Columbia",rate:"5.7500",name:"State Tax",shipping:!0,country_code:"US",state_code:"DC"},{country:"United States",state:"Florida",rate:"6.0000",name:"State Tax",shipping:!0,country_code:"US",state_code:"FL"},{country:"United States",state:"Georgia",rate:"4.0000",name:"State Tax",shipping:!0,country_code:"US",state_code:"GA"},{country:"United States",state:"Guam",rate:"4.0000",name:"State Tax",shipping:!1,country_code:"US",state_code:"GU"},{country:"United States",state:"Hawaii",rate:"4.0000",name:"State Tax",shipping:!0,country_code:"US",state_code:"HI"},{country:"United States",state:"Idaho",rate:"6.0000",name:"State Tax",shipping:!1,country_code:"US",state_code:"ID"},{country:"United States",state:"Illinois",rate:"6.2500",name:"State Tax",shipping:!1,country_code:"US",state_code:"IL"},{country:"United States",state:"Indiana",rate:"7.0000",name:"State Tax",shipping:!1,country_code:"US",state_code:"IN"},{country:"United States",state:"Iowa",rate:"6.0000",name:"State Tax",shipping:!1,country_code:"US",state_code:"IA"},{country:"United States",state:"Kansas",rate:"6.1500",name:"State Tax",shipping:!0,country_code:"US",state_code:"KS"},{country:"United States",state:"Kentucky",rate:"6.0000",name:"State Tax",shipping:!0,country_code:"US",state_code:"KY"},{country:"United States",state:"Louisiana",rate:"4.0000",name:"State Tax",shipping:!1,country_code:"US",state_code:"LA"},{country:"United States",state:"Maine",rate:"5.5000",name:"State Tax",shipping:!1,country_code:"US",state_code:"ME"},{country:"United States",state:"Maryland",rate:"6.0000",name:"State Tax",shipping:!1,country_code:"US",state_code:"MD"},{country:"United States",state:"Massachusetts",rate:"6.2500",name:"State Tax",shipping:!1,country_code:"US",state_code:"MA"},{country:"United States",state:"Michigan",rate:"6.0000",name:"State Tax",shipping:!0,country_code:"US",state_code:"MI"},{country:"United States",state:"Minnesota",rate:"6.8750",name:"State Tax",shipping:!0,country_code:"US",state_code:"MN"},{country:"United States",state:"Mississippi",rate:"7.0000",name:"State Tax",shipping:!0,country_code:"US",state_code:"MS"},{country:"United States",state:"Missouri",rate:"4.225",name:"State Tax",shipping:!1,country_code:"US",state_code:"MO"},{country:"United States",state:"Nebraska",rate:"5.5000",name:"State Tax",shipping:!0,country_code:"US",state_code:"NE"},{country:"United States",state:"Nevada",rate:"6.8500",name:"State Tax",shipping:!1,country_code:"US",state_code:"NV"},{country:"United States",state:"New Jersey",rate:"7.0000",name:"State Tax",shipping:!0,country_code:"US",state_code:"NJ"},{country:"United States",state:"New Mexico",rate:"5.1250",name:"State Tax",shipping:!0,country_code:"US",state_code:"NM"},{country:"United States",state:"New York",rate:"4.0000",name:"State Tax",shipping:!0,country_code:"US",state_code:"NY"},{country:"United States",state:"North Carolina",rate:"4.7500",name:"State Tax",shipping:!0,country_code:"US",state_code:"NC"},{country:"United States",state:"North Dakota",rate:"5.0000",name:"State Tax",shipping:!0,country_code:"US",state_code:"ND"},{country:"United States",state:"Ohio",rate:"5.7500",name:"State Tax",shipping:!0,country_code:"US",state_code:"OH"},{country:"United States",state:"Oklahoma",rate:"4.5000",name:"State Tax",shipping:!1,country_code:"US",state_code:"OK"},{country:"United States",state:"Pennsylvania",rate:"6.0000",name:"State Tax",shipping:!0,country_code:"US",state_code:"PA"},{country:"United States",state:"Puerto Rico",rate:"6.0000",name:"State Tax",shipping:!1,country_code:"US",state_code:"PR"},{country:"United States",state:"Rhode Island",rate:"7.0000",name:"State Tax",shipping:!1,country_code:"US",state_code:"RI"},{country:"United States",state:"South Carolina",rate:"6.0000",name:"State Tax",shipping:!0,country_code:"US",state_code:"SC"},{country:"United States",state:"South Dakota",rate:"4.0000",name:"State Tax",shipping:!0,country_code:"US",state_code:"SD"},{country:"United States",state:"Tennessee",rate:"7.0000",name:"State Tax",shipping:!0,country_code:"US",state_code:"TN"},{country:"United States",state:"Texas",rate:"6.2500",name:"State Tax",shipping:!0,country_code:"US",state_code:"TX"},{country:"United States",state:"Utah",rate:"5.9500",name:"State Tax",shipping:!1,country_code:"US",state_code:"UT"},{country:"United States",state:"Vermont",rate:"6.0000",name:"State Tax",shipping:!0,country_code:"US",state_code:"VT"},{country:"United States",state:"Virginia",rate:"5.3000",name:"State Tax",shipping:!1,country_code:"US",state_code:"VA"},{country:"United States",state:"Washington",rate:"6.5000",name:"State Tax",shipping:!0,country_code:"US",state_code:"WA"},{country:"United States",state:"West Virginia",rate:"6.0000",name:"State Tax",shipping:!0,country_code:"US",state_code:"WV"},{country:"United States",state:"Wisconsin",rate:"5.0000",name:"State Tax",shipping:!0,country_code:"US",state_code:"WI"},{country:"United States",state:"Wyoming",rate:"4.0000",name:"State Tax",shipping:!0,country_code:"US",state_code:"WY"}]})},function(module,exports){"use strict";!(function(){function UtilsFactory(){function JSONExport(data,title){title||(title="Marketcloud_export_"+String(Date.now())+".json");var encodedUri=encodeURI("data:application/json;charset=utf-8,"+JSON.stringify(data)),link=document.createElement("a");link.setAttribute("href",encodedUri),link.setAttribute("download",title),document.body.appendChild(link),link.click()}function CSVExport(data,title){title||(title="Marketcloud_export_"+String(Date.now())+".csv");var encodedUri=encodeURI("data:text/csv;charset=utf-8,"+data),link=document.createElement("a");link.setAttribute("href",encodedUri),link.setAttribute("download",title),document.body.appendChild(link),link.click()}function strhash(str){str.length%32>0&&(str+=Array(33-str.length%32).join("z"));var hash="",bytes=[],i=0,j=0,k=0,a=0,dict=["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","1","2","3","4","5","6","7","8","9"];for(i=0;i<str.length;i++){var ch=str.charCodeAt(i);bytes[j++]=ch<127?255&ch:127}var chunk_len=Math.ceil(bytes.length/32);for(i=0;i<bytes.length;i++)j+=bytes[i],k++,k!=chunk_len&&i!=bytes.length-1||(a=Math.floor(j/k),hash+=a<32?"0":a>126?"z":dict[Math.floor((a-32)/2.76)],j=k=0);return hash}var Factory={},flatten=function(data){function recurse(cur,prop){if(Object(cur)!==cur)result[prop]=cur;else if(Array.isArray(cur)){for(var i=0,l=cur.length;i<l;i++)recurse(cur[i],prop+"["+i+"]");0===l&&(result[prop]=[])}else{var isEmpty=!0;for(var p in cur)isEmpty=!1,recurse(cur[p],prop?prop+"."+p:p);isEmpty&&prop&&(result[prop]={})}}var result={};return recurse(data,""),result},unflatten=function(data){if(Object(data)!==data||Array.isArray(data))return data;var regex=/\,?([^.\[\]]+)|\[(\d+)\]/g,resultholder={};for(var p in data){for(var m,cur=resultholder,prop="";m=regex.exec(p);)cur=cur[prop]||(cur[prop]=m[2]?[]:{}),prop=m[2]||m[1];cur[prop]=data[p]}return resultholder[""]||resultholder};return Factory.flatten=flatten,Factory.unflatten=unflatten,Factory.getSlugFromString=function(str){return str.split(" ").map(function(item){return item.replace(/\W/g,"")}).map(function(item){return item.toLowerCase()}).join("-")},Factory.getPaginationFromHTTPResponse=function(httpResponse){return{currentPage:httpResponse.data.page,numberOfPages:httpResponse.data.pages,nextPage:httpResponse.data._links.next||null,previousPage:httpResponse.data._links.prev||null,count:httpResponse.data.count}},Factory.exportAsJSON=JSONExport,Factory.exportAsCSV=CSVExport,Factory.hash=strhash,Factory.CSVToJSON=function(csv){for(var rows=csv.split("\n"),header=rows[0],header_fields=header.split(","),objects=[],i=1;i<rows.length;i++){for(var o={},row_fields=rows[i].split(","),k=0;k<header_fields.length;k++)""!==row_fields[k]&&(o[header_fields[k]]=row_fields[k],"true"===o[header_fields[k]]||"false"===o[header_fields[k]]?o[header_fields[k]]=Boolean(o[header_fields[k]]):isNaN(o[header_fields[k]])||(o[header_fields[k]]=Number(o[header_fields[k]])));objects.push(o)}return objects},Factory.JSONToCSV=function(json){Array.isArray(json)||(json=[json]);var fields=[];json.forEach(function(row){for(var k in row)fields.indexOf(k)<0&&fields.push(k)});var firstRow=fields.join(","),buf=firstRow+"\n";return json.forEach(function(row){fields.forEach(function(field){buf+=row.hasOwnProperty(field)&&null!==row[field]?row[field]+",":","}),buf+="\n"}),buf=buf.replace(/\n$/,"")},Factory}angular.module("DataDashboard").factory("$utils",UtilsFactory)})()},function(module,exports){"use strict";!(function(){function ValidationService(){var Service={};return Service.showErrorMessage=function(validation,schema,selector){if(Service.hideErrors(),selector=selector||'[ng-model="'+validation.invalidPropertyName+'"]',0===angular.element(selector).length)return void console.log("COuld now match selector "+selector+" to show error message, exiting");var element=angular.element(selector),errorMessage=Service.getErrorMessage(validation,schema),parent=element.parent();parent.hasClass("input-group")&&(parent=parent.parent()),parent.append('<div class="error-message">'+errorMessage+"</div>"),parent.addClass("has-error"),$("html, body").animate({scrollTop:element.offset().top-200},500)},Service.getErrorMessage=function(validation,schema){switch(validation.failedValidator){case"required":return"This field is required";case"type":return"This field must be a "+schema[validation.invalidPropertyName].type;case"min":return"number"===schema[validation.invalidPropertyName].type?"Minimum value is "+schema[validation.invalidPropertyName].min:"string"===schema[validation.invalidPropertyName].type?"Minimum length is "+schema[validation.invalidPropertyName].min:"array"===schema[validation.invalidPropertyName].type?"Minimum number of elements is is "+schema[validation.invalidPropertyName].min:"Minimum is "+schema[validation.invalidPropertyName].min;case"max":return"number"===schema[validation.invalidPropertyName].type?"Maxiumum value is "+schema[validation.invalidPropertyName].max:"string"===schema[validation.invalidPropertyName].type?"Maxiumum length is "+schema[validation.invalidPropertyName].max:"array"===schema[validation.invalidPropertyName].type?"Maxiumum number of elements is is "+schema[validation.invalidPropertyName].max:"Maxiumum is "+schema[validation.invalidPropertyName].max;default:return"This field is invalid"}},Service.hideErrors=function(){angular.element(".error-message").remove(),angular.element(".has-error").removeClass("has-error")},Service}angular.module("DataDashboard").factory("$validation",ValidationService)})()}]));